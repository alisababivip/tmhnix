import{_ as e}from"./WizardStepTitle.vue-i3gP8sdL.js";import{_ as a}from"./BaseMessage.vue-Kpn2u5Rn.js";import{_ as s}from"./BaseInput.vue-iInHQMIA.js";import{a as l,ac as t,r as u,E as c,at as n,Z as o,c as r,b as i,e as d,u as v,w as m,k as p,Y as f,o as y,q as g,t as h,p as x,O as w,f as S,X as b}from"../e/entry-8qgg5CL-.js";import{u as _}from"./multi-step-form-Tb8qYR9z.js";import"./input-id-wZ-Ta08j.js";const j={key:0,class:"mt-4 flex justify-center"},E={key:1,class:"mx-auto w-full max-w-5xl flex-col px-4 text-center"},V={class:"mt-8"},I=l({__name:"step-2",setup(l){const I=t(),{data:k}=_();k.value.exchange||I.push("/admin/exchange/wizard");const U=u(""),C=u(""),L=u(null),O=u(!1),P=u(!1);c((async()=>{k.value.licenseStatus&&await $()}));const{activateExchangeLicense:z}=n(),B=o().public.apiPath,T=async e=>{k.value.loading=!0;try{const a=await $fetch(B+"/api/exchange/settings/verify/license",{method:"POST",credentials:"include",headers:{"client-platform":"browser"},body:JSON.stringify(e)});"success"===a.status?(k.value.licenseStatus=!0,O.value=!0,L.value=a.data.message):(k.value.licenseStatus=!1,O.value=!1,L.value=a.error.message)}catch(a){k.value.licenseStatus=!1}k.value.loading=!1},$=async()=>{const e={productId:k.value.productId};await T(e)},q=r((()=>!0===k.value.licenseStatus&&k.value.exchange===k.value.activeExchange));return(l,t)=>{const u=e,c=a,n=s,o=b,r=f;return y(),i("div",null,[d(u),v(L)?(y(),i("div",j,[d(c,{type:v(O)?"success":"danger"},{default:m((()=>[g(h(v(L)),1)])),_:1},8,["type"])])):p("",!0),v(O)?p("",!0):(y(),i("div",E,[d(r,{class:"mt-8 p-5 max-w-md mx-auto"},{default:m((()=>[d(n,{modelValue:v(U),"onUpdate:modelValue":t[0]||(t[0]=e=>x(U)?U.value=e:null),type:"text",label:"Purchase Code",placeholder:"Enter your purchase code"},null,8,["modelValue"]),v(q)?p("",!0):(y(),w(n,{key:0,modelValue:v(C),"onUpdate:modelValue":t[1]||(t[1]=e=>x(C)?C.value=e:null),type:"text",label:"Envato Username",placeholder:"Enter your Envato username"},null,8,["modelValue"])),S("div",V,[d(o,{color:v(q)?"success":"primary",class:"w-full",onClick:t[2]||(t[2]=e=>v(q)?(async()=>{const e={productId:k.value.productId,purchaseCode:U.value,envatoUsername:k.value.username};await T(e)})():(async()=>{P.value=!0;try{const e=await z(k.value.productId,U.value,C.value);"success"===e.status?(k.value.licenseStatus=!0,O.value=!0,L.value=e.data.message):(k.value.licenseStatus=!1,O.value=!1,L.value=e.error.message)}catch(e){k.value.licenseStatus=!1,O.value=!1,L.value="License verification failed!"}P.value=!1})()),disabled:v(P),loading:v(P)},{default:m((()=>[S("span",null,h(v(q)?"Verify":"Activate")+" "+h(l.$t("License")),1)])),_:1},8,["color","disabled","loading"])])])),_:1})]))])}}});export{I as default};
