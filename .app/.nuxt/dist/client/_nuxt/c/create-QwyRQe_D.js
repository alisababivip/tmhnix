import{a as e,ad as a,ac as l,r as t,E as s,c as r,O as u,w as o,o as n,e as m,q as d,t as i,u as p,f as c,p as g,W as b,_ as v,x as f,X as h,Y as j}from"../e/entry-8qgg5CL-.js";import{_}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as B}from"./BaseInput.vue-iInHQMIA.js";import{_ as V}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as y}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as w}from"./useUsers-4S9MS3a9.js";import{u as C}from"./useMailwizard-mGGEZWYz.js";import{z as S,u as U,t as x,F as T}from"./vee-validate.esm-n59zZCC5.js";import{u as q}from"./campaigns-yRjF5fLV.js";import{u as E}from"./templates-P8j7kCfk.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./input-id-wZ-Ta08j.js";const M={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},N=e({__name:"create",setup(e){const N=E(),$=q(),{fetchUsers:k}=w(),{toast:z}=a(),F=l(),{createCampaign:I}=C(),P=t([]);s((async()=>{0===N.templates.length&&await N.fetchTemplates();const e=await k();"success"===e.status&&(P.value=e.data.result.map((e=>({label:e.first_name+" "+e.last_name,text:e.email,value:{...e,status:"PENDING"}}))))}));const W=r((()=>N.templates)),A=S.object({name:S.string().nonempty("Name is required"),subject:S.string().nonempty("Subject is required"),template:S.object({label:S.string(),value:S.number().positive("Template is required")}),speed:S.number().positive("Speed is required").min(1,"Speed must be at least 1").max(100,"Speed must be at most 100")}),D=r((()=>({name:"",subject:"",speed:10,template:{label:"Select a template",value:0}}))),{handleSubmit:G,isSubmitting:J,values:L,resetForm:O}=U({validationSchema:x(A),initialValues:D}),X=G((async e=>{if(Y.value.length&&0!==Y.value.length)try{const a=await I(e.name,e.subject,e.speed,e.template.value,Y.value.map((e=>e.value)));z.response(a),"success"===a.status&&(await $.fetchCampaigns(),F.push("/admin/extensions/mailwizard/campaigns"))}catch(a){z.danger(a)}else z.danger("Please select at least one target")})),Y=t([]),H=t(((e,a)=>0===e.length?"No targets selected":e.length>1?`${e.length} targets selected`:String(a?e[0][a]:e[0])));return(e,a)=>{const l=v,t=f,s=h,r=_,w=B,C=j,S=V,U=y;return n(),u(U,null,{left:o((()=>[m(l,{size:"lg"},{default:o((()=>[d(i(e.$t("Create Campaign")),1)])),_:1})])),right:o((()=>[m(s,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/admin/extensions/mailwizard/campaigns"},{default:o((()=>[m(t,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),d(" "+i(e.$t("Back")),1)])),_:1}),m(s,{type:"submit",color:"primary",disabled:p(J),class:"w-full",onClick:p(X)},{default:o((()=>[d(i(e.$t("Create")),1)])),_:1},8,["disabled","onClick"])])),default:o((()=>[c("form",{onSubmit:a[1]||(a[1]=b(((...e)=>p(X)&&p(X)(...e)),["prevent"])),class:"space-y-8"},[m(C,{class:"p-5 space-y-5"},{default:o((()=>[c("div",M,[m(p(T),{name:"template"},{default:o((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[m(r,{"model-value":e.value,error:a,items:p(W)?.map((e=>({label:e.name,value:e.id}))),properties:{label:"label",value:"value"},placeholder:"Select a template",label:"Template",shape:"rounded","onUpdate:modelValue":l,onBlur:t},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"])])),_:1}),m(p(T),{name:"name"},{default:o((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[m(w,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Name",placeholder:"Enter campaign name",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(p(T),{name:"subject"},{default:o((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[m(w,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Subject",placeholder:"Enter campaign subject",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(p(T),{name:"speed"},{default:o((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[m(w,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,type:"number",label:"Speed",placeholder:"Enter campaign speed",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(r,{modelValue:p(Y),"onUpdate:modelValue":a[0]||(a[0]=e=>g(Y)?Y.value=e:null),"multiple-label":p(H),label:"Targets",items:p(P),shape:"rounded",properties:{label:"label",value:"value",sublabel:"text"},multiple:"",disabled:0===p(P)?.length,loading:!p(P)},null,8,["modelValue","multiple-label","items","disabled","loading"])])])),_:1}),m(S,null,{default:o((()=>[m(s,{type:"submit",color:"primary",disabled:p(J),class:"w-full"},{default:o((()=>[d(i(e.$t("Create Campaign")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{N as default};
