import{a as e,ad as a,ac as l,r as s,z as t,E as r,c as u,O as o,w as d,o as n,e as i,q as m,t as p,u as c,f as v,p as g,b as f,B as b,F as h,k as _,W as j,_ as y,x as w,X as B,Y as V}from"../e/entry-8qgg5CL-.js";import{_ as C}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as S}from"./BaseInput.vue-iInHQMIA.js";import{_ as U}from"./BaseTag.vue-NMkN1Uk8.js";import{_ as x}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as k}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as T}from"./useUsers-4S9MS3a9.js";import{u as $}from"./useMailwizard-mGGEZWYz.js";import{z as E,u as q,t as z,F as M}from"./vee-validate.esm-n59zZCC5.js";import{u as N}from"./campaigns-yRjF5fLV.js";import{u as F}from"./templates-P8j7kCfk.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./input-id-wZ-Ta08j.js";const I={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},A={class:"flex justify-between mt-6 w-full gap-5"},P=e({__name:"[id]",setup(e){const P=F(),W=N(),{fetchUsers:D}=T(),{toast:G}=a(),J=l(),{updateCampaign:L,getCampaign:O}=$(),X=s([]),Y=s(null),H=t(),{id:K}=H.params;r((async()=>{const e=await O(K);"success"===e.status&&(Y.value=e.data.result),0===P.templates.length&&await P.fetchTemplates();const a=await D();"success"===a.status&&(X.value=a.data.result.map((e=>({label:e.first_name+" "+e.last_name,text:e.email,value:{...e,status:"PENDING"}})))),Y.value?.targets&&(re.value=Y.value.targets.map((e=>X.value.find((a=>a.value.id===e.id)))).filter((e=>void 0!==e))),se()}));const Q=u((()=>P.templates)),R=E.object({name:E.string().nonempty("Name is required"),subject:E.string().nonempty("Subject is required"),template:E.object({label:E.string(),value:E.number().positive("Template is required")}),speed:E.number().positive("Speed is required").min(1,"Speed must be at least 1").max(100,"Speed must be at most 100")}),Z=u((()=>({...Y.value,template:{label:Q.value?.find((e=>e.id===Y.value?.template_id))?.name,value:Y.value?.template_id},targets:Y.value?.targets.map((e=>({label:e.first_name+" "+e.last_name,text:e.email,value:e})))}))),{handleSubmit:ee,isSubmitting:ae,values:le,resetForm:se}=q({validationSchema:z(R),initialValues:Z}),te=ee((async e=>{if(re.value.length&&0!==re.value.length)try{const a=await L(Y.value.id,e.name,e.subject,e.speed,e.template.value,re.value.map((e=>e.value)));G.response(a),"success"===a.status&&(await W.fetchCampaigns(),J.push("/admin/extensions/mailwizard/campaigns"))}catch(a){G.danger(a)}else G.danger("Please select at least one target")})),re=s([]),ue=s(((e,a)=>0===e.length?"No targets selected":e.length>1?`${e.length} targets selected`:String(a?e[0][a]:e[0]))),oe=()=>{re.value=X.value},de=()=>{re.value=[]};return(e,a)=>{const l=y,s=w,t=B,r=C,u=S,T=V,$=U,E=x,q=k;return n(),o(q,null,{left:d((()=>[i(l,{size:"lg"},{default:d((()=>[m(p(e.$t("Edit Campaign"))+": "+p(c(Y)?.name),1)])),_:1})])),right:d((()=>[i(t,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/admin/extensions/mailwizard/campaigns"},{default:d((()=>[i(s,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),m(" "+p(e.$t("Back")),1)])),_:1}),i(t,{type:"submit",color:"primary",disabled:c(ae),class:"w-full",onClick:c(te)},{default:d((()=>[m(p(e.$t("Update")),1)])),_:1},8,["disabled","onClick"])])),default:d((()=>[v("form",{onSubmit:a[1]||(a[1]=j(((...e)=>c(te)&&c(te)(...e)),["prevent"])),class:"space-y-8"},[i(T,{class:"p-5 space-y-5"},{default:d((()=>[v("div",I,[i(c(M),{name:"template"},{default:d((({field:e,errorMessage:a,handleChange:l,handleBlur:s})=>[i(r,{"model-value":e.value,error:a,items:c(Q)?.map((e=>({label:e.name,value:e.id}))),properties:{label:"label",value:"value"},placeholder:"Select a template",label:"Template",shape:"rounded","onUpdate:modelValue":l,onBlur:s},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"])])),_:1}),i(c(M),{name:"name"},{default:d((({field:e,errorMessage:a,handleChange:l,handleBlur:s})=>[i(u,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Name",placeholder:"Enter campaign name",shape:"rounded",class:"w-full",onBlur:s},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),i(c(M),{name:"subject"},{default:d((({field:e,errorMessage:a,handleChange:l,handleBlur:s})=>[i(u,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Subject",placeholder:"Enter campaign subject",shape:"rounded",class:"w-full",onBlur:s},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),i(c(M),{name:"speed"},{default:d((({field:e,errorMessage:a,handleChange:l,handleBlur:s})=>[i(u,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,type:"number",label:"Speed",placeholder:"Enter campaign speed",shape:"rounded",class:"w-full",onBlur:s},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),i(r,{modelValue:c(re),"onUpdate:modelValue":a[0]||(a[0]=e=>g(re)?re.value=e:null),"multiple-label":c(ue),label:"Targets",items:c(X),shape:"rounded",properties:{label:"label",value:"value",sublabel:"text"},multiple:"",disabled:0===c(X)?.length,loading:!c(X)},null,8,["modelValue","multiple-label","items","disabled","loading"]),v("div",A,[i(t,{onClick:oe,shape:"curved",color:"primary",class:"w-full"},{default:d((()=>[m(p(e.$t("Select All")),1)])),_:1}),i(t,{onClick:de,shape:"curved",color:"danger",class:"w-full"},{default:d((()=>[m(p(e.$t("Clear Selection")),1)])),_:1})])])])),_:1}),c(re)&&c(re).length>0?(n(),o(T,{key:0,class:"grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 border-t-2 p-5 border-gray-200 dark:border-gray-700"},{default:d((()=>[(n(!0),f(h,null,b(c(re),(e=>(n(),o($,{key:e.value.id,shape:"rounded",color:"default",shadow:"hover"},{default:d((()=>[m(p(e.value.first_name)+" "+p(e.value.last_name),1)])),_:2},1024)))),128))])),_:1})):_("",!0),i(E,null,{default:d((()=>[i(t,{type:"submit",color:"primary",disabled:c(ae),class:"w-full"},{default:d((()=>[m(p(e.$t("Update Campaign")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{P as default};
