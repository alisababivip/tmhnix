import{a as t,r as a,S as e,c as s,E as r,ac as l,o as n,O as o,w as i,u as d,e as c,k as u,f as y,t as g,q as f,x as v,X as m,Y as p,c7 as x,c5 as k,y as h}from"../e/entry-8qgg5CL-.js";import{_ as w}from"./BaseButtonIcon.vue-6tAU_b7C.js";import{u as _}from"./useMlm-tZO3tueF.js";import{s as $,t as b,h as z,l as j,i as A,z as C,a as E}from"./zoom-Dvlwhkg1.js";const M=t=>(x("data-v-7911b9c7"),t=t(),k(),t),B={class:"flex gap-5 items-center mb-5"},R=["src"],q={class:"text-gray-700 dark:text-gray-300"},I={class:"text-gray-600 dark:text-gray-400"},N={class:"flex flex-col"},U={class:"flex justify-between gap-2"},O=M((()=>y("span",{class:"text-gray-700 dark:text-gray-300"},"Referred",-1))),S={class:"text-gray-600 dark:text-gray-400"},Y={class:"flex justify-between gap-2"},H=M((()=>y("span",{class:"text-gray-700 dark:text-gray-300"},"Rewards",-1))),J={class:"text-gray-600 dark:text-gray-400"},L=72,P=72,T=h(t({__name:"tree",props:{uuid:{type:String,required:!1},isAdmin:{type:Boolean,required:!1,default:!1}},setup(t){const x=t,{getReferralTree:k,getNodeByUserId:h}=_(),M=a(!1),T=a([]),V=e(),W=s((()=>V.getProfile));r((async()=>{let t;M.value=!0,t=x.isAdmin?await h(x.uuid):await k(),"success"===t.status&&t.data.result?.downlines?.length>0?T.value=t.data.result:(console.log("No referral tree found. Creating a new one."),T.value={uuid:W.value?.uuid,first_name:W.value?.first_name,last_name:W.value?.last_name,avatar:W.value?.avatar,level:0,rewardsCount:0,referredCount:0,downlines:[]}),X.value&&function(t,a){const e=t.clientWidth-Q-G,s=t.clientHeight-F-K;$(t).selectAll("svg").remove(),Z=$(t).append("svg").attr("viewBox",`0 0 ${e} ${s+F+K}`).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform",`translate(${Q},${F})`);const r=50,l=2500;for(let f=-l;f<=l;f+=r)Z.append("line").attr("x1",-l).attr("y1",f).attr("x2",l).attr("y2",f).attr("stroke-width",.1).attr("class","stroke-gray-600 dark:stroke-gray-400");for(let f=-l;f<=l;f+=r)Z.append("line").attr("x1",f).attr("y1",-l).attr("x2",f).attr("y2",l).attr("stroke-width",.1).attr("class","stroke-gray-600 dark:stroke-gray-400");const n=b().size([s,e]),o=z(a,(t=>t.downlines));n(o),o.descendants().forEach((t=>{t.y=112*t.depth})),Z.selectAll(".link").data(o.links()).enter().append("path").attr("class","link").style("fill","none").style("stroke","#ccc").style("stroke-width","1px").attr("d",j().x((t=>t.x)).y((t=>t.y)));const i=Z.selectAll(".node").data(o.descendants()).enter().append("g").attr("transform",(t=>`translate(${t.x},${t.y})`)).attr("class","node grayscale");i.append("foreignObject").attr("width",L).attr("height",P).attr("x",-36).attr("y",-36).append("xhtml:body").style("margin","0").style("padding","0").style("background-color","none").style("width","72px").style("height","72px").attr("class","transform hover:scale-110 transition-all duration-300 cursor-pointer").html((t=>`<img src='${t.data.avatar||`/img/avatars/${t.data.level+1}.svg`}'\n                alt='User Avatar'\n                style='border-radius: 50%; width: 100%; height: 100%; object-fit: cover;'\n                class='p-1'\n                />`)),i.on("click",((t,a)=>et(a.data)));const d=e/2-l,c=s/2-l,u=l-e/2,y=l-s/2,g=A.translate(Q,F);tt=C().scaleExtent([.7,3]).on("zoom",(t=>{const a=t.transform,e=Math.max(Math.min(a.x,u*a.k),d*a.k),s=Math.max(Math.min(a.y,y*a.k),c*a.k);Z.attr("transform",`translate(${e},${s}) scale(${a.k})`),at.value=!(a.x===g.x&&a.y===g.y&&1===a.k)})),$(t).select("svg").call(tt).call(tt.transform,g).on("dblclick.zoom",null),et(a)}(X.value,T.value),M.value=!1}));const X=a(null),D=a(null),F=40,G=120,K=20,Q=160;let Z,tt;const at=a(!1);function et(t){D.value=t,E(".node").classed("grayscale-0",!1),E(".link").style("stroke","#ccc");const a=E(".node").filter((a=>a.data.uuid===t.uuid));if(!a.empty()){a.classed("grayscale-0",!0);const t=a.datum().ancestors();E(".link").style("stroke",(a=>t.includes(a.target)?"#EE4E34":"#ccc")).style("stroke-width",(a=>t.includes(a.target)?"2px":"1px")),E(".node").filter((a=>t.includes(a))).classed("grayscale-0",!0)}}function st(){$(X.value).select("svg").call(tt.transform,A),Z.transition().duration(750).attr("transform",`translate(${Q},${F}) scale(1)`),at.value=!1}function rt(){D.value=null,E(".node").classed("grayscale-0",!1),E(".link").style("stroke","#ccc").style("stroke-width","1px")}const lt=l();return(a,e)=>{const s=v,r=w,l=m,x=p;return n(),o(x,{class:"flex justify-center items-center relative",shape:"curved"},{default:i((()=>[d(at)?(n(),o(r,{key:0,size:"sm",onClick:st,class:"absolute top-3 right-3 z-50 shadow-md"},{default:i((()=>[c(s,{name:"fluent:resize-small-20-regular",class:"w-8 h-8"})])),_:1})):u("",!0),d(D)?(n(),o(x,{key:1,elevated:"",color:"white-contrast",class:"p-5 w-auto absolute top-3 left-3 mr-5 z-50"},{default:i((()=>[c(s,{name:"fluent:dismiss-24-regular",onClick:rt,class:"absolute top-1 right-1 w-4 h-4 cursor-pointer text-gray-500 dark:text-gray-400 hover:text-danger-500 dark:hover:text-danger-500"}),y("div",B,[y("img",{src:d(D).avatar??`/img/avatars/${d(D).level+1}.svg`,alt:"User Avatar",class:"rounded-full w-16 h-16"},null,8,R),y("div",null,[y("h3",q,g(d(D).first_name)+" "+g(d(D).last_name),1),y("p",I," Level: "+g(d(D).level),1)])]),y("div",N,[y("div",U,[O,y("span",S,g(d(D).referredCount),1)]),y("div",Y,[H,y("span",J,g(d(D).rewardsCount),1)]),t.isAdmin&&d(D).uuid!==t.uuid?(n(),o(l,{key:0,onClick:e[0]||(e[0]=t=>{return a=d(D).uuid,void lt.push(`/admin/extensions/affiliate/nodes/${a}`);var a}),color:"primary",class:"mt-5"},{default:i((()=>[f(" View Node ")])),_:1})):u("",!0)])])),_:1})):u("",!0),y("div",{class:"relative w-full overflow-hidden z-0 rounded-2xl h-[60vh]",ref_key:"networkContainer",ref:X},null,512)])),_:1})}}}),[["__scopeId","data-v-7911b9c7"]]);export{T as _};
