import{a as e,z as t,r as a,J as r,c as s,E as l,aL as o,as as n,ad as i,b as d,e as u,w as c,o as m,q as p,t as v,u as f,f as b,O as h,k as g,p as x,W as y,A as k,F as w,B,n as j,_ as P,x as _,X as C,Y as S}from"../e/entry-8qgg5CL-.js";import{_ as T}from"./BaseMessage.vue-Kpn2u5Rn.js";import{_ as V}from"./BaseInput.vue-iInHQMIA.js";import{_ as U}from"./BaseTextarea.vue-8st5U0qk.js";import{_ as D}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as F}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as $}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as z}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as I,a as E}from"./pages-sB5p2rcA.js";import{u as q}from"./composables-Om4eAUXX.js";import{u as R}from"./fetch-i3Y1jjTS.js";import{b as A}from"./strings-rQgUKePI.js";import{_ as L}from"./placeholder-file-IxKzOaSl.js";import{z as M,u as H,t as O,F as W}from"./vee-validate.esm-n59zZCC5.js";import{B as Y,s as G,p as K}from"./index-C_R1xG2s.js";import"./input-id-wZ-Ta08j.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";const J={class:"flex flex-col sm:flex-row gap-2 w-full"},X=["href"],N={class:"mb-4"},Q={class:"flex flex-col sm:flex-row w-full gap-5"},Z={class:"w-full sm:w-3/4 space-y-3"},ee={class:"w-full sm:w-1/4 mt-6"},te={class:"max-w-sm"},ae={key:0,class:"mb-4"},re=["src"],se=["onDrop"],le=["onClick","onKeydown"],oe={class:"p-5 text-center"},ne={class:"text-muted-400 font-sans text-sm"},ie={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},de={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},ue={key:1,class:"mt-6 space-y-2"},ce={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},me={class:"flex items-center gap-2"},pe={class:"shrink-0"},ve=["src"],fe={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:L,alt:"Image preview"},be={class:"font-sans"},he={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},ge={class:"text-muted-400 block text-xs"},xe={class:"flex gap-2"},ye={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},ke=b("span",{class:"sr-only"},"Cancel",-1),we={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},Be=b("span",{class:"sr-only"},"Upload",-1),je=["onClick"],Pe=b("span",{class:"sr-only"},"Remove",-1),_e=e({__name:"index",setup(e){const L=I(),_e=t(),Ce=_e.query.type,Se=_e.query.slug,Te=a("edit"===Ce),Ve=new Y,Ue=M.object({title:M.string().min(3,"The title must be at least 2 characters long").refine((e=>!Ve.isProfane(e)),"The title contains blacklisted words"),content:M.string().min(500,"The content must be at least 500 characters long").refine((e=>!Ve.isProfane(e)),"The content contains blacklisted words"),description:M.string().min(100,"The description must be at least 100 characters long").refine((e=>!Ve.isProfane(e)),"The description contains blacklisted words"),status:M.string().optional()}),De=O(Ue),Fe=a({title:"",content:"",description:"",status:"DRAFT"}),$e=["DRAFT","PUBLISHED"],{handleSubmit:ze,isSubmitting:Ie,meta:Ee,errors:qe,values:Re,setErrors:Ae,setFieldValue:Le}=H({validationSchema:De,initialValues:Fe}),Me=a(null),He=a(null);r(Me,(e=>{const t=e?.item(0)||null;if(Me.value){const e=new FileReader;e.onload=e=>{He.value=e.target?.result},e.readAsDataURL(t)}}));const Oe=s((()=>!Re.title||!Re.content||qe.title||qe.content)),We=a(null),Ye=q();l((async()=>{let e;0===L.pages.length&&await L.fetchPages(),L.currentPage=L.getPageBySlug(Se),e=Ye.isGreaterOrEquals("sm")?[["undo","redo"],["font","fontSize","formatBlock"],["paragraphStyle","blockquote"],["bold","underline","italic","strike","subscript","superscript"],["fontColor","hiliteColor","textStyle"],["removeFormat"],["outdent","indent"],["align","horizontalRule","list","lineHeight"],["table","link","image","video","audio"],["fullScreen","showBlocks","codeView"]]:[["font","fontSize","formatBlock"],["bold","underline","italic","strike","subscript","superscript"]],We.value=G.create("editor",{plugins:K,charCounter:!0,resizingBar:!0,imageFileInput:!1,buttonList:e}),Te.value&&(Fe.value={title:L.currentPage.title,content:L.currentPage.content,description:L.currentPage.description,status:L.currentPage.status},He.value=L.currentPage.image,We.value.setContents(L.currentPage.content)),We.value.onBlur=function(e,t){Le("content",e.srcElement.innerHTML)}})),o((()=>{We.value&&We.value.destroy()})),n((()=>{if(Ee.value.dirty)return confirm("You have unsaved changes. Are you sure you want to leave?")}));const{toast:Ge}=i(),Ke=a(!1),Je=s((()=>Object.keys(qe.value).length)),{createPage:Xe,updatePage:Ne}=E(),Qe=s((()=>Te.value?L.currentPage.image:"")),Ze=ze((async e=>{try{Ke.value=!1;const t={title:e.title,content:e.content,description:e.description,status:e.status,image:Te.value&&!Me.value?Qe.value:""};if(Me.value){const e=new FormData;e.append("files",Me.value[0]),e.append("type","page"),Te.value&&Qe.value&&e.append("oldImagePath",Qe.value);const a=await R("/api/upload",{method:"POST",body:e},"$CBkGHieaDz");a&&""!==a.data.value&&(t.image=a.data.value[0])}let a;a=Te.value?await Ne(L.currentPage?.id,t):await Xe(t),Ge.response(a)}catch(t){Ge.danger(t)}}));return(e,t)=>{const a=P,r=_,s=C,l=T,o=V,n=U,i=D,I=S,E=F,q=$,R=z;return m(),d("div",null,[u(R,null,{left:c((()=>[u(a,{as:"h3",size:"xl",weight:"semibold",class:"text-muted-800 dark:text-white"},{default:c((()=>[p(v(f(Te)?`Editing ${f(L).currentPage?.title} page`:"Create a new page"),1)])),_:1})])),right:c((()=>[b("div",J,[u(s,{color:"muted",class:"flex items-center gap-2",onClick:t[0]||(t[0]=t=>e.$router.back())},{default:c((()=>[u(r,{name:"mdi-light:arrow-left",class:"h-5 w-5"}),b("span",null,v(e.$t("Back")),1)])),_:1}),b("a",{href:`/page/${f(Se)}`,target:"_blank",class:"w-full"},[f(Te)?(m(),h(s,{key:0,color:"info",class:"flex items-center w-full"},{default:c((()=>[u(r,{name:"mdi-light:eye",class:"h-5 w-5"}),b("span",null,v(e.$t("View")),1)])),_:1})):g("",!0)],8,X),u(s,{color:f(Te)?"success":"primary",class:"flex items-center gap-2",disabled:f(Oe),onClick:f(Ze)},{default:c((()=>[u(r,{name:"mdi-light:content-save",class:"h-5 w-5"}),b("span",null,v(f(Te)?"Update":"Publish"),1)])),_:1},8,["color","disabled","onClick"])])])),default:c((()=>[b("div",N,[f(Ke)?(m(),h(l,{key:0,onClose:t[1]||(t[1]=e=>Ke.value=!1)},{default:c((()=>[p(v(e.$t("Your post has been published"))+"! ",1)])),_:1})):g("",!0),f(Je)>1?(m(),h(l,{key:1,type:"danger",onClose:t[2]||(t[2]=()=>f(Ae)({}))},{default:c((()=>[p(v(e.$t("This form has"))+" "+v(f(Je))+" "+v(e.$t("errors, please check them before submitting")),1)])),_:1})):g("",!0)]),b("div",Q,[b("div",Z,[u(f(W),{name:"title"},{default:c((({field:e,errorMessage:t,handleChange:a,handleBlur:r})=>[u(o,{"model-value":e.value,error:t,disabled:f(Ie),type:"text",shape:"rounded",placeholder:"Enter post title","onUpdate:modelValue":a,onBlur:r,label:"Post Title"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1}),u(f(W),{name:"content"},{default:c((({field:e,errorMessage:t,handleChange:a,handleBlur:r})=>[u(n,{id:"editor","model-value":e.value,error:t,disabled:f(Ie),shape:"rounded",rows:"15",placeholder:"Enter post content","color-focus":"","onUpdate:modelValue":a,onBlur:r,label:"Content"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1}),u(f(W),{name:"description"},{default:c((({field:e,errorMessage:t,handleChange:a,handleBlur:r})=>[u(n,{"model-value":e.value,error:t,disabled:f(Ie),shape:"rounded",rows:"3",placeholder:"Enter post description","color-focus":"","onUpdate:modelValue":a,onBlur:r,label:"Description"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})]),b("div",ee,[u(I,{shape:"rounded",class:"p-4 mb-5 space-y-5"},{default:c((()=>[u(f(W),{name:"status"},{default:c((({field:e,errorMessage:t,handleChange:a,handleBlur:r})=>[u(i,{"model-value":e.value,error:t,disabled:f(Ie),items:$e,placeholder:"Please select a status",label:"Status",shape:"rounded","onUpdate:modelValue":a,onBlur:r},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})])),_:1}),b("div",te,[f(He)?(m(),d("div",ae,[b("img",{src:f(He),alt:"Image Preview",class:"rounded-xl object-cover object-center"},null,8,re)])):g("",!0),u(q,{modelValue:f(Me),"onUpdate:modelValue":t[5]||(t[5]=e=>x(Me)?Me.value=e:null)},{default:c((({open:a,remove:s,preview:l,drop:o,files:n})=>[b("div",{class:"",onDragenter:t[3]||(t[3]=y((()=>{}),["stop","prevent"])),onDragover:t[4]||(t[4]=y((()=>{}),["stop","prevent"])),onDrop:o},[n?.length?(m(),d("ul",ue,[(m(!0),d(w,null,B(n,(t=>(m(),d("li",{key:t.name},[b("div",ce,[b("div",me,[b("div",pe,[t.type.startsWith("image")?(m(),d("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:l(t).value,alt:"Image preview"},null,8,ve)):(m(),d("img",fe))]),b("div",be,[b("span",he,v(t.name),1),b("span",ge,v(("formatFileSize"in e?e.formatFileSize:f(A))(t.size)),1)])]),b("div",{class:j(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[u(E,{value:0,size:"xs",color:"success"})]),b("div",xe,[b("button",ye,[u(r,{name:"lucide:slash",class:"h-4 w-4"}),ke]),b("button",we,[u(r,{name:"lucide:arrow-up",class:"h-4 w-4"}),Be]),b("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:y((e=>s(t)),["prevent"])},[u(r,{name:"lucide:x",class:"h-4 w-4"}),Pe],8,je)])])])))),128))])):(m(),d("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:a,onKeydown:k(y(a,["prevent"]),["enter"])},[b("div",oe,[u(r,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),b("h4",ne,v(e.$t("Drop file to upload")),1),b("div",null,[b("span",ie,v(e.$t("Or")),1)]),b("label",de,v(e.$t("Select Image")),1)])],40,le))],40,se)])),_:1},8,["modelValue"])])])])])),_:1})])}}});export{_e as default};
