import{a as e,ad as a,S as t,z as l,r as s,E as i,c as r,ac as u,J as d,o,b as n,e as m,w as c,t as f,q as p,f as v,u as h,F as x,n as g,k as w,B as b,O as y,p as _,_ as k,a0 as $,x as P,g as j,Y as V,X as z}from"../e/entry-8qgg5CL-.js";import{_ as q}from"./BaseButtonAction.vue-hzSHyI6o.js";import{_ as W}from"./BaseInput.vue-iInHQMIA.js";import{_ as B}from"./BaseTextarea.vue-8st5U0qk.js";import{_ as T}from"./BaseInputFile.vue-EMbXF6a8.js";import{_ as C}from"./BaseCheckbox.vue-cNhyVlDH.js";import{u as U}from"./wallet-n04aoRPe.js";import{u as F}from"./useWallet-8iHzU2hV.js";import{u as S}from"./fetch-i3Y1jjTS.js";import{f as M}from"./strings-rQgUKePI.js";import{u as A}from"./methods-1ZR1EQN-.js";import{z as E,u as I,F as Y,t as O}from"./vee-validate.esm-n59zZCC5.js";const L={class:"grid gap-8 grid-cols-1 lg:grid-cols-12 mb-20"},D={class:"border-muted-200 dark:border-muted-700 flex items-center justify-between gap-4 border-b px-8 py-5"},J={class:"ms-auto"},N=["onClick"],Q=["onClick"],R={class:"ms-4 text-sm font-medium"},X={key:0,class:"items-center justify-between gap-4 p-8 pt-4 grid grid-cols-1 md:grid-cols-2"},G={class:"max-w-xs"},H={class:"list-disc pl-5 text-muted-700 dark:text-muted-200 text-sm mt-4"},K={class:"grow"},Z=["src"],ee={key:1,class:"flex items-center justify-center p-8"},ae={class:"space-y-5"},te={key:0},le=["src"],se={key:1,class:"col-span-1 lg:col-span-5"},ie={class:"px-8 pt-5"},re={class:"mb-6"},ue={class:"nui-label pb-3 text-[0.825rem]"},de={key:0,class:"flex items-center"},oe={class:"ms-auto"},ne={class:"font-semibold"},me={key:1,class:"flex items-center mt-2"},ce={class:"ms-auto"},fe={class:"font-semibold"},pe={class:"border-muted-200 dark:border-muted-700 mt-4 border-t px-8 pt-5"},ve={class:"flex items-end justify-between"},he={class:"font-semibold"},xe={class:"my-4 flex items-center px-8"},ge={class:"flex flex-col px-8 pt-4"},we=e({__name:"index",props:{flutter:{type:Boolean,default:!1}},setup(e){const we=e,be=A(),ye=U(),{withdrawFiat:_e}=F(),{toast:ke}=a(),$e=t().getProfile,{getWallet:Pe}=F(),je=l(),Ve=s(null),ze=s(be.methods[0]??null);i((async()=>{try{const e=await Pe(je.params.uuid);Ve.value=e.data.result}catch(e){ke.danger(e)}0===be.methods.length&&await be.fetchWithdrawMethods(),ze.value=be.methods[0]}));const qe=E.object({amount:E.number().min(ze.value?.min_amount,"Amount must be greater than 0")}),We=O(qe),Be=r((()=>({amount:0|ze.value?.min_amount}))),{handleSubmit:Te,isSubmitting:Ce,values:Ue}=I({validationSchema:We,initialValues:Be}),Fe=s({inputs:[],textareas:[],files:[],previews:[]}),Se=r((()=>ze.value?.fixed_fee??0)),Me=r((()=>ze.value?.percentage_fee??0)),Ae=r((()=>Ue.amount*(Me.value/100)+Se.value)),Ee=r((()=>Ue.amount+Ae.value)),Ie=s(!1),Ye=u(),Oe=async(e,a="custom")=>{const t=new FormData;t.append("files",e),t.append("type",a);const l=await S("/api/upload",{method:"POST",body:t},"$39caYWoQLf");return l&&""!==l.data.value?l.data.value[0]:""};d(Fe.value.files,(async e=>{for(let a=0;a<e.length;a++){const t=e[a];if(t&&"object"==typeof t&&t[0]instanceof File){const e=t[0],l=await Oe(e);Fe.value.previews[a]=l}}}));const Le=r((()=>{const e=[];return ze.value?.custom_fields.forEach(((a,t)=>{let l;"input"===a.type&&(l=Fe.value.inputs[t]),"textarea"===a.type&&(l=Fe.value.textareas[t]),"file upload"===a.type&&(l=Fe.value.previews[t]),e.push({type:a.type,title:a.title,value:l})})),e})),De=Te((async e=>{if(ze.value&&Ve.value&&$e.uuid&&je.params.uuid&&Ie.value){if(ze.value.min_amount>e.amount)return ke.warning(`Minimum withdraw amount is ${M(ze.value.min_amount,Ve.value.currency)}`);if(ze.value.max_amount<e.amount)return ke.warning(`Maximum withdraw amount is ${M(ze.value.max_amount,Ve.value.currency)}`);if(Ee.value>Ve.value.balance)return ke.warning("You don't have enough balance to withdraw this amount");if(ze.value.custom_fields.length>0)for(let e=0;e<ze.value.custom_fields.length;e++){const a=ze.value.custom_fields[e];if(a.required){if("input"===a.type&&!Fe.value.inputs[e])return ke.warning(`Please fill in the ${a.title} field`);if("textarea"===a.type&&!Fe.value.textareas[e])return ke.warning(`Please fill in the ${a.title} field`);if("file upload"===a.type&&!Fe.value.files[e])return ke.warning(`Please fill in the ${a.title} field`)}}Ce.value=!0;try{const a=await _e(je.params.uuid,ze.value.id,e.amount,Ee.value,Le.value);ke.response(a),"success"===a.status&&(Ce.value=!1,await ye.fetchWallets(),Ye.push(`/user/${we.flutter?"flutter/":""}wallets/fiat`))}catch(a){ke.danger(a),Ce.value=!1}}}));return(a,t)=>{const l=k,s=$,i=P,r=q,u=j,d=V,U=W,F=B,S=T,A=C,E=z;return o(),n("form",L,[m(d,{class:"col-span-1 lg:col-span-12"},{default:c((()=>[v("div",D,[v("div",null,[m(l,{as:"h3",size:"sm",weight:"medium"},{default:c((()=>[p(f(a.$t("Withdraw method")),1)])),_:1}),m(s,{size:"xs",class:"text-muted-400"},{default:c((()=>[p(f(a.$t("Select a withdraw method")),1)])),_:1})]),v("div",J,[m(r,{to:`/user/${e.flutter?"flutter/":""}wallets/fiat`},{default:c((()=>[m(i,{name:"lucide:arrow-left",class:"h-3 w-3"}),v("span",null,f(a.$t("Cancel")),1)])),_:1},8,["to"])])]),h(be).methods.length>0?(o(!0),n(x,{key:0},b(h(be).methods,((e,t)=>(o(),n("div",{key:t,class:"border-muted-200 dark:border-muted-700 border-t",onClick:a=>ze.value=e},[v("div",{role:"button",class:g(["flex cursor-pointer items-center px-8 py-5",h(ze)?.id===e.id?"bg-muted-50 dark:bg-muted-900/60":""]),onClick:a=>h(ze)?.id===e.id},[v("div",{class:g(["dark:border-muted-800 h-4 w-4 rounded-full border-2 border-white ring-2",h(ze)?.id===e.id?"bg-primary-600 ring-primary-600":"ring-muted-400"])},null,2),v("label",R,f(e.title),1)],10,Q),h(ze)?.id===e.id?(o(),n("div",X,[v("div",G,[m(l,{as:"h3",size:"md",weight:"medium",class:"mb-2"},{default:c((()=>[p(f(a.$t("Withdraw with"))+" "+f(e.title),1)])),_:2},1024),m(u,{size:"sm",class:"text-muted-400"},{default:c((()=>[p(f(a.$t('After clicking on "Withdraw", your request will be sent to our team for approval. You will receive an email notification once your request has been approved'))+". ",1)])),_:1}),v("ul",H,[v("li",null,f(a.$t("Minimum Withdraw"))+": "+f(("formatPrice"in a?a.formatPrice:h(M))(h(ze)?.min_amount,h(Ve)?.currency)),1),v("li",null,f(a.$t("Maximum Withdraw"))+": "+f(("formatPrice"in a?a.formatPrice:h(M))(h(ze)?.max_amount,h(Ve)?.currency)),1),v("li",null,f(a.$t("Processing Time"))+": "+f(h(ze)?.processing_time),1)])]),v("div",K,[v("img",{src:e.image,height:"180"},null,8,Z)])])):w("",!0)],8,N)))),128)):(o(),n("div",ee,[m(s,{size:"sm",class:"text-muted-400"},{default:c((()=>[p(f(a.$t("No withdraw methods available")),1)])),_:1})]))])),_:1}),h(ze)?(o(),y(d,{key:0,class:"col-span-1 lg:col-span-7 p-5"},{default:c((()=>[m(l,{as:"h3",size:"sm",weight:"medium",class:"mb-2"},{default:c((()=>[p(f(a.$t("Withdrawal Instructions")),1)])),_:1}),v("div",ae,[m(s,null,{default:c((()=>[p(f(h(ze)?.instructions),1)])),_:1}),(o(!0),n(x,null,b(h(ze)?.custom_fields,((e,a)=>(o(),n(x,{key:a},["input"===e.type?(o(),y(U,{key:0,modelValue:h(Fe).inputs[a],"onUpdate:modelValue":e=>h(Fe).inputs[a]=e,label:e.title,placeholder:e.title,type:e.type,required:e.required,classes:{input:"mt-2",label:"text-xs"}},null,8,["modelValue","onUpdate:modelValue","label","placeholder","type","required"])):"textarea"===e.type?(o(),y(F,{key:1,modelValue:h(Fe).textareas[a],"onUpdate:modelValue":e=>h(Fe).textareas[a]=e,label:e.title,placeholder:e.title,required:e.required,classes:{input:"mt-2",label:"text-xs"}},null,8,["modelValue","onUpdate:modelValue","label","placeholder","required"])):"file upload"===e.type?(o(),n(x,{key:2},[m(S,{modelValue:h(Fe).files[a],"onUpdate:modelValue":e=>h(Fe).files[a]=e,label:e.title,required:e.required,classes:{input:"mt-2",label:"text-xs"}},null,8,["modelValue","onUpdate:modelValue","label","required"]),h(Fe).previews[a]?(o(),n("div",te,[v("img",{src:h(Fe).previews[a],alt:"File preview",height:"180"},null,8,le)])):w("",!0)],64)):w("",!0)],64)))),128))])])),_:1})):w("",!0),h(ze)?(o(),n("div",se,[m(d,{class:"pb-6"},{default:c((()=>[v("div",ie,[v("div",re,[v("label",ue,f(a.$t("Withdraw amount")),1),m(h(Y),{name:"amount"},{default:c((({field:e,errorMessage:a,handleChange:t,handleBlur:l})=>[m(U,{"model-value":e.value,error:a,disabled:h(Ce),label:"Amount",type:"number",placeholder:"Enter amount","onUpdate:modelValue":t,onBlur:l},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})]),h(ze)?.fixed_fee>0?(o(),n("div",de,[m(l,{as:"h3",size:"sm",weight:"medium",lead:"none"},{default:c((()=>[p(f(a.$t("Flat Tax")),1)])),_:1}),v("div",oe,[m(s,{size:"sm",class:"text-muted-800 dark:text-muted-100"},{default:c((()=>[v("span",ne,f(("formatPrice"in a?a.formatPrice:h(M))(h(Se),h(Ve)?.currency)),1)])),_:1})])])):w("",!0),h(ze)?.percentage_fee>0?(o(),n("div",me,[m(l,{as:"h3",size:"sm",weight:"medium",lead:"none"},{default:c((()=>[p(f(a.$t("Percentage Tax")),1)])),_:1}),v("div",ce,[m(s,{size:"sm",class:"text-muted-800 dark:text-muted-100"},{default:c((()=>[v("span",fe,f(h(Me))+"%",1)])),_:1})])])):w("",!0)]),v("div",pe,[v("div",ve,[m(l,{as:"h3",size:"sm",weight:"medium",lead:"none"},{default:c((()=>[p(f(a.$t("To withdraw today"))+" ("+f(h(Ve)?.currency)+") ",1)])),_:1}),m(s,{size:"md",class:"text-muted-800 dark:text-muted-100"},{default:c((()=>[v("span",he,f(("formatPrice"in a?a.formatPrice:h(M))(h(Ee),h(Ve)?.currency)),1)])),_:1})]),h(ze)?.percentage_fee>0||h(ze)?.fixed_fee>0?(o(),y(s,{key:0,class:"text-muted-500 dark:text-muted-400 mt-2 text-xs"},{default:c((()=>[p(f(h(ze)?.percentage_fee>0?`Taxes are calculated at a flat rate of ${h(ze)?.percentage_fee}%`:"")+" "+f(h(ze)?.percentage_fee>0&&h(ze)?.fixed_fee>0?`,plus a fixed fee of ${("formatPrice"in a?a.formatPrice:h(M))(h(ze)?.fixed_fee,h(Ve)?.currency)}.`:h(ze)?.fixed_fee>0?`A fixed fee of ${("formatPrice"in a?a.formatPrice:h(M))(h(ze)?.fixed_fee,h(Ve)?.currency)} will be applied.`:"")+" "+f(a.$t("This amount has been included in your total"))+". ",1)])),_:1})):w("",!0)]),v("div",xe,[m(A,{modelValue:h(Ie),"onUpdate:modelValue":t[0]||(t[0]=e=>_(Ie)?Ie.value=e:null),color:"primary",shape:"full",label:"I agree to the Terms Of Service",classes:{label:"relative top-0.5 text-xs"}},null,8,["modelValue"])]),v("div",ge,[m(E,{color:"primary",class:"!h-12 w-full",onClick:h(De),disabled:!h(Ie)||h(Ce),loading:h(Ce)},{default:c((()=>[p(f(a.$t("Withdraw")),1)])),_:1},8,["onClick","disabled","loading"])])])),_:1})])):w("",!0)])}}});export{we as _};
