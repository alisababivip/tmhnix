import{a as e,c as a,o as s,b as o,f as r,F as t,B as l,n as d,t as n,O as u,u as i,x as c,cL as p,S as m,r as v,as as w,ad as g,e as h,w as f,W as b,Y as _,q as y,k as x,_ as k,a0 as C,X as j}from"../e/entry-8qgg5CL-.js";import{_ as B}from"./BaseMessage.vue-Kpn2u5Rn.js";import{_ as T}from"./BaseInput.vue-iInHQMIA.js";import{_ as S}from"./TairoFormGroup.vue--3qC-osX.js";import{_ as $}from"./TairoFormSave.vue-aLVbwikq.js";import{z as N,u as P,t as V,F}from"./vee-validate.esm-n59zZCC5.js";import"./input-id-wZ-Ta08j.js";const I={class:"group/password-strength relative cursor-pointer"},L={class:"border-muted-200 dark:border-muted-700 shadow-muted-300/30 dark:shadow-muted-800/20 dark:bg-muted-800 pointer-events-none absolute left-0 top-4 z-20 rounded-lg border bg-white p-6 opacity-0 shadow-xl transition-opacity duration-300 group-hover/password-strength:pointer-events-auto group-hover/password-strength:opacity-100"},U={class:"flex flex-col gap-4"},q={class:"w-7"},z={class:"-mx-1 flex"},M=["data-nui-tooltip"],O=e({__name:"TairoPasswordStrength",props:{value:{default:""},minLength:{default:8},goodLength:{default:20}},setup(e){const p=e,m=a((()=>/[A-Z]/.test(p.value)??!1)),v=a((()=>/[a-z]/.test(p.value)??!1)),w=a((()=>/[!"#$%&\'()*+,-.\/:;<=>?@[\\\]\^_`{\|}~]/.test(p.value)??!1)),g=a((()=>/[0-9]/.test(p.value)??!1)),h=a((()=>p.value.length>=p.minLength)),f=a((()=>p.value.length>=p.goodLength));a((()=>h.value?Number(m.value)+Number(v.value)+Number(w.value)+Number(g.value)+Number(h.value)+Number(f.value):0));const b=a((()=>[{label:`Contains minimum ${p.minLength} characters`,valid:h.value},{label:`Contains at least ${p.goodLength} characters`,valid:f.value},{label:"Contains lowercase characters",valid:v.value},{label:"Contains uppercase characters",valid:m.value},{label:"Contains numbers",valid:g.value},{label:"Contains special characters",valid:w.value}]));return(e,a)=>{const p=c;return s(),o("div",I,[r("div",L,[r("ul",U,[(s(!0),o(t,null,l(i(b),(e=>(s(),o("li",{key:e.label,class:"flex items-center justify-between gap-6"},[r("span",{class:d(["grow text-xs dark:text-slate-400",[!e.valid&&"dark:text-slate-350 font-semibold",e.valid&&"dark:text-slate-200"]])},n(e.label),3),r("span",q,[e.valid?(s(),u(p,{key:0,name:"ion:checkmark-circle-outline",class:"text-success-400 dark:text-success-500 h-4 w-4"})):(s(),u(p,{key:1,name:"ion:close-circle-outline",class:"text-danger-400 dark:text-danger-500 h-4 w-4"}))])])))),128))])]),r("div",z,[(s(!0),o(t,null,l(i(b),(e=>(s(),o("div",{key:e.label,class:"w-1/5 px-1"},[r("div",{class:d(["h-2 rounded-xl transition-colors",e.valid?"bg-success-500":"bg-danger-500"]),"data-nui-tooltip":e.label.replace("Contains","")},null,10,M)])))),128))])])}}}),R={class:"flex items-center justify-between p-4"},Z={class:"flex items-center gap-2"},E={class:"p-4"},Y={class:"mx-auto max-w-lg space-y-12 py-8"},A={class:"grid grid-cols-12 gap-4"},G={class:"col-span-12"},J={class:"col-span-12"},W={class:"col-span-12"},X=e({__name:"security",setup(e){const{updateProfile:t}=p(),l=m().getProfile;l.uuid;const d="Password must be at least 8 characters",c="Passwords do not match",I=N.object({current_password:N.string().optional(),new_password:N.string().optional(),confirm_password:N.string().optional(),notifications:N.object({enabled:N.boolean()})}).superRefine(((e,a)=>{e.current_password&&(e.new_password?e.new_password.length<8?a.addIssue({code:N.ZodIssueCode.custom,message:d,path:["new_password"]}):e.new_password!==e.confirm_password&&a.addIssue({code:N.ZodIssueCode.custom,message:c,path:["confirm_password"]}):a.addIssue({code:N.ZodIssueCode.custom,message:"New password is required when changing password.",path:["new_password"]}))})),L=V(I),U=a((()=>({current_password:"",new_password:"",confirm_password:"",notifications:{enabled:l.notifications?.enabled||!1}}))),{handleSubmit:q,isSubmitting:z,meta:M,errors:X,resetForm:D,setFieldValue:H,setErrors:K}=P({validationSchema:L,initialValues:U}),Q=v(!1),ee=a((()=>Object.keys(X.value).length));w((()=>{if(M.value.dirty)return confirm("You have unsaved changes. Are you sure you want to leave?")}));const{toast:ae}=g(),se=q((async e=>{if(Q.value=!1,e.current_password)if(e.new_password)if(e.confirm_password)if(e.new_password===e.confirm_password)try{const a=await t(void 0,void 0,void 0,void 0,void 0,e.current_password,e.new_password);ae.response(a),"success"===a.status&&(H("current_password",""),H("new_password",""),H("confirm_password",""),Q.value=!0,setTimeout((()=>{Q.value=!1}),3e3))}catch(a){ae.danger(a)}else ae.dangerText("Passwords do not match");else ae.dangerText("Confirm password is required");else ae.dangerText("New password is required");else ae.dangerText("Current password is required")}),(e=>{Q.value=!1,document.documentElement.scrollTo({top:0,behavior:"smooth"})}));return(e,a)=>{const t=k,l=C,d=j,c=B,p=T,m=O,v=S,w=_,g=$;return s(),o("form",{method:"POST",action:"",class:"w-full pb-16",onSubmit:a[2]||(a[2]=b(((...e)=>i(se)&&i(se)(...e)),["prevent"]))},[h(w,null,{default:f((()=>[r("div",R,[r("div",null,[h(t,{tag:"h2",size:"sm",weight:"medium",lead:"normal",class:"uppercase tracking-wider"},{default:f((()=>[y(n(e.$t("Security")),1)])),_:1}),h(l,{size:"xs",class:"text-muted-400"},{default:f((()=>[y(n(e.$t("Edit your account prefs and settings")),1)])),_:1})]),r("div",Z,[h(d,{class:"w-24",to:"/user/profile-edit"},{default:f((()=>[y(n(e.$t("Cancel")),1)])),_:1}),h(d,{type:"submit",color:"primary",class:"w-24",disabled:i(z),loading:i(z)},{default:f((()=>[y(n(e.$t("Save")),1)])),_:1},8,["disabled","loading"])])]),r("div",E,[r("div",Y,[i(Q)?(s(),u(c,{key:0,onClose:a[0]||(a[0]=e=>Q.value=!1)},{default:f((()=>[y(n(e.$t("Your settings has been saved"))+"! ",1)])),_:1})):x("",!0),i(ee)?(s(),u(c,{key:1,type:"danger",onClose:a[1]||(a[1]=()=>i(K)({}))},{default:f((()=>[y(n(e.$t("This form has"))+" "+n(i(ee))+" "+n(e.$t("errors, please check them before submitting")),1)])),_:1})):x("",!0),h(v,{label:"Change Password",sublabel:"For an improved account security"},{default:f((()=>[r("div",A,[r("div",G,[h(i(F),{name:"current_password"},{default:f((({field:e,errorMessage:a,handleChange:s,handleBlur:o})=>[h(p,{"model-value":e.value,error:a,disabled:i(z),type:"password",icon:"ph:lock-duotone",placeholder:"Old password",autocomplete:"current-password","onUpdate:modelValue":s,onBlur:o},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})]),r("div",J,[h(i(F),{name:"new_password"},{default:f((({field:e,errorMessage:a,handleChange:o,handleBlur:r})=>[h(p,{"model-value":e.value,error:a,disabled:i(z),type:"password",icon:"ph:lock-duotone",placeholder:"New password",autocomplete:"new-password","onUpdate:modelValue":o,onBlur:r},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"]),""!=e.value?(s(),u(m,{key:0,class:"mt-1",value:e.value,"min-length":8},null,8,["value"])):x("",!0)])),_:1})]),r("div",W,[h(i(F),{name:"confirm_password"},{default:f((({field:e,errorMessage:a,handleChange:s,handleBlur:o})=>[h(p,{"model-value":e.value,error:a,disabled:i(z),type:"password",icon:"ph:lock-duotone",placeholder:"Repeat new password","onUpdate:modelValue":s,onBlur:o},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})])])])),_:1})])])])),_:1}),h(g,{disabled:i(z),loading:i(z),onReset:i(D)},null,8,["disabled","loading","onReset"])],32)}}});export{X as default};
