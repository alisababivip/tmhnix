import{a as e,r as a,ap as s,z as t,c as l,at as c,ad as n,E as o,b as u,u as i,F as r,f as d,e as p,w as v,t as m,O as f,_ as y,Y as x,o as h,q as g,p as _,k as w,x as k,X as b}from"../e/entry-8qgg5CL-.js";import{_ as $}from"./BaseIconBox.vue-qjQCKz6R.js";import{_ as E}from"./BaseInput.vue-iInHQMIA.js";import{_ as j}from"./BaseMessage.vue-Kpn2u5Rn.js";import{_ as C}from"./TairoContentWrapper.vue-JqAKR4O_.js";import"./input-id-wZ-Ta08j.js";const U={key:0,class:"h-[calc(80vh)] flex justify-center items-center"},V={class:"my-auto text-center flex-col justify-center space-y-5"},B={class:"text-2xl font-bold"},P={key:1,class:"mx-auto w-full max-w-5xl flex-col px-4 text-start"},I={class:"mt-8"},A={key:0,class:"h-[calc(80vh)] flex justify-center items-center"},L={class:"my-auto text-center flex-col justify-center space-y-5"},z={class:"text-2xl font-bold"},M={class:"flex items-center justify-end space-x-5"},T={class:"text-start mx-auto max-w-2xl space-y-5 mb-20"},H={key:1,class:"space-y-5"},q={class:"text-gray-800 dark:text-gray-200 font-semibold text-lg"},D=["innerHTML"],F=e({__name:"[id]",setup(e){const F=a({status:!1,version:"",release_date:"",summery:"",changelog:null,update_id:"",message:""}),N=s(),O=t(),S=l((()=>N.selectedExtension)),W=a(""),X=a(""),Y=a(!1),G=a(!1),J=a(!1),K=a(!1),Q=a(!1),R=a(!0),{activateLicense:Z,checkUpdate:ee,downloadUpdate:ae,verifyLicense:se,updateExtensionStatus:te}=c(),{toast:le}=n(),ce=async()=>{J.value=!0;try{const e=await ae(S.value?.product_id,F.value.update_id,F.value.version,S.value?.name,"extension");le.response(e),"success"===e.status&&(N.selectedExtension.version=F.value.version,await ne())}catch(e){le.danger(e)}J.value=!1},ne=async()=>{try{const e=await ee(S.value?.product_id,S.value?.version);F.value=e.data.result,F.value.message=e.data.message}catch(e){le.danger(e)}R.value=!1};o((async()=>{0===N.extensions.length&&await N.fetchExtensions(),N.getExtensionById(O.params.id);try{await oe()}catch(e){le.danger(e)}}));const oe=async()=>{G.value=!0;try{const e=await se(S.value?.product_id);Q.value="success"===e.status,K.value=!Q.value,await ne()}catch(e){le.danger(e)}G.value=!1};return(e,a)=>{const s=k,t=$,l=y,c=E,n=b,o=x,O=j,ee=C;return h(),u("div",null,[i(K)?(h(),u(r,{key:0},[i(G)?(h(),u("div",U,[d("div",V,[p(t,{size:"2xl",shape:"full",color:"primary"},{default:v((()=>[p(s,{name:"svg-spinners:blocks-shuffle-3",class:"h-12 w-12"})])),_:1}),d("h1",B,m(e.$t("Verifying your purchase code"))+"... ",1),d("p",null,m(e.$t("Please wait while we verify your purchase code"))+".",1)])])):(h(),u("div",P,[p(l,{class:"text-center"},{default:v((()=>[g(m(e.$t("Activate"))+" "+m(i(S)?.title)+" "+m(e.$t("purchase code")),1)])),_:1}),p(o,{class:"mt-8 p-5 max-w-md mx-auto space-y-5"},{default:v((()=>[p(c,{modelValue:i(W),"onUpdate:modelValue":a[0]||(a[0]=e=>_(W)?W.value=e:null),type:"text",label:"Purchase Code",placeholder:"Enter your purchase code"},null,8,["modelValue"]),p(c,{modelValue:i(X),"onUpdate:modelValue":a[1]||(a[1]=e=>_(X)?X.value=e:null),type:"text",label:"Envato Username",placeholder:"Enter your Envato username"},null,8,["modelValue"]),d("div",I,[p(n,{color:"primary",class:"w-full",onClick:a[2]||(a[2]=e=>(async()=>{Y.value=!0;try{const e=await Z(S.value?.product_id,W.value,X.value);le.response(e),"success"===e.status&&(Q.value=!0,K.value=!1)}catch(e){le.danger(e)}Y.value=!1})()),disabled:i(Y),loading:i(Y)},{default:v((()=>[d("span",null,m(e.$t("Activate")),1)])),_:1},8,["disabled","loading"])])])),_:1})]))],64)):(h(),u(r,{key:1},[i(R)?(h(),u("div",A,[d("div",L,[p(t,{size:"2xl",shape:"full",color:"info"},{default:v((()=>[p(s,{name:"svg-spinners:blocks-shuffle-3",class:"h-12 w-12"})])),_:1}),d("h1",z,m(e.$t("Checking for updates"))+"... ",1),d("p",null,m(e.$t("Please wait while we check for updates"))+".",1)])])):(h(),f(ee,{key:1},{left:v((()=>[p(l,{class:"text-center"},{default:v((()=>[g(m(i(S)?.title)+" "+m(e.$t("Extension")),1)])),_:1})])),right:v((()=>[d("div",M,[p(n,{color:"muted",to:"/admin/system/extensions"},{default:v((()=>[p(s,{name:"line-md:chevron-left",class:"h-4 w-4 mr-1"}),g(" "+m(e.$t("Back")),1)])),_:1}),i(Q)?w("",!0):(h(),f(n,{key:0,color:"primary",onClick:a[3]||(a[3]=e=>K.value=!0)},{default:v((()=>[g(m(e.$t("Activate Purchase Code")),1)])),_:1})),p(n,{color:i(S)?.status?"danger":"success",onClick:a[4]||(a[4]=e=>(async()=>{Y.value=!0;try{const e=!0!==S.value?.status,a=await te(S.value?.product_id,e);le.response(a),"success"===a.status&&(N.selectedExtension.status=e)}catch(e){console.log(e),le.danger(e)}Y.value=!1})()),loading:i(Y)},{default:v((()=>[p(s,{name:i(S)?.status?"line-md:close":"line-md:confirm",class:"h-4 w-4 mr-1"},null,8,["name"]),g(" "+m(i(S)?.status?e.$t("Deactivate"):e.$t("Activate")),1)])),_:1},8,["color","loading"])])])),default:v((()=>[d("div",T,[i(F).status&&"0.0.1"!==i(S)?.version?(h(),f(O,{key:0,type:"info",icon:""},{default:v((()=>[g(m(e.$t("Please backup your database and script files before upgrading"))+".",1)])),_:1})):w("",!0),p(O,null,{default:v((()=>[g(m(i(F).message),1)])),_:1}),i(F).status?(h(),u("div",H,["0.0.1"!==i(S)?.version?(h(),f(o,{key:0,class:"p-5 space-y-5"},{default:v((()=>[d("span",q,m(e.$t("Update Notes")),1),d("div",{class:"pl-5 post-body changelog text-start",innerHTML:i(F).changelog},null,8,D)])),_:1})):w("",!0),p(n,{onClick:ce,color:i(Q)?"success":"danger",class:"w-full",type:"submit",disabled:!i(Q)||""===i(F).update_id||i(J),loading:i(J)},{default:v((()=>[g(m(i(Q)?"0.0.1"===i(S)?.version?"Install":"Update":"Invalid Purchase Code"),1)])),_:1},8,["color","disabled","loading"])])):w("",!0)])])),_:1}))],64))])}}});export{F as default};
