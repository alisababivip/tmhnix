import{a as e,c as s,z as a,r as t,E as l,J as o,ad as n,as as r,G as c,b as i,u as d,f as u,e as p,w as m,t as f,k as y,O as v,a3 as h,X as x,o as w,q as g,p as b,F as k,x as T,_,Y as j}from"../e/entry-8qgg5CL-.js";import{_ as C}from"./BaseIconBox.vue-qjQCKz6R.js";import{_ as $}from"./TairoCheckAnimated-O9EoNlM1.js";import{_ as E}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as D}from"./BaseInput.vue-iInHQMIA.js";import{_ as P}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as L}from"./useEcosystem-9eBUNbsT.js";import{Q as O}from"./index-m04Or-0K.js";import{u as B}from"./socket-uQEypT2z.js";import{u as z}from"./user-csCQGhQS.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./input-id-wZ-Ta08j.js";import"./tslib.es6-scKrN6qS.js";import"./browser-cZJfsddk.js";const A={key:0},I={class:"my-auto text-center flex-col justify-center space-y-5"},S={class:"text-2xl font-bold"},U={key:1},F={class:"my-auto text-center flex-col justify-center space-y-5"},M={class:"text-2xl font-bold"},V={key:2},G={class:"my-auto text-center flex-col justify-center space-y-5"},N={class:"text-2xl font-bold"},W={class:"space-y-5 min-h-screen pb-20"},R=u("hr",{class:"border-gray-200 dark:border-gray-700"},null,-1),Y={class:"grid gap-5 grid-cols-1 sm:grid-cols-12 pl-8"},H={class:"flex items-end gap-5"},Q={class:"w-full"},X={key:0,class:"pl-8 text-danger-600 dark:text-danger-500 text-sm mt-2"},q={class:"list-disc"},J={class:"list-disc"},K={key:0,class:"flex items-center justify-center h-80"},Z={class:"text-center space-y-5"},ee={class:"text-lg font-bold"},se={key:1,class:"flex items-center justify-center h-80"},ae={class:"text-center space-y-5"},te=u("p",{class:"text-lg font-bold"},"Connecting...",-1),le=e({__name:"[currency]",setup(e){const le=z(),oe=s((()=>le.items.find((e=>e.currency===ne.params.currency.toUpperCase())))),ne=a(),re=B(),ce=ne.params.currency.toUpperCase(),{getWallet:ie,getDepositAddress:de,unlockDepositAddress:ue}=L(),pe=t(null),me=t(""),fe=t(null),ye=t(!1);l((async()=>{const e=await ie(ce);e.data.result&&(pe.value=e.data.result),0===le.items.length&&await le.fetchCurrencies(),window.addEventListener("beforeunload",Te)}));const ve=s((()=>"NO_PERMIT"===oe.value?.contractType?me.value:fe.value?pe.value?.addresses[fe.value]?.address:"")),he=t(""),xe=e=>["BTC","LTC","DOGE","DASH"].includes(e);o(fe,(async(e,s)=>{if(s){let e;"NO_PERMIT"===oe.value?.contractType?(e=me.value,_e()):e=pe.value?.addresses[s]?.address,e&&(re.unsubscribe("deposits",{chain:s,address:e,uuid:pe.value?.uuid,currency:ce,ct:oe.value?.contractType}),re.depositConnected=!1)}if(e){let s;if("NO_PERMIT"===oe.value?.contractType){const a=await de(e);a.error&&"Failed to fetch deposit address: No available wallets"===a.error.message&&(he.value="Deposit not available now for this chain, try again later or try another chain"),a.data?.result&&(me.value=a.data.result,he.value=""),s=me.value}else s=pe.value?.addresses[e]?.address;s&&(ye.value||(re.createSocket("deposits"),ye.value=!0),re.subscribe("deposits",{chain:e,address:s,uuid:pe.value?.uuid,currency:ce,ct:oe.value?.contractType}))}}));const we=s((()=>re.deposits)),{toast:ge}=n(),be=()=>{navigator.clipboard.writeText(ve.value).then((()=>{ge.info("Address copied to clipboard")}),(e=>{ge.warning("Failed to copy address to clipboard")}))},ke=s((()=>pe.value?.addresses?Object.keys(pe.value.addresses).map((e=>e)):[]));function Te(){try{re.unsubscribe("deposits",{chain:fe.value,address:ve.value,uuid:pe.value?.uuid,currency:ce,ct:oe.value?.contractType}),re.closeSocket("deposits"),console.log("Socket closed")}catch(e){console.log(e)}_e()}function _e(){me.value&&ue(me.value)}return o((()=>re.deposits),((e,s)=>{!e||"COMPLETED"!==e.status&&"FAILED"!==e.status||Te()}),{deep:!0}),r(((e,s,a)=>{Te(),re.deposits=null,ye.value=!1,a()})),c((()=>{window.removeEventListener("beforeunload",Te),Te()})),(e,s)=>{const a=T,t=C,l=$,o=h("UserWalletUtxoTransactionDetailsCard"),n=h("UserWalletEvmTransactionDetailsCard"),r=x,c=_,L=E,B=D,z=j,le=P;return w(),i("div",null,[d(we)&&!d(we).status?(w(),i("div",A,[u("div",I,[p(t,{size:"2xl",shape:"full",color:"info"},{default:m((()=>[p(a,{name:"svg-spinners:blocks-shuffle-3",class:"h-12 w-12"})])),_:1}),u("h1",S,f(e.$t("Processing Transaction"))+"... ",1),u("p",null,f(e.$t("Transaction received. Please wait while we process it, it may take a few minutes."))+". ",1)])])):y("",!0),d(we)&&"COMPLETED"===d(we).status?(w(),i("div",U,[u("div",F,[p(t,{size:"2xl",shape:"full",color:"success"},{default:m((()=>[p(l,{color:"success",size:"lg"})])),_:1}),u("h1",M,f(e.$t("Payment Successful"))+"!",1),u("p",null,f(e.$t("Your transaction has been processed successfully. Here are the details"))+": ",1),xe(d(fe))?(w(),v(o,{key:0,transaction:d(we),currency:d(ce),chain:d(fe)},null,8,["transaction","currency","chain"])):(w(),v(n,{key:1,transaction:d(we),currency:d(ce),chain:d(fe)},null,8,["transaction","currency","chain"])),p(r,{to:`/user/wallets/funding/${d(ce).toLowerCase()}`,color:"primary",flaver:"pastel"},{default:m((()=>[p(a,{name:"line-md:chevron-left",class:"h-4 w-4"}),u("span",null,f(e.$t("Go Back")),1)])),_:1},8,["to"])])])):d(we)&&"FAILED"===d(we).status?(w(),i("div",V,[u("div",G,[p(t,{size:"2xl",shape:"full",color:"danger"},{default:m((()=>[p(a,{name:"line-md:close",class:"h-16 w-16"})])),_:1}),u("h1",N,f(e.$t("Payment Failed"))+"!",1),u("p",null,f(e.$t("There was an issue processing your payment. You can check the details below"))+". ",1),xe(d(fe))?(w(),v(o,{key:0,transaction:d(we),currency:d(ce),chain:d(fe)},null,8,["transaction","currency","chain"])):(w(),v(n,{key:1,transaction:d(we),currency:d(ce),chain:d(fe)},null,8,["transaction","currency","chain"])),p(r,{to:`/user/wallets/funding/${d(ce).toLowerCase()}`,color:"primary",flaver:"pastel"},{default:m((()=>[p(a,{name:"line-md:chevron-left",class:"h-4 w-4"}),u("span",null,f(e.$t("Go Back")),1)])),_:1},8,["to"])])])):y("",!0),d(we)?.hash?y("",!0):(w(),v(le,{key:3},{left:m((()=>[p(c,{size:"xl"},{default:m((()=>[g(f(d(ce))+" "+f(e.$t("Deposit")),1)])),_:1})])),right:m((()=>[u("div",null,[p(r,{to:`/user/wallets/funding/${d(ce).toLowerCase()}`,color:"muted",flavor:"pastel"},{default:m((()=>[p(a,{name:"line-md:chevron-left",class:"h-4 w-4"}),u("span",null,f(e.$t("Back")),1)])),_:1},8,["to"])])])),default:m((()=>[u("div",W,[u("div",null,[p(c,{as:"h3",size:"2xl",weight:"bold",class:"text-muted-800 dark:text-white items-center flex"},{default:m((()=>[d(fe)?(w(),v(a,{key:1,name:"line-md:confirm-circle",class:"h-6 w-6 mr-2"})):(w(),v(a,{key:0,name:"line-md:loading-alt-loop",class:"h-6 w-6 mr-2"})),g(" "+f(e.$t("Select Chain")),1)])),_:1}),p(L,{class:"max-w-sm mt-5 pl-8",modelValue:d(fe),"onUpdate:modelValue":s[0]||(s[0]=e=>b(fe)?fe.value=e:null),items:d(ke),placeholder:"Select a chain",shape:"rounded"},null,8,["modelValue","items"])]),d(fe)&&d(re).depositConnected?(w(),i(k,{key:0},[R,p(c,{as:"h3",size:"2xl",weight:"bold",class:"text-muted-800 dark:text-white"},{default:m((()=>[p(a,{name:"line-md:uploading-loop",class:"h-6 w-6 mr-2"}),g(" "+f(e.$t("Send Transaction")),1)])),_:1}),u("div",Y,[p(z,{class:"p-5 col-span-1 sm:col-span-8 md:col-span-9 lg:col-span-10"},{default:m((()=>[u("div",H,[u("div",Q,[p(B,{modelValue:d(ve),"onUpdate:modelValue":s[1]||(s[1]=e=>b(ve)?ve.value=e:null),shape:"rounded",type:"text",label:`Deposit (${d(ce)}) to the address:`,icon:"ph:copy-fill",disabled:""},null,8,["modelValue","label"])]),p(r,{color:"info",flavor:"outline",onClick:be},{default:m((()=>[g(f(e.$t("Copy")),1)])),_:1})])])),_:1}),p(d(O),{class:"col-span-1 sm:col-span-4 md:col-span-3 lg:col-span-2",type:"image/webp",color:{dark:"#000000ff",light:"#ffffffff"},value:d(ve),options:{width:100}},null,8,["value"])]),"NO_PERMIT"===d(oe)?.contractType?(w(),i("div",X,[u("ul",null,[u("li",q,f(e.$t("Please do not send any other currency to the above address. Doing so may result in permanent loss of funds.")),1),u("li",J,f(e.$t("Please do not close this page until the transaction is confirmed. Otherwise, your deposit may not be credited.")),1)])])):y("",!0)],64)):d(fe)&&!d(re).depositConnected?(w(),i(k,{key:1},[d(he)?(w(),i("div",K,[u("div",Z,[p(a,{name:"line-md:close",class:"h-12 w-12 text-danger-500"}),u("p",ee,f(d(he)),1)])])):(w(),i("div",se,[u("div",ae,[p(a,{name:"svg-spinners:blocks-shuffle-3",class:"h-12 w-12 text-info-500"}),te])]))],64)):y("",!0)])])),_:1}))])}}});export{le as default};
