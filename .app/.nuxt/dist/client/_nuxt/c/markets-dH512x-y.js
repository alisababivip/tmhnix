import{_ as e}from"./BaseInput.vue-iInHQMIA.js";import{_ as a}from"./BaseSelect.vue-p0KYznCX.js";import{a as l,aq as t,ad as s,r as n,c as r,E as o,ar as d,G as i,as as u,b as m,e as c,w as p,u as f,an as h,o as v,p as g,f as k,t as b,O as x,k as w,F as _,B as y,n as V,q as j,x as B,X as M,ag as C,s as S,ao as T}from"../e/entry-8qgg5CL-.js";import{_ as $}from"./TairoButtonIcon.vue-KqKLsAHm.js";import{_ as F}from"./BaseCheckbox.vue-cNhyVlDH.js";import{_ as U}from"./FlexTableCell.vue-Rbj2Whgl.js";import{a as E,_ as N}from"./FlexTableRow.vue-LmGXINIn.js";import{_ as A}from"./BaseTag.vue-NMkN1Uk8.js";import{_ as I}from"./TairoFlexTable-zdoraqRc.js";import{_ as L}from"./BasePagination.vue-eKZkqxB7.js";import{_ as O}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as J}from"./market-Bq5Nv6Cu.js";import{_ as P,a as q}from"./placeholder-search-4-dark-Jht91LnM.js";import{z,u as D,t as H,F as R}from"./vee-validate.esm-n59zZCC5.js";import"./input-id-wZ-Ta08j.js";import"./IconCheck-JvP9GQU1.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseFocusLoop.vue-E4yqAJcg.js";import"./useExchange-VMAYQu3P.js";const Y={value:10},G={value:25},W={value:50},X={value:100},K=k("img",{class:"block dark:hidden",src:P,alt:"Placeholder image"},null,-1),Q=k("img",{class:"hidden dark:block",src:q,alt:"Placeholder image"},null,-1),Z={key:1,class:"w-full"},ee={key:0,class:"bg-info-100 text-info-700 dark:bg-info-700 dark:text-info-100 rounded-lg p-4 flex justify-between items-center w-full mb-5"},ae={class:"text-sm"},le={class:"flex gap-2"},te={class:"relative"},se={class:"pl-4"},ne={class:"flex items-center"},re={class:"mt-6"},oe={class:"flex w-full items-center justify-between p-4 md:p-6"},de={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},ie={class:"p-4 md:p-6"},ue={class:"mx-auto w-full text-start"},me={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},ce={class:"flex justify-start gap-5 items-center mt-5"},pe={class:"p-4 md:p-6"},fe={class:"flex gap-x-2"},he=l({__name:"markets",setup(l){const P=J(),q=t(),{toast:he}=s(),ve=n(""),ge=n(10),ke=r((()=>parseInt(q.query.page??"1"))),be=n(!1),xe=r((()=>P.markets&&Array.isArray(P.markets)?P.markets.filter((e=>e.symbol.includes(ve.value))):[])),we=r((()=>{const e=(ke.value-1)*ge.value,a=e+ge.value;return xe.value.slice(e,a)})),_e=n([]),ye=r((()=>_e.value.length===xe.value.length));function Ve(){ye.value?_e.value=[]:_e.value=xe.value.map((e=>e.id))??[]}const je=z.object({taker:z.number().min(1e-4).max(100),maker:z.number().min(1e-4).max(100)}),Be=r((()=>({taker:.001,maker:.001}))),{handleSubmit:Me,isSubmitting:Ce,meta:Se,resetForm:Te,setFieldValue:$e}=D({validationSchema:H(je),initialValues:Be}),Fe=n(!1),Ue=n(!1),Ee=Me((async e=>{if(JSON.stringify(e.taker)===JSON.stringify(P.selectedMarket?.metadata?.taker)&&JSON.stringify(e.maker)===JSON.stringify(P.selectedMarket?.metadata?.maker)&&Fe.value===P.selectedMarket?.is_trending&&Ue.value===P.selectedMarket?.is_hot)return he.info("No changes detected."),be.value=!1,void P.selectMarket(null);const a={taker:e.taker,maker:e.maker},l=await P.updateMarket(P.selectedMarket?.id,a,Fe.value,Ue.value);"success"===l.status?he.success(l):he.danger(l),be.value=!1,P.selectMarket(null),Te()})),Ne=()=>{be.value=!1,P.selectMarket(null),Te()};function Ae(e){P.updateMarketsStatus(_e.value,e).then((e=>{"success"===e.status?he.success(e):he.danger(e),_e.value=[]}))}o((async()=>{0===P.markets.length&&(P.loading=!0,await P.fetchMarkets(),P.loading=!1)})),d((()=>{window.addEventListener("beforeunload",Ie)})),i((()=>{window.removeEventListener("beforeunload",Ie)})),u((()=>{if(Se.value.dirty)return confirm("You have unsaved changes. Are you sure you want to leave?")}));const Ie=e=>{Se.value.dirty&&(e.preventDefault(),e.returnValue="")};return(l,t)=>{const s=e,n=a,r=B,o=M,d=C,i=$,u=F,J=U,q=S,z=E,D=N,H=A,he=I,je=L,Be=O,Me=T,Se=h;return v(),m("div",null,[c(Be,null,{left:p((()=>[c(s,{modelValue:f(ve),"onUpdate:modelValue":t[0]||(t[0]=e=>g(ve)?ve.value=e:null),icon:"lucide:search",placeholder:"Filter markets...",classes:{wrapper:"w-full sm:w-auto"}},null,8,["modelValue"]),c(n,{modelValue:f(ge),"onUpdate:modelValue":t[1]||(t[1]=e=>g(ge)?ge.value=e:null),label:"",classes:{wrapper:"w-full sm:w-40"}},{default:p((()=>[k("option",Y,"10 "+b(l.$t("per page")),1),k("option",G,"25 "+b(l.$t("per page")),1),k("option",W,"50 "+b(l.$t("per page")),1),k("option",X,"100 "+b(l.$t("per page")),1)])),_:1},8,["modelValue"])])),right:p((()=>[c(o,{color:"muted",class:"w-full",to:"/admin/settings/exchange",flavor:"outline"},{default:p((()=>[c(r,{name:"line-md:chevron-left",class:"h-4 w-4"}),k("span",null,b(l.$t("Back")),1)])),_:1})])),default:p((()=>[k("div",null,[f(P).loading||0!==f(we)?.length?(v(),m("div",Z,[!f(P).loading&&f(_e).length>0?(v(),m("div",ee,[k("span",ae,b(l.$t("You have selected"))+" "+b(f(_e).length)+" "+b(l.$t("items of the total"))+" "+b(f(xe).length)+" "+b(l.$t("items"))+". ",1),k("div",le,[c(i,{color:"danger",size:"xs","data-nui-tooltip":"Disable currencies",onClick:t[2]||(t[2]=()=>Ae(!1))},{default:p((()=>[c(r,{name:"line-md:close-small",class:"h-5 w-5"})])),_:1}),c(i,{color:"success",size:"xs","data-nui-tooltip":"Enable currencies",onClick:t[3]||(t[3]=()=>Ae(!0))},{default:p((()=>[c(r,{name:"line-md:confirm",class:"h-5 w-5"})])),_:1})])])):w("",!0),c(he,{class:"md:pt-0 sm:pt-5 md:mt-0 sm:mt-5"},{header:p((()=>[k("div",te,[k("span",se,[c(u,{"model-value":f(ye),indeterminate:f(_e).length>0&&!f(ye),name:"table-1-main",shape:"rounded",class:"text-primary-500",onClick:Ve},null,8,["model-value","indeterminate"])])])])),default:p((()=>[f(P).loading?(v(),m(_,{key:0},y(5,(e=>c(z,{key:e},{default:p((()=>[c(J,{type:"shrink","data-content":"Selection"},{default:p((()=>[k("div",ne,[c(u,{modelValue:f(_e),"onUpdate:modelValue":t[4]||(t[4]=e=>g(_e)?_e.value=e:null),name:`placeload-item-checkbox-${e}`,class:"text-primary-500"},null,8,["modelValue","name"])])])),_:2},1024),c(J,{type:"grow",class:"md:justify-start","data-content":"Symbol"},{default:p((()=>[c(q,{class:"h-[46px] w-[46px] shrink-0 rounded-xl"})])),_:1}),c(J,{class:"text-end md:text-start","data-content":"Trending",light:""},{default:p((()=>[c(q,{class:"h-3 w-24 rounded-lg"})])),_:1}),c(J,{class:"text-end md:text-start","data-content":"Hot",light:""},{default:p((()=>[c(q,{class:"h-3 w-24 rounded-lg"})])),_:1}),c(J,{class:"text-end md:text-start","data-content":"Taker",light:""},{default:p((()=>[c(q,{class:"h-3 w-24 rounded-lg"})])),_:1}),c(J,{class:"text-end md:text-start","data-content":"Maker",light:""},{default:p((()=>[c(q,{class:"h-3 w-24 rounded-lg"})])),_:1}),c(J,{class:"text-end md:text-start","data-content":"Status",light:""},{default:p((()=>[c(q,{class:"h-3 w-24 rounded-lg"})])),_:1}),c(J,{type:"grow",class:"md:justify-end text-end","data-content":"Actions"},{default:p((()=>[c(q,{class:"h-8 w-16 rounded-lg"})])),_:1})])),_:2},1024))),64)):(v(!0),m(_,{key:1},y(f(we),((e,a)=>(v(),x(z,{key:e.id,spaced:""},{start:p((()=>[c(J,{"data-content":"Selection",class:"xs:absolute right-2 ml-2"},{default:p((()=>[c(u,{modelValue:f(_e),"onUpdate:modelValue":t[5]||(t[5]=e=>g(_e)?_e.value=e:null),value:e.id,name:`item-checkbox-${e.id}`,shape:"rounded",class:"text-primary-500"},null,8,["modelValue","value","name"])])),_:2},1024),c(D,{label:"Symbol","hide-label":a>0,title:e.symbol},null,8,["hide-label","title"])])),end:p((()=>[c(J,{label:"Trending","hide-label":a>0,class:"w-full sm:w-20"},{default:p((()=>[c(r,{name:e.is_trending?"line-md:circle-to-confirm-circle-twotone-transition":"line-md:close-circle-twotone",class:V(["h-6 w-6",{"text-danger-500":!e.is_trending,"text-success-500":e.is_trending}])},null,8,["name","class"])])),_:2},1032,["hide-label"]),c(J,{label:"Hot","hide-label":a>0,class:"w-full sm:w-20"},{default:p((()=>[c(r,{name:e.is_hot?"line-md:circle-to-confirm-circle-twotone-transition":"line-md:close-circle-twotone",class:V(["h-6 w-6",{"text-danger-500":!e.is_hot,"text-success-500":e.is_hot}])},null,8,["name","class"])])),_:2},1032,["hide-label"]),c(J,{label:"Taker","hide-label":a>0,class:"w-full sm:w-20"},{default:p((()=>[j(b(e.metadata?.taker),1)])),_:2},1032,["hide-label"]),c(J,{label:"Maker","hide-label":a>0,class:"w-full sm:w-20"},{default:p((()=>[j(b(e.metadata?.maker),1)])),_:2},1032,["hide-label"]),c(J,{label:"Status","hide-label":a>0},{default:p((()=>[c(H,{color:e.status?"success":"danger",flavor:"pastel"},{default:p((()=>[j(b(e.status?"Active":"Disabled"),1)])),_:2},1032,["color"])])),_:2},1032,["hide-label"]),c(J,{label:"action","hide-label":a>0},{default:p((()=>[c(i,{condensed:"",color:"warning",flavor:"outline",onClick:a=>(e=>{P.selectMarket(e),$e("taker",e.metadata.taker),$e("maker",e.metadata.maker),Fe.value=e.is_trending,Ue.value=e.is_hot,be.value=!0})(e),"data-nui-tooltip":"Edit market"},{default:p((()=>[c(r,{name:"line-md:edit-twotone",class:"h-4 w-4"})])),_:2},1032,["onClick"])])),_:2},1032,["hide-label"])])),_:2},1024)))),128))])),_:1})])):(v(),x(d,{key:0,title:f(ve)&&""!==f(ve)?"No matching results":"No results",subtitle:f(ve)&&""!==f(ve)?"Looks like we couldn't find any matching results for your search terms. Try other search terms.":"Looks like we don't have any data here yet."},{image:p((()=>[K,Q])),_:1},8,["title","subtitle"])),k("div",re,[f(xe).length>f(ge)?(v(),x(je,{key:0,"total-items":f(xe).length,"item-per-page":f(ge),"current-page":f(ke)},null,8,["total-items","item-per-page","current-page"])):w("",!0)])])])),_:1}),c(Se,{open:f(be),size:"sm",onClose:Ne},{header:p((()=>[k("div",oe,[k("h3",de,b(l.$t("Edit Market")),1),c(Me,{onClick:t[6]||(t[6]=e=>be.value=!1)})])])),footer:p((()=>[k("div",pe,[k("div",fe,[c(o,{onClick:t[9]||(t[9]=e=>be.value=!1)},{default:p((()=>[j(b(l.$t("Cancel")),1)])),_:1}),c(o,{color:"primary",flavor:"solid",onClick:f(Ee),disabled:f(Ce),loading:f(Ce)},{default:p((()=>[j(b(l.$t("Update")),1)])),_:1},8,["onClick","disabled","loading"])])])])),default:p((()=>[k("div",ie,[k("div",ue,[k("p",me,b(l.$t("Please update the market information"))+". ",1),c(f(R),{name:"taker"},{default:p((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[c(s,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:f(Ce),type:"number",label:"Taker Fees",placeholder:"Enter market taker fees",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1}),c(f(R),{name:"maker"},{default:p((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[c(s,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:f(Ce),type:"number",label:"Maker Fees",placeholder:"Enter market maker fees",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1}),k("div",ce,[c(u,{modelValue:f(Fe),"onUpdate:modelValue":t[7]||(t[7]=e=>g(Fe)?Fe.value=e:null),label:"Trending",shape:"rounded",color:"success"},null,8,["modelValue"]),c(u,{modelValue:f(Ue),"onUpdate:modelValue":t[8]||(t[8]=e=>g(Ue)?Ue.value=e:null),label:"Hot",color:"success",shape:"rounded"},null,8,["modelValue"])])])])])),_:1},8,["open"])])}}});export{he as default};
