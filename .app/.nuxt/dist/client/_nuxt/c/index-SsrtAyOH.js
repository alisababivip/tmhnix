import{_ as e}from"./BaseInput.vue-iInHQMIA.js";import{_ as a}from"./BaseSelect.vue-p0KYznCX.js";import{a as l,ad as t,E as s,S as d,r as o,ac as i,z as r,c as n,J as u,ar as m,G as c,as as p,b as v,e as f,w as g,u as h,an as x,o as w,p as b,f as _,t as y,O as k,k as C,F as j,B as V,q as B,ag as U,x as $,s as E,Y as A,ao as S,X as T}from"../e/entry-8qgg5CL-.js";import{_ as N}from"./TairoButtonIcon.vue-KqKLsAHm.js";import{_ as F}from"./BaseCheckbox.vue-cNhyVlDH.js";import{_ as I}from"./FlexTableCell.vue-Rbj2Whgl.js";import{_ as P,a as D}from"./FlexTableRow.vue-LmGXINIn.js";import{_ as q}from"./BaseTag.vue-NMkN1Uk8.js";import{_ as R}from"./TairoFlexTable-zdoraqRc.js";import{_ as z}from"./BasePagination.vue-eKZkqxB7.js";import{_ as L}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{_ as M}from"./BaseButtonIcon.vue-6tAU_b7C.js";import{_ as Y}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{u as G}from"./useUsers-4S9MS3a9.js";import{u as H}from"./useRoles-LBTtGXtV.js";import{_ as J,a as O}from"./placeholder-search-4-dark-Jht91LnM.js";import{z as W,u as X,t as K,F as Q}from"./vee-validate.esm-n59zZCC5.js";import"./input-id-wZ-Ta08j.js";import"./IconCheck-JvP9GQU1.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseFocusLoop.vue-E4yqAJcg.js";const Z={value:10},ee={value:25},ae={value:50},le={value:100},te=_("img",{class:"block dark:hidden",src:J,alt:"Placeholder image"},null,-1),se=_("img",{class:"hidden dark:block",src:O,alt:"Placeholder image"},null,-1),de={key:1,class:"w-full"},oe={key:0,class:"bg-info-100 text-info-700 dark:bg-info-700 dark:text-info-100 rounded-lg p-4 flex justify-between users-center w-full"},ie={class:"flex gap-2"},re={class:"relative"},ne={class:"pl-4"},ue={key:0,class:"space-y-3"},me={class:"flex flex-col items-center justify-center gap-3 text-center sm:flex-row sm:justify-start sm:text-left"},ce={class:"space-y-2"},pe={class:"flex flex-col gap-4 pt-4 sm:ms-auto sm:flex-row sm:items-center sm:justify-end sm:pt-0"},ve={class:"ptablet:hidden divide-muted-200 dark:divide-muted-700 flex items-center justify-center divide-x"},fe={class:"flex flex-col gap-1 px-4 text-center"},ge={class:"flex flex-col gap-1 px-4 text-center"},he={class:"flex flex-col gap-1 px-4 text-center"},xe={class:"sm:ms-6"},we={class:"flex gap-2"},be={class:"mt-6"},_e={class:"flex w-full items-center justify-between p-4 md:p-6"},ye={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},ke={class:"p-4 md:p-6"},Ce={class:"mx-auto w-full text-start"},je={class:"grid gap-5 sm:grid-cols-1 md:grid-cols-2"},Ve={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5"},Be={class:"relative h-20 w-20"},Ue=["src"],$e=["src"],Ee={key:2,class:"absolute bottom-0 end-0 z-20"},Ae={key:3,class:"absolute bottom-0 end-0 z-20"},Se={class:"relative","data-nui-tooltip":"Upload image"},Te=["value","selected"],Ne={class:"p-4 md:p-6"},Fe={class:"flex gap-x-2"},Ie={class:"flex w-full items-center justify-between p-4 md:p-6"},Pe={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},De={class:"p-4 md:p-6"},qe={class:"mx-auto w-full text-center"},Re={class:"font-heading text-muted-800 text-lg font-medium leading-6 dark:text-white"},ze={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},Le={class:"p-4 md:p-6"},Me={class:"flex gap-x-2"},Ye={class:"flex w-full items-center justify-between p-4 md:p-6"},Ge={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},He={class:"p-4 md:p-6"},Je={class:"mx-auto w-full text-center"},Oe={class:"font-heading text-muted-800 text-lg font-medium leading-6 dark:text-white"},We={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},Xe={class:"p-4 md:p-6"},Ke={class:"flex gap-x-2"},Qe=l({__name:"index",setup(l){const{getUsers:J,updateUser:O,deleteUser:Qe,deleteUsers:Ze,updateUsersStatus:ea}=G(),{getRoles:aa}=H(),{toast:la}=t();s((async()=>{await fa();const e=await aa();oa.value=e.data.result,va.value=!1}));const ta=d().getProfile,sa=o(null),da=o([]),oa=o([]),ia=i(),ra=r(),na=o(""),ua=o(10),ma=n((()=>parseInt(ra.query.page??"1"))),ca=o(0),pa=o(0),va=o(!1);async function fa(){va.value=!0;const e=await J({filter:na.value,perPage:ua.value,page:ma.value});"success"===e.status&&(da.value=e.data.result.data,ca.value=e.data.result.pagination.totalItems,pa.value=e.data.result.pagination.totalPages),va.value=!1}u([na,ua,ma],fa),u([na,ua,ma],(()=>{ia.push({query:{...ra.query,filter:na.value,perPage:ua.value.toString(),page:ma.value.toString()}})}));const ga=o(!1),ha=o(!1),xa=o(!1),wa=o(""),ba=o([]),_a=n((()=>ba.value.length===da.value.length));function ya(){_a.value?ba.value=[]:ba.value=da.value.map((e=>e.id))??[]}const ka=W.object({first_name:W.string().nonempty("First Name is required"),last_name:W.string().nonempty("Last Name is required"),email:W.string().email("Invalid email").nonempty("Email is required"),role_id:W.string().nonempty("Role is required")}),Ca=n((()=>({first_name:"",last_name:"",email:"",role_id:""}))),{handleSubmit:ja,isSubmitting:Va,meta:Ba,resetForm:Ua,setFieldValue:$a}=X({validationSchema:K(ka),initialValues:Ca}),Ea=n((()=>sa.value?.avatar??"/img/avatars/10.svg")),Aa=o(null),Sa=ja((async e=>{if(sa.value?.uuid)try{const a=await O(sa.value.uuid,e.first_name,e.last_name,e.email,e.role_id);la.response(a),"success"===a.status&&(await fa(),ga.value=!1,Ua())}catch(a){la.danger(a)}else la.dangerText("User not selected")})),Ta=()=>{ga.value=!1,Ua()},Na=e=>{wa.value=e,xa.value=!0};m((()=>{window.addEventListener("beforeunload",Fa)})),c((()=>{window.removeEventListener("beforeunload",Fa)})),p((()=>{if(Ba.value.dirty)return confirm("You have unsaved changes. Are you sure you want to leave?")}));const Fa=e=>{Ba.value.dirty&&(e.preventDefault(),e.returnValue="")},Ia=e=>"ACTIVE"===e?"Activate":"BANNED"===e?"Ban":"Mute",Pa=e=>e instanceof File||e instanceof Blob;return(l,t)=>{const s=e,d=a,o=U,i=$,r=N,n=F,u=E,m=A,c=I,p=P,G=q,H=D,J=R,O=z,W=L,X=S,K=M,aa=Y,ka=T,Ca=x;return w(),v("div",null,[f(W,null,{left:g((()=>[f(s,{modelValue:h(na),"onUpdate:modelValue":t[0]||(t[0]=e=>b(na)?na.value=e:null),icon:"lucide:search",placeholder:"Filter users...",classes:{wrapper:"w-full sm:w-auto"},shape:"curved"},null,8,["modelValue"])])),right:g((()=>[f(d,{modelValue:h(ua),"onUpdate:modelValue":t[1]||(t[1]=e=>b(ua)?ua.value=e:null),label:"",classes:{wrapper:"w-full sm:w-40"},shape:"curved"},{default:g((()=>[_("option",Z,"10 "+y(l.$t("per page")),1),_("option",ee,"25 "+y(l.$t("per page")),1),_("option",ae,"50 "+y(l.$t("per page")),1),_("option",le,"100 "+y(l.$t("per page")),1)])),_:1},8,["modelValue"])])),default:g((()=>[_("div",null,[h(va)||0!==h(da)?.length?(w(),v("div",de,[!h(va)&&h(ba).length>0?(w(),v("div",oe,[_("span",null,y(l.$t("You have selected"))+" "+y(h(ba).length)+" "+y(l.$t("users of the total"))+" "+y(h(da).length)+" "+y(l.$t("users")),1),_("div",ie,[f(r,{color:"warning",shape:"curved",onClick:t[2]||(t[2]=e=>Na("BANNED")),"data-nui-tooltip":"Ban users"},{default:g((()=>[f(i,{name:"line-md:cancel",class:"h-5 w-5"})])),_:1}),f(r,{color:"success",shape:"curved",onClick:t[3]||(t[3]=e=>Na("ACTIVE")),"data-nui-tooltip":"Activate users"},{default:g((()=>[f(i,{name:"line-md:confirm",class:"h-5 w-5"})])),_:1}),f(r,{color:"danger",shape:"curved",onClick:t[4]||(t[4]=e=>(h(ba),void(ha.value=!0))),"data-nui-tooltip":"Delete users"},{default:g((()=>[f(i,{name:"line-md:close-small",class:"h-5 w-5"})])),_:1})])])):C("",!0),f(J,{class:"md:pt-0 sm:pt-5 md:mt-0 sm:mt-5"},{header:g((()=>[_("div",re,[_("span",ne,[f(n,{"model-value":h(_a),indeterminate:h(ba).length>0&&!h(_a),name:"table-1-main",shape:"rounded",class:"text-primary-500",onClick:ya},null,8,["model-value","indeterminate"])])])])),default:g((()=>[h(va)?(w(),v("div",ue,[(w(),v(j,null,V(10,(e=>f(m,{key:e,shape:"curved",class:"flex flex-col px-4 py-3 sm:flex-row sm:items-center"},{default:g((()=>[_("div",me,[f(u,{class:"h-12 w-12 shrink-0 rounded-full"}),_("div",ce,[f(u,{class:"mx-auto h-3 w-[100px] rounded-lg sm:mx-0"}),f(u,{class:"mx-auto h-3 w-[75px] rounded-lg sm:mx-0"})])]),_("div",pe,[_("div",ve,[_("div",fe,[f(u,{class:"h-3 w-16 rounded-lg"})]),_("div",ge,[f(u,{class:"h-3 w-16 rounded-lg"})]),_("div",he,[f(u,{class:"h-3 w-16 rounded-lg"})])]),_("div",xe,[f(u,{class:"mx-auto h-8 w-40 rounded-lg sm:mx-0 sm:w-20"})])])])),_:2},1024))),64))])):(w(!0),v(j,{key:1},V(h(da),((e,a)=>(w(),k(H,{key:e.id,spaced:""},{start:g((()=>[f(c,{"data-content":"Selection",class:"xs:absolute right-2 ml-2"},{default:g((()=>[f(n,{modelValue:h(ba),"onUpdate:modelValue":t[5]||(t[5]=e=>b(ba)?ba.value=e:null),value:e.id,name:`item-checkbox-${e.id}`,shape:"rounded",class:"text-primary-500"},null,8,["modelValue","value","name"])])),_:2},1024),f(p,{label:"User","hide-label":a>0,title:`${e.first_name} ${e.last_name}`,logo:e.avatar,subtitle:e.uuid},null,8,["hide-label","title","logo","subtitle"])])),end:g((()=>[f(c,{label:"Role","hide-label":a>0,class:"w-full sm:w-40"},{default:g((()=>[B(y(e?.role?.name),1)])),_:2},1032,["hide-label"]),f(c,{label:"Country","hide-label":a>0,class:"w-full sm:w-20"},{default:g((()=>[B(y(e?.metadata?.location?.country),1)])),_:2},1032,["hide-label"]),f(c,{label:"Status","hide-label":a>0,class:"w-full sm:w-20"},{default:g((()=>{return[e.status?(w(),k(G,{key:0,color:(a=e.status,"ACTIVE"===a?"success":"BANNED"===a?"danger":"muted"),flavor:"pastel",shape:"full",condensed:"",class:"font-medium"},{default:g((()=>[B(y(e.status),1)])),_:2},1032,["color"])):(w(),k(G,{key:1,color:"danger",flavor:"pastel",shape:"full",condensed:"",class:"font-medium"},{default:g((()=>[B(y(l.$t("Banned")),1)])),_:1}))];var a})),_:2},1032,["hide-label"]),f(c,{label:"action","hide-label":a>0},{default:g((()=>[_("div",we,[f(r,{disabled:e.role_id==h(oa).find((e=>"Super Admin"==e.name))?.id&&h(ta)?.id===e.id,color:e.role_id==h(oa).find((e=>"Super Admin"==e.name))?.id&&h(ta)?.id===e.id?"muted":"warning",onClick:a=>{return l=e,sa.value=l,$a("first_name",l.first_name),$a("last_name",l.last_name),$a("email",l.email),$a("role_id",`${l.role_id}`),void(ga.value=!0);var l},shape:"curved","data-nui-tooltip":"Edit user"},{default:g((()=>[f(i,{name:"line-md:edit",class:"h-4 w-4"})])),_:2},1032,["disabled","color","onClick"]),f(r,{disabled:e.role_id==h(oa).find((e=>"Super Admin"==e.name))?.id&&h(ta)?.id===e.id,color:e.role_id==h(oa).find((e=>"Super Admin"==e.name))?.id&&h(ta)?.id===e.id?"muted":"danger",size:"xs",shape:"curved",onClick:a=>{return l=e,sa.value=l,void(ha.value=!0);var l},"data-nui-tooltip":"Delete user"},{default:g((()=>[f(i,{name:"line-md:close-small",class:"h-5 w-5"})])),_:2},1032,["disabled","color","onClick"])])])),_:2},1032,["hide-label"])])),_:2},1024)))),128))])),_:1})])):(w(),k(o,{key:0,title:h(na)&&""!==h(na)?"No matching results":"No results",subtitle:h(na)&&""!==h(na)?"Looks like we couldn't find any matching results for your search terms. Try other search terms.":"Looks like we don't have any data here yet."},{image:g((()=>[te,se])),_:1},8,["title","subtitle"])),_("div",be,[h(pa)>1?(w(),k(O,{key:0,"current-page":h(ma),"total-items":h(ca),itemPerPage:h(ua),"total-pages":h(pa),onPageChanged:t[6]||(t[6]=e=>h(ia).push({query:{...h(ra).query,page:e.toString()}}))},null,8,["current-page","total-items","itemPerPage","total-pages"])):C("",!0)])])])),_:1}),f(Ca,{open:h(ga),size:"2xl",onClose:Ta},{header:g((()=>[_("div",_e,[_("h3",ye,y(l.$t("Edit User")),1),f(X,{onClick:t[7]||(t[7]=e=>ga.value=!1)})])])),footer:g((()=>[_("div",Ne,[_("div",Fe,[f(ka,{onClick:t[9]||(t[9]=e=>ga.value=!1)},{default:g((()=>[B(y(l.$t("Cancel")),1)])),_:1}),f(ka,{color:"primary",flavor:"solid",onClick:h(Sa),disabled:h(Va),loading:h(Va)},{default:g((()=>[B(y(l.$t("Update")),1)])),_:1},8,["onClick","disabled","loading"])])])])),default:g((()=>[_("div",ke,[_("div",Ce,[_("div",je,[_("div",null,[_("p",Ve,y(l.$t("Please update the user information"))+". ",1)]),f(aa,{accept:"image/*",type:"file",modelValue:h(Aa),"onUpdate:modelValue":t[8]||(t[8]=e=>b(Aa)?Aa.value=e:null),name:"image"},{default:g((({open:e,remove:a,preview:l,files:t})=>[_("div",Be,[t?.length&&Pa(t[0])?(w(),v("img",{key:0,src:l(t.item(0)).value,alt:"Upload preview",class:"bg-muted-200 dark:bg-muted-700/60 h-20 w-20 rounded-full object-cover object-center"},null,8,Ue)):(w(),v("img",{key:1,src:h(Ea),alt:"Upload preview",class:"bg-muted-200 dark:bg-muted-700/60 h-20 w-20 rounded-full object-cover object-center dark:invert"},null,8,$e)),t?.length&&Pa(t[0])?(w(),v("div",Ee,[f(K,{condensed:"",shape:"full",onClick:e=>a(t.item(0)),"data-nui-tooltip":"Remove image",class:"scale-90"},{default:g((()=>[f(i,{name:"lucide:x",class:"h-4 w-4"})])),_:2},1032,["onClick"])])):(w(),v("div",Ae,[_("div",Se,[f(K,{condensed:"",shape:"full",onClick:e},{default:g((()=>[f(i,{name:"lucide:plus",class:"h-4 w-4"})])),_:2},1032,["onClick"])])]))])])),_:1},8,["modelValue"]),f(h(Q),{name:"first_name"},{default:g((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[f(s,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:h(Va),type:"text",label:"User First Name",placeholder:"Enter user first name",shape:"curved",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1}),f(h(Q),{name:"last_name"},{default:g((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[f(s,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:h(Va),type:"text",label:"User Last Name",placeholder:"Enter user last name",shape:"curved",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1}),f(h(Q),{name:"email"},{default:g((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[f(s,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:h(Va),type:"email",label:"Email",placeholder:"Enter email",shape:"curved",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1}),f(h(Q),{name:"role_id"},{default:g((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[f(d,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:h(Va),label:"Role",shape:"curved",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t,placeholder:"Select role"},{default:g((()=>[(w(!0),v(j,null,V(h(oa),((a,l)=>(w(),v("option",{key:l,value:`${a.id}`,selected:a.id===e.value},y(a.name),9,Te)))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1})])])])])),_:1},8,["open"]),f(Ca,{open:h(ha),size:"sm",onClose:t[13]||(t[13]=e=>ha.value=!1)},{header:g((()=>[_("div",Ie,[_("h3",Pe,y(l.$t("Delete"))+" "+y(h(ba).length>0?"Users":"User"),1),f(X,{onClick:t[10]||(t[10]=e=>ha.value=!1)})])])),footer:g((()=>[_("div",Le,[_("div",Me,[f(ka,{onClick:t[11]||(t[11]=e=>ha.value=!1)},{default:g((()=>[B(y(l.$t("Cancel")),1)])),_:1}),f(ka,{color:"danger",flavor:"solid",onClick:t[12]||(t[12]=e=>h(ba).length>0?(async()=>{try{const e=ba.value.map((e=>e)),a=await Ze(e);da.value=da.value.filter((a=>!e.includes(a.id))),ba.value=[],la.response(a)}catch(e){la.danger(e)}ha.value=!1})():(async()=>{try{const e=await Qe(sa.value?.uuid);la.response(e),"success"===e.status&&await fa(),ha.value=!1}catch(e){la.danger(e)}})()),disabled:h(Va),loading:h(Va)},{default:g((()=>[B(y(l.$t("Delete")),1)])),_:1},8,["disabled","loading"])])])])),default:g((()=>[_("div",De,[_("div",qe,[_("h3",Re,y(l.$t("Are you sure"))+"? ",1),_("p",ze,y(l.$t("Do you really want to delete"))+" "+y(h(ba).length>0?"these users":"this user")+"? "+y(l.$t("This process cannot be undone"))+". ",1)])])])),_:1},8,["open"]),f(Ca,{open:h(xa),size:"sm",onClose:t[17]||(t[17]=e=>xa.value=!1)},{header:g((()=>[_("div",Ye,[_("h3",Ge,y(h(wa))+" "+y(h(ba).length>0?"Users":"User"),1),f(X,{onClick:t[14]||(t[14]=e=>xa.value=!1)})])])),footer:g((()=>{return[_("div",Xe,[_("div",Ke,[f(ka,{onClick:t[15]||(t[15]=e=>xa.value=!1)},{default:g((()=>[B(y(l.$t("Cancel")),1)])),_:1}),f(ka,{color:(e=h(wa),"ACTIVE"===e?"success":"BANNED"===e?"warning":"muted"),flavor:"solid",onClick:t[16]||(t[16]=e=>(async e=>{try{const a=ba.value.map((e=>e)),l=await ea(a,e);da.value=da.value.map((l=>(a.includes(l.id)&&(l.status=e),l))),ba.value=[],la.response(l)}catch(a){la.danger(a)}xa.value=!1})(h(wa))),disabled:h(Va),loading:h(Va)},{default:g((()=>[B(y(Ia(h(wa))),1)])),_:1},8,["color","disabled","loading"])])])];var e})),default:g((()=>[_("div",He,[_("div",Je,[_("h3",Oe,y(l.$t("Are you sure"))+"? ",1),_("p",We,y(l.$t("Do you really want to"))+" "+y(Ia(h(wa)))+" "+y(h(ba).length>0?"these users":"this user")+"? "+y(l.$t("This process cannot be undone"))+". ",1)])])])),_:1},8,["open"])])}}});export{Qe as default};
