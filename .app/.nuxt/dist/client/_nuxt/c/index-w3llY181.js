import{_ as e}from"./BaseInput.vue-iInHQMIA.js";import{_ as a}from"./BaseSelect.vue-p0KYznCX.js";import{a as l,o as t,b as s,j as o,n,E as d,r as i,aq as u,d5 as r,ad as c,c as m,e as p,w as f,u as v,an as h,p as g,f as x,t as w,O as y,q as k,k as _,F as b,B as C,x as $,X as j,ag as V,s as R,ao as B}from"../e/entry-8qgg5CL-.js";import{_ as N}from"./BaseCheckbox.vue-cNhyVlDH.js";import{_ as T}from"./TairoButtonIcon.vue-KqKLsAHm.js";import{_ as U,a as F}from"./TairoFlexTableRow.vue-SSWkvezF.js";import{_ as S}from"./TairoFlexTable-zdoraqRc.js";import{_ as P}from"./BasePagination.vue-eKZkqxB7.js";import{_ as A}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as q}from"./useRoles-LBTtGXtV.js";import{_ as D,a as E}from"./placeholder-search-4-dark-Jht91LnM.js";import{z as I,u as z,t as L,F as O}from"./vee-validate.esm-n59zZCC5.js";import"./input-id-wZ-Ta08j.js";import"./IconCheck-JvP9GQU1.js";import"./BaseFocusLoop.vue-E4yqAJcg.js";const J=l({__name:"TairoFlexTableHeading",props:{type:{default:"stable"}},setup(e){const a=e;return(e,l)=>(t(),s("div",{class:n(["text-muted-400 p-4 font-sans text-xs font-medium uppercase",["grow"===a.type&&"md:grow","shrink"===a.type&&"md:shrink","stable"===a.type&&"sm:w-[90px] md:line-clamp-1 md:w-[110px] md:shrink-0"]])},[o(e.$slots,"default")],2))}}),M={class:"pb-10"},H={value:10},W={value:25},X={value:50},Y={value:100},G={class:"w-full"},K=x("img",{class:"block dark:hidden",src:D,alt:"Placeholder image"},null,-1),Q=x("img",{class:"hidden dark:block",src:E,alt:"Placeholder image"},null,-1),Z={key:1,class:"w-full"},ee={class:"flex items-center"},ae={class:"w-full w:sm-40"},le={class:"flex justify-between items-center w-full"},te={class:"flex items-center"},se={class:"flex items-center"},oe={class:"w-full sm:w-40"},ne={class:"flex gap-2"},de={class:"mt-6"},ie={class:"flex w-full items-center justify-between p-4 md:p-6"},ue={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},re={class:"p-4 md:p-6"},ce={class:"mx-auto w-full text-start"},me={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},pe={class:"p-4 md:p-6"},fe={class:"flex gap-x-2"},ve={class:"flex w-full items-center justify-between p-4 md:p-6"},he={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},ge={class:"p-4 md:p-6"},xe={class:"mx-auto w-full text-start"},we={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},ye={class:"p-4 md:p-6"},ke={class:"flex gap-x-2"},_e={class:"flex w-full items-center justify-between p-4 md:p-6"},be={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},Ce={class:"p-4 md:p-6"},$e={class:"mx-auto w-full text-center"},je={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},Ve={class:"p-4 md:p-6"},Re={class:"flex gap-x-2"},Be=l({__name:"index",setup(l){const{activeRole:o,selectRole:n,getRoles:D,createRole:E,updateRole:Be,deleteRole:Ne,deleteRoles:Te}=q();d((async()=>{0===Ue.value.length&&(Fe.value=!0,await async function(){const e=await D();Ue.value=e.data.result}(),Fe.value=!1)}));const Ue=i([]),Fe=i(!0),Se=u(),Pe=r(),{toast:Ae}=c(),qe=i(""),De=i(10),Ee=m((()=>parseInt(Se.query.page??"1"))),Ie=i(!1),ze=i(!1),Le=i(!1),Oe=m((()=>Ue.value&&Array.isArray(Ue.value)?Ue.value.filter((e=>e.name.includes(qe.value)&&"Super Admin"!==e.name)):[])),Je=m((()=>{const e=(Ee.value-1)*De.value,a=e+De.value;return Oe.value.slice(e,a)})),Me=i([]),He=m((()=>Me.value.length===Oe.value.length));function We(){He.value?Me.value=[]:Me.value=Oe.value.map((e=>e.id))??[]}const Xe=I.object({name:I.string().nonempty("Name is required")}),Ye=m((()=>({name:""}))),{handleSubmit:Ge,isSubmitting:Ke,resetForm:Qe,setFieldValue:Ze}=z({validationSchema:L(Xe),initialValues:Ye}),ea=Ge((async e=>{try{const a=await E(e);Ae.response(a),"success"===a.status&&(Ue.value.push(a.data.result),Qe())}catch(a){Ae.danger(a)}Ie.value=!1})),aa=Ge((async e=>{try{if(JSON.stringify(e.name)===JSON.stringify(o.value?.name))return Ae.info("No changes detected."),ze.value=!1,void n(null);const a=await Be(o.value?.id,e);if(Ae.response(a),"success"===a.status){const e=Ue.value.findIndex((e=>e.id===a.data.result.id));-1!==e&&(Ue.value[e]=a.data.result),Qe(),n(null)}}catch(a){Ae.danger(a)}ze.value=!1})),la=()=>{ze.value=!1,n(null),Qe()};return(l,d)=>{const i=e,u=a,r=$,c=j,m=V,q=N,D=J,E=T,I=U,z=F,L=R,Be=$,Se=S,Xe=P,Ye=A,Ge=B,Qe=h;return t(),s("div",M,[p(Ye,null,{left:f((()=>[p(i,{modelValue:v(qe),"onUpdate:modelValue":d[0]||(d[0]=e=>g(qe)?qe.value=e:null),icon:"lucide:search",placeholder:"Filter roles...",classes:{wrapper:"w-full sm:w-auto"}},null,8,["modelValue"]),p(u,{modelValue:v(De),"onUpdate:modelValue":d[1]||(d[1]=e=>g(De)?De.value=e:null),label:"",classes:{wrapper:"w-full sm:w-40"}},{default:f((()=>[x("option",H,"10 "+w(l.$t("per page")),1),x("option",W,"25 "+w(l.$t("per page")),1),x("option",X,"50 "+w(l.$t("per page")),1),x("option",Y,"100 "+w(l.$t("per page")),1)])),_:1},8,["modelValue"])])),right:f((()=>[x("div",G,[p(c,{color:"success",class:"w-full",onClick:d[2]||(d[2]=e=>Ie.value=!0),flavor:"outline"},{default:f((()=>[p(r,{name:"line-md:plus",class:"h-4 w-4"}),x("span",null,w(l.$t("Create Role")),1)])),_:1})])])),default:f((()=>[x("div",null,[v(Fe)||0!==v(Je)?.length?(t(),s("div",Z,[p(Se,null,{header:f((()=>[p(D,{type:"shrink"},{default:f((()=>[x("div",ee,[p(q,{"model-value":v(He),indeterminate:v(Me).length>0&&!v(He),shape:"curved",class:"text-primary-500",onClick:We},null,8,["model-value","indeterminate"])])])),_:1}),p(D,{type:"grow",class:"md:justify-start"},{default:f((()=>[x("div",ae,w(l.$t("Name")),1)])),_:1}),p(D,{class:"text-end md:text-start"},{default:f((()=>[k(w(l.$t("Permissions")),1)])),_:1}),p(D,{type:"grow",class:"md:justify-end text-end"},{default:f((()=>[k(w(l.$t("Actions")),1)])),_:1})])),default:f((()=>[!v(Fe)&&v(Me).length>0?(t(),y(z,{key:0,shape:"rounded"},{default:f((()=>[p(I,{type:"grow",class:"bg-info-100 text-info-700 dark:bg-info-700 dark:text-info-100 rounded-lg"},{default:f((()=>[x("div",le,[x("span",null,w(l.$t("You have selected"))+" "+w(v(Me).length)+" "+w(l.$t("items of the total"))+" "+w(v(Oe).length)+" "+w(l.$t("items"))+". ",1),p(E,{color:"danger",size:"xs",shape:"curved",onClick:d[3]||(d[3]=e=>(v(Me),void(Le.value=!0))),"data-nui-tooltip":"Delete roles"},{default:f((()=>[p(r,{name:"line-md:close-small",class:"h-5 w-5"})])),_:1})])])),_:1})])),_:1})):_("",!0),v(Fe)?(t(),s(b,{key:1},C(5,(e=>p(z,{key:e,shape:"rounded"},{default:f((()=>[p(I,{type:"shrink","data-content":"Selection"},{default:f((()=>[x("div",te,[p(q,{modelValue:v(Me),"onUpdate:modelValue":d[4]||(d[4]=e=>g(Me)?Me.value=e:null),name:`placeload-item-checkbox-${e}`,shape:"curved",class:"text-primary-500"},null,8,["modelValue","name"])])])),_:2},1024),p(I,{type:"grow",class:"md:justify-start","data-content":"Name"},{default:f((()=>[p(L,{class:"h-[46px] w-[46px] shrink-0 rounded-xl"})])),_:1}),p(I,{class:"text-end md:text-start","data-content":"Permissions",light:""},{default:f((()=>[p(L,{class:"h-3 w-24 rounded-lg"})])),_:1}),p(I,{type:"grow",class:"md:justify-end text-end","data-content":"Actions"},{default:f((()=>[p(L,{class:"h-8 w-16 rounded-lg"})])),_:1})])),_:2},1024))),64)):(t(!0),s(b,{key:2},C(v(Je),(e=>(t(),y(z,{key:e.id,shape:"rounded"},{default:f((()=>[p(I,{"data-content":"Selection",type:"shrink"},{default:f((()=>[x("div",se,[p(q,{modelValue:v(Me),"onUpdate:modelValue":d[5]||(d[5]=e=>g(Me)?Me.value=e:null),value:e.id,name:`item-checkbox-${e.id}`,shape:"rounded",class:"text-primary-500"},null,8,["modelValue","value","name"])])])),_:2},1024),p(I,{"data-content":"Name",type:"grow",class:"text-end md:text-start md:justify-start"},{default:f((()=>[x("div",oe,w(e.name),1)])),_:2},1024),p(I,{class:"text-end md:text-start","data-content":"Permissions",light:""},{default:f((()=>[k(w(e.rolepermission?.length??0),1)])),_:2},1024),p(I,{"data-content":"Actions",type:"grow",class:"md:justify-end text-end"},{default:f((()=>[x("span",ne,[p(E,{flavor:"outline",color:"info",shadow:"hover",onClick:a=>(e=>{n(e);const a=e.id;Pe.push({path:`/admin/roles/${a}`})})(e),"data-nui-tooltip":"View Role"},{default:f((()=>[p(Be,{name:"line-md:computer",class:"h-4 w-4"})])),_:2},1032,["onClick"]),p(E,{color:"warning",flavor:"outline",shadow:"hover",onClick:a=>(e=>{n(e),Ze("name",e.name),ze.value=!0})(e),"data-nui-tooltip":"Edit Role"},{default:f((()=>[p(r,{name:"line-md:edit",class:"h-4 w-4"})])),_:2},1032,["onClick"]),p(E,{disabled:"User"===e.name,color:"User"===e.name?"muted":"danger",flavor:"outline",shadow:"hover",onClick:a=>(e=>{n(e),Le.value=!0})(e),"data-nui-tooltip":"Delete Role"},{default:f((()=>[p(r,{name:"line-md:close-small",class:"h-5 w-5"})])),_:2},1032,["disabled","color","onClick"])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})])):(t(),y(m,{key:0,title:v(qe)&&""!==v(qe)?"No matching results":"No results",subtitle:v(qe)&&""!==v(qe)?"Looks like we couldn't find any matching results for your search terms. Try other search terms.":"Looks like we don't have any data here yet."},{image:f((()=>[K,Q])),_:1},8,["title","subtitle"])),x("div",de,[v(Oe).length>v(De)?(t(),y(Xe,{key:0,"total-items":v(Oe).length,"item-per-page":v(De),"current-page":v(Ee)},null,8,["total-items","item-per-page","current-page"])):_("",!0)])])])),_:1}),p(Qe,{open:v(Ie),size:"sm",onClose:d[8]||(d[8]=e=>Ie.value=!1)},{header:f((()=>[x("div",ie,[x("h3",ue,w(l.$t("Create New Role")),1),p(Ge,{onClick:d[6]||(d[6]=e=>Ie.value=!1)})])])),footer:f((()=>[x("div",pe,[x("div",fe,[p(c,{onClick:d[7]||(d[7]=e=>Ie.value=!1)},{default:f((()=>[k(w(l.$t("Cancel")),1)])),_:1}),p(c,{color:"primary",flavor:"solid",onClick:v(ea),disabled:v(Ke),loading:v(Ke)},{default:f((()=>[k(w(l.$t("Create")),1)])),_:1},8,["onClick","disabled","loading"])])])])),default:f((()=>[x("div",re,[x("div",ce,[x("p",me,w(l.$t("Please provide a unique name for the new role"))+". ",1),p(v(O),{name:"name"},{default:f((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[p(i,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:v(Ke),type:"text",label:"Role Name",placeholder:"Enter role name",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1})])])])),_:1},8,["open"]),p(Qe,{open:v(ze),size:"sm",onClose:la},{header:f((()=>[x("div",ve,[x("h3",he,w(l.$t("Edit Role")),1),p(Ge,{onClick:d[9]||(d[9]=e=>ze.value=!1)})])])),footer:f((()=>[x("div",ye,[x("div",ke,[p(c,{onClick:d[10]||(d[10]=e=>ze.value=!1)},{default:f((()=>[k(w(l.$t("Cancel")),1)])),_:1}),p(c,{color:"primary",flavor:"solid",onClick:v(aa),disabled:v(Ke),loading:v(Ke)},{default:f((()=>[k(w(l.$t("Update")),1)])),_:1},8,["onClick","disabled","loading"])])])])),default:f((()=>[x("div",ge,[x("div",xe,[x("p",we,w(l.$t("Please update the role information"))+". ",1),p(v(O),{name:"name"},{default:f((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[p(i,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,disabled:v(Ke),type:"text",label:"Role Name",placeholder:"Enter role name",classes:{input:"h-12",wrapper:"max-w-xs"},onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","disabled","onBlur"])])),_:1})])])])),_:1},8,["open"]),p(Qe,{open:v(Le),size:"sm",onClose:d[14]||(d[14]=e=>Le.value=!1)},{header:f((()=>[x("div",_e,[x("h3",be,w(l.$t("Delete"))+" "+w(v(Me).length>0?"Roles":"Role"),1),p(Ge,{onClick:d[11]||(d[11]=e=>Le.value=!1)})])])),footer:f((()=>[x("div",Ve,[x("div",Re,[p(c,{onClick:d[12]||(d[12]=e=>Le.value=!1)},{default:f((()=>[k(w(l.$t("Cancel")),1)])),_:1}),p(c,{color:"danger",flavor:"solid",onClick:d[13]||(d[13]=e=>v(Me).length>0?(async()=>{try{const e=Me.value.map((e=>e)),a=await Te(e);Ue.value=Ue.value.filter((a=>!e.includes(a.id))),Me.value=[],Ae.response(a)}catch(e){Ae.danger(e)}Le.value=!1})():(async()=>{try{const e=await Ne(o.value?.id);Ae.response(e),"success"===e.status&&(Ue.value=Ue.value.filter((e=>e.id!==o.value?.id))),n(null)}catch(e){Ae.danger(e)}Le.value=!1})()),disabled:v(Ke),loading:v(Ke)},{default:f((()=>[k(w(l.$t("Delete")),1)])),_:1},8,["disabled","loading"])])])])),default:f((()=>[x("div",Ce,[x("div",$e,[x("p",je,w(l.$t("Do you really want to delete this"))+" "+w(v(Me).length>0?"these roles":"this role")+"? "+w(l.$t("This process cannot be undone"))+". ",1)])])])),_:1},8,["open"])])}}});export{Be as default};
