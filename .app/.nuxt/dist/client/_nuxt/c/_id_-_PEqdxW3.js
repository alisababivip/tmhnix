import{a as e,ad as t,ac as r,z as a,c as s,E as o,r as l,J as d,O as n,w as u,o as i,e as m,q as c,t as p,u as v,f,p as h,W as y,b,A as g,F as x,B as w,n as k,k as j,_,x as B,X as C,Y as P}from"../e/entry-8qgg5CL-.js";import{_ as U}from"./BaseInput.vue-iInHQMIA.js";import{_ as V}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as M}from"./BaseTextarea.vue-8st5U0qk.js";import{_ as S}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as F}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as I}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as $}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as D}from"./useP2P-NV4dmDWU.js";import{u as q}from"./fiatCurrency-EA2f5t5g.js";import{u as z}from"./fetch-i3Y1jjTS.js";import{b as T}from"./strings-rQgUKePI.js";import{_ as W}from"./placeholder-file-IxKzOaSl.js";import{z as R,u as A,t as J,F as N}from"./vee-validate.esm-n59zZCC5.js";import{u as O}from"./payment-methods-MEQZc0hn.js";import"./input-id-wZ-Ta08j.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";const E={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},K=f("small",null,[f("span",{class:"text-xs text-warning-500"}," Select a currency to get paid with ")],-1),L={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},G=["onDrop"],H=["onClick","onKeydown"],X={class:"p-5 text-center"},Y={class:"text-muted-400 font-sans text-sm"},Q={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},Z={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},ee={key:1,class:"mt-6 space-y-2"},te={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},re={class:"flex items-center gap-2"},ae={class:"shrink-0"},se=["src"],oe={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:W,alt:"Image preview"},le={class:"font-sans"},de={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},ne={class:"text-muted-400 block text-xs"},ue={class:"flex gap-2"},ie={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},me=f("span",{class:"sr-only"},"Cancel",-1),ce={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},pe=f("span",{class:"sr-only"},"Upload",-1),ve=["onClick"],fe=f("span",{class:"sr-only"},"Remove",-1),he={key:0,class:"mb-4 h-36 w-full flex items-center justify-center overflow-hidden rounded-xl"},ye=["src"],be=e({__name:"[id]",setup(e){const{toast:W}=t(),be=r(),{id:ge}=a().params,xe=O(),{updateUserPaymentMethod:we}=D(),ke=s((()=>xe.selectedMethod||xe.getPaymentMethodById(ge))),je=q(),_e=s((()=>je.currencies));o((async()=>{const e=Number(ge);0===xe.methods.length&&await xe.fetchPaymentMethods(),await xe.selectPaymentMethodById(e),0===je.currencies.length&&await je.fetchCurrencies(),Ve()}));const Be=R.object({name:R.string().nonempty("Name is required"),instructions:R.string().nonempty("Instructions is required"),currency:R.string().nonempty("Currency is required")}),Ce=s((()=>({...ke.value}))),{handleSubmit:Pe,isSubmitting:Ue,resetForm:Ve,values:Me}=A({validationSchema:J(Be),initialValues:Ce}),Se=l(null),Fe=l(ke.value?.image??null);d(Se,(e=>{const t=e?.item(0)||null;if(Se.value){const e=new FileReader;e.onload=e=>{Fe.value=e.target?.result},e.readAsDataURL(t)}}));const Ie=Pe((async e=>{try{let t={...e,image:Fe.value??""};if(Se.value){const e=new FormData;e.append("files",Se.value[0]),e.append("type","p2pPaymentMethod");const r=await z("/api/upload",{method:"POST",body:e},"$3sGJdk4FWq");r&&""!==r.data.value&&(t.image=r.data.value[0])}const r=await we(ke.value?.id,t.name,t.instructions,t.currency,t.image);W.response(r),"success"===r.status&&(await xe.fetchPaymentMethods(),be.push("/user/p2p/payment-methods"))}catch(t){W.danger(t)}}));return(e,t)=>{const r=_,a=B,s=C,o=U,l=V,d=M,D=P,q=S,z=F,W=I,R=$;return i(),n(R,null,{left:u((()=>[m(r,{size:"lg"},{default:u((()=>[c(p(e.$t("Update P2P Payment Method")),1)])),_:1})])),right:u((()=>[m(s,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/user/p2p/payment-methods"},{default:u((()=>[m(a,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),c(" "+p(e.$t("Back")),1)])),_:1}),m(s,{type:"submit",color:"primary",disabled:v(Ue),class:"w-full",onClick:v(Ie)},{default:u((()=>[c(p(e.$t("Update")),1)])),_:1},8,["disabled","onClick"])])),default:u((()=>[f("form",{onSubmit:t[3]||(t[3]=(...e)=>v(Ie)&&v(Ie)(...e)),class:"space-y-8"},[m(D,{class:"p-5 space-y-5"},{default:u((()=>[f("div",E,[m(v(N),{name:"name"},{default:u((({field:e,errorMessage:t,handleChange:r,handleBlur:a})=>[m(o,{modelValue:e.value,"onUpdate:modelValue":[t=>e.value=t,r],error:t,label:"Name",shape:"rounded",placeholder:"Enter name",type:"text",onBlur:a},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),f("div",null,[m(v(N),{name:"currency"},{default:u((({field:e,errorMessage:t,handleChange:r,handleBlur:a})=>[m(l,{"model-value":e.value,error:t,items:v(_e)?.map((e=>e.code)),label:"Currency",placeholder:"Select a currency","onUpdate:modelValue":r,onBlur:a},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"]),K])),_:1})])]),m(v(N),{name:"instructions"},{default:u((({field:e,errorMessage:t,handleChange:r,handleBlur:a})=>[m(d,{modelValue:e.value,"onUpdate:modelValue":[t=>e.value=t,r],error:t,label:"Instructions",shape:"rounded",placeholder:"Write the instructions for this payment method",class:"w-full",onBlur:a},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1})])),_:1}),m(D,{class:"p-5"},{default:u((()=>[f("div",L,[m(z,{modelValue:v(Se),"onUpdate:modelValue":t[2]||(t[2]=e=>h(Se)?Se.value=e:null)},{default:u((({open:r,remove:s,preview:o,drop:l,files:d})=>[f("div",{class:"",onDragenter:t[0]||(t[0]=y((()=>{}),["stop","prevent"])),onDragover:t[1]||(t[1]=y((()=>{}),["stop","prevent"])),onDrop:l},[d?.length?(i(),b("ul",ee,[(i(!0),b(x,null,w(d,(t=>(i(),b("li",{key:t.name},[f("div",te,[f("div",re,[f("div",ae,[t.type.startsWith("image")?(i(),b("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:o(t).value,alt:"Image preview"},null,8,se)):(i(),b("img",oe))]),f("div",le,[f("span",de,p(t.name),1),f("span",ne,p(("formatFileSize"in e?e.formatFileSize:v(T))(t.size)),1)])]),f("div",{class:k(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[m(q,{value:0,size:"xs",color:"success"})]),f("div",ue,[f("button",ie,[m(a,{name:"lucide:slash",class:"h-4 w-4"}),me]),f("button",ce,[m(a,{name:"lucide:arrow-up",class:"h-4 w-4"}),pe]),f("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:y((e=>s(t)),["prevent"])},[m(a,{name:"lucide:x",class:"h-4 w-4"}),fe],8,ve)])])])))),128))])):(i(),b("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:r,onKeydown:g(y(r,["prevent"]),["enter"])},[f("div",X,[m(a,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),f("h4",Y,p(e.$t("Drop file to upload")),1),f("div",null,[f("span",Q,p(e.$t("Or")),1)]),f("label",Z,p(e.$t("Select Image")),1)])],40,H))],40,G)])),_:1},8,["modelValue"]),v(Fe)?(i(),b("div",he,[f("img",{src:v(Fe),alt:"Image Preview",class:"max-h-full max-w-full object-cover object-center"},null,8,ye)])):j("",!0)])])),_:1}),m(W,null,{default:u((()=>[m(s,{type:"submit",color:"primary",disabled:v(Ue),class:"w-full"},{default:u((()=>[c(p(e.$t("Update Payment Method")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{be as default};
