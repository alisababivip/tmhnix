import{a as e,ad as r,ac as t,c as a,E as s,r as o,J as l,O as n,w as d,o as i,e as u,q as m,t as c,u as p,f,p as v,W as h,b as y,A as b,F as g,B as x,n as k,k as w,_ as j,x as _,X as B,Y as C}from"../e/entry-8qgg5CL-.js";import{_ as P}from"./BaseInput.vue-iInHQMIA.js";import{_ as V}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as S}from"./BaseTextarea.vue-8st5U0qk.js";import{_ as M}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as U}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as F}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as I}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as $}from"./useP2P-NV4dmDWU.js";import{u as D}from"./fiatCurrency-EA2f5t5g.js";import{u as z}from"./fetch-i3Y1jjTS.js";import{b as q}from"./strings-rQgUKePI.js";import{_ as T}from"./placeholder-file-IxKzOaSl.js";import{z as W,u as R,t as A,F as O}from"./vee-validate.esm-n59zZCC5.js";import{u as E}from"./payment-methods-MEQZc0hn.js";import"./input-id-wZ-Ta08j.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";const J={class:"grid gap-5 grid-cols-1 md:grid-cols-2"},K=f("small",null,[f("span",{class:"text-xs text-warning-500"}," Select a currency to get paid with ")],-1),L={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},N=["onDrop"],Y=["onClick","onKeydown"],H={class:"p-5 text-center"},Q={class:"text-muted-400 font-sans text-sm"},X={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},G={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},Z={key:1,class:"mt-6 space-y-2"},ee={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},re={class:"flex items-center gap-2"},te={class:"shrink-0"},ae=["src"],se={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:T,alt:"Image preview"},oe={class:"font-sans"},le={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},ne={class:"text-muted-400 block text-xs"},de={class:"flex gap-2"},ie={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},ue=f("span",{class:"sr-only"},"Cancel",-1),me={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},ce=f("span",{class:"sr-only"},"Upload",-1),pe=["onClick"],fe=f("span",{class:"sr-only"},"Remove",-1),ve={key:0,class:"mb-4 h-36 w-full flex items-center justify-center overflow-hidden rounded-xl"},he=["src"],ye=e({__name:"create",setup(e){const{toast:T}=r(),ye=t(),be=E(),{createUserPaymentMethod:ge}=$(),xe=D(),ke=a((()=>xe.currencies));s((async()=>{0===xe.currencies.length&&await xe.fetchCurrencies(),Ce()}));const we=W.object({name:W.string().nonempty("Name is required"),instructions:W.string().nonempty("Instructions is required"),currency:W.string().nonempty("Currency is required")}),je=a((()=>({name:"",instructions:"",currency:""}))),{handleSubmit:_e,isSubmitting:Be,resetForm:Ce}=R({validationSchema:A(we),initialValues:je}),Pe=o(null),Ve=o(null);l(Pe,(e=>{const r=e?.item(0)||null;if(Pe.value){const e=new FileReader;e.onload=e=>{Ve.value=e.target?.result},e.readAsDataURL(r)}}));const Se=_e((async e=>{try{let r={...e,image:""};if(Pe.value){const e=new FormData;e.append("files",Pe.value[0]),e.append("type","p2pPaymentMethod");const t=await z("/api/upload",{method:"POST",body:e},"$MWMQz7mgYd");t&&""!==t.data.value&&(r.image=t.data.value[0])}const t=await ge(r.name,r.instructions,r.currency,r.image);T.response(t),"success"===t.status&&(await be.fetchPaymentMethods(),ye.push("/user/p2p/payment-methods"))}catch(r){T.danger(r)}}));return(e,r)=>{const t=j,a=_,s=B,o=P,l=V,$=S,D=C,z=M,T=U,W=F,R=I;return i(),n(R,null,{left:d((()=>[u(t,{size:"lg"},{default:d((()=>[m(c(e.$t("Create P2P Payment Method")),1)])),_:1})])),right:d((()=>[u(s,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/user/p2p/payment-methods"},{default:d((()=>[u(a,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),m(" "+c(e.$t("Back")),1)])),_:1}),u(s,{type:"submit",color:"primary",disabled:p(Be),class:"w-full",onClick:p(Se)},{default:d((()=>[m(c(e.$t("Create Payment Method")),1)])),_:1},8,["disabled","onClick"])])),default:d((()=>[f("form",{onSubmit:r[3]||(r[3]=(...e)=>p(Se)&&p(Se)(...e)),class:"space-y-8"},[u(D,{class:"p-5 space-y-5"},{default:d((()=>[f("div",J,[u(p(O),{name:"name"},{default:d((({field:e,errorMessage:r,handleChange:t,handleBlur:a})=>[u(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,t],error:r,label:"Name",shape:"rounded",placeholder:"Enter name",type:"text",onBlur:a},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),f("div",null,[u(p(O),{name:"currency"},{default:d((({field:e,errorMessage:r,handleChange:t,handleBlur:a})=>[u(l,{"model-value":e.value,error:r,items:p(ke)?.map((e=>e.code)),label:"Currency",placeholder:"Select a currency","onUpdate:modelValue":t,onBlur:a},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"]),K])),_:1})])]),u(p(O),{name:"instructions"},{default:d((({field:e,errorMessage:r,handleChange:t,handleBlur:a})=>[u($,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,t],error:r,label:"Instructions",shape:"rounded",placeholder:"Write the instructions for this payment method",class:"w-full",onBlur:a},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1})])),_:1}),u(D,{class:"p-5"},{default:d((()=>[f("div",L,[u(T,{modelValue:p(Pe),"onUpdate:modelValue":r[2]||(r[2]=e=>v(Pe)?Pe.value=e:null)},{default:d((({open:t,remove:s,preview:o,drop:l,files:n})=>[f("div",{class:"",onDragenter:r[0]||(r[0]=h((()=>{}),["stop","prevent"])),onDragover:r[1]||(r[1]=h((()=>{}),["stop","prevent"])),onDrop:l},[n?.length?(i(),y("ul",Z,[(i(!0),y(g,null,x(n,(r=>(i(),y("li",{key:r.name},[f("div",ee,[f("div",re,[f("div",te,[r.type.startsWith("image")?(i(),y("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:o(r).value,alt:"Image preview"},null,8,ae)):(i(),y("img",se))]),f("div",oe,[f("span",le,c(r.name),1),f("span",ne,c(("formatFileSize"in e?e.formatFileSize:p(q))(r.size)),1)])]),f("div",{class:k(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[u(z,{value:0,size:"xs",color:"success"})]),f("div",de,[f("button",ie,[u(a,{name:"lucide:slash",class:"h-4 w-4"}),ue]),f("button",me,[u(a,{name:"lucide:arrow-up",class:"h-4 w-4"}),ce]),f("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:h((e=>s(r)),["prevent"])},[u(a,{name:"lucide:x",class:"h-4 w-4"}),fe],8,pe)])])])))),128))])):(i(),y("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:t,onKeydown:b(h(t,["prevent"]),["enter"])},[f("div",H,[u(a,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),f("h4",Q,c(e.$t("Drop file to upload")),1),f("div",null,[f("span",X,c(e.$t("Or")),1)]),f("label",G,c(e.$t("Select Image")),1)])],40,Y))],40,N)])),_:1},8,["modelValue"]),p(Ve)?(i(),y("div",ve,[f("img",{src:p(Ve),alt:"Image Preview",class:"max-h-full max-w-full object-cover object-center"},null,8,he)])):w("",!0)])])),_:1}),u(W,null,{default:d((()=>[u(s,{type:"submit",color:"primary",disabled:p(Be),class:"w-full"},{default:d((()=>[m(c(e.$t("Create Payment Method")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{ye as default};
