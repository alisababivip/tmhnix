import{a as e,Q as t,c as a,ap as s,ad as l,r,E as n,J as i,b as o,e as c,w as u,f as d,u as v,O as m,k as g,Y as y,C as p,a3 as f,o as x,t as h,F as k,B as w,T as _,P as b,x as $,c7 as E,c5 as A,y as C}from"../e/entry-8qgg5CL-.js";import{_ as M}from"./BaseButtonIcon.vue-6tAU_b7C.js";import{u as R}from"./useMlm-tZO3tueF.js";import{h as T,s as N,t as z,l as I,i as j,z as O,a as P}from"./zoom-Dvlwhkg1.js";const L=e=>(E("data-v-c9461efd"),e=e(),A(),e),S={class:"overflow-hidden space-y-5"},U={class:"flex gap-5 items-center mb-5"},B=["src"],F={class:"text-gray-700 dark:text-gray-300"},Y={class:"text-gray-600 dark:text-gray-400"},G={class:"flex flex-col text-xs"},H={class:"flex justify-between gap-5"},V=L((()=>d("span",{class:"text-gray-700 dark:text-gray-300"},"Level Percentage",-1))),D={class:"text-gray-600 dark:text-gray-400"},J=L((()=>d("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1))),K={class:"flex justify-between gap-5"},Q={class:"text-gray-700 dark:text-gray-300"},W={class:"text-gray-600 dark:text-gray-400"},X={class:"grid gap-8 grid-cols-1 sm:grid-cols-12 pb-20"},q={class:"col-span-1 sm:col-span-3"},Z={class:"max-w-[240px]"},ee={class:"space-y-1 font-sans text-sm"},te={class:"col-span-1 sm:col-span-9"},ae=e({__name:"settings",setup(e){const E=t(),A=a((()=>E.settings)),C=a((()=>A.value&&A.value.mlm_system?A.value.mlm_system.toLowerCase():"direct")),L=s(),ae=a((()=>L.extensionsUser)),{getReferralConditions:se}=R(),{toast:le}=l(),re=r(!1),ne=r([]),ie=r([]),oe=r(null),ce=r(null),ue=40,de=120,ve=20,me=160;let ge,ye;const pe=r(!1),fe=r([]);function xe(e=3,t=3){let a,s;switch(a="direct"!==C.value&&A.value&&A.value.mlm_settings&&A.value.mlm_settings[C.value]?A.value.mlm_settings[C.value].levels_percentage:[{level:1,value:100},{level:2,value:0}],t="binary"===C.value?2:t,C.value){case"binary":s=A.value.mlm_settings?.binary?.levels||e;break;case"unilevel":s=A.value.mlm_settings?.unilevel?.levels||e;break;default:s=2}const l=a.length>0&&a.find((e=>1===e.level))?.value||0,r=ie.value.reduce(((e,t)=>(e[t.title]=`${Number(t.reward*l/100).toFixed(2)}${"PERCENTAGE"===t.reward_type?"%":" "+t.reward_currency}`,e)),{});return{uuid:"user1",first_name:"Root Referrer",level:1,avatar:"/img/avatars/1.svg",percentage:l,downlines:function e(t,s,l,r=""){return t>s?[]:Array.from({length:l},((n,i)=>{const o=`${r}user${t}-${i}`,c=`User ${String.fromCharCode(64+t)}${i}`,u=a.length>0&&a.find((e=>e.level===t))?.value||0,d=ie.value.reduce(((e,t)=>(e[t.title]=`${Number(t.reward*u/100).toFixed(2)}${"PERCENTAGE"===t.reward_type?"%":" "+t.reward_currency}`,e)),{});return{uuid:o,first_name:c,level:t,avatar:`/img/avatars/${i+1+t}.svg`,percentage:u,downlines:e(t+1,s,"unilevel"===C.value?Math.floor(3*Math.random())+1:l,`${o}-`),rewards:d}}))}(2,s,t),rewards:r}}function he(e,t,a=3){const s=T(t,(e=>e.downlines)),l=112*s.leaves().length,r=Math.max(e.clientWidth,l),n=s.height,i=172*(n+1)+ue+ve,o=Math.max(e.clientHeight,i),c=r-me-de,u=o-ue-ve;N(e).selectAll("svg").remove();const d=e.clientHeight;N(e).selectAll("svg").remove(),ge=N(e).append("svg").style("width","100%").style("height","100%").attr("viewBox",`0 0 ${c+me+de} ${d}`).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform",`translate(${me},${ue})`);const v=3e3*a/2;for(let _=-v;_<=v;_+=50)ge.append("line").attr("x1",-v).attr("y1",_).attr("x2",v).attr("y2",_).attr("stroke-width",.1).attr("class","stroke-gray-600 dark:stroke-gray-400");for(let _=-v;_<=v;_+=50)ge.append("line").attr("x1",_).attr("y1",-v).attr("x2",_).attr("y2",v).attr("stroke-width",.1).attr("class","stroke-gray-600 dark:stroke-gray-400");const m=Math.max(c,r),g=z().size([m,u]),y=T(t,(e=>e.downlines));g(y),y.descendants().forEach((e=>{e.y=172*e.depth,e.x=e.x-r/2+c/2})),ge.selectAll(".link").data(y.links()).enter().append("path").attr("class","link").style("fill","none").style("stroke","#ccc").style("stroke-width","1px").attr("d",I().x((e=>e.x)).y((e=>e.y)));const p=ge.selectAll(".node").data(y.descendants()).enter().append("g").attr("transform",(e=>`translate(${e.x},${e.y})`)).attr("class","node grayscale");p.append("foreignObject").attr("width",72).attr("height",72).attr("x",-36).attr("y",-36).append("xhtml:body").style("margin","0").style("padding","0").style("background-color","none").style("width","72px").style("height","72px").attr("class","transform hover:scale-110 transition-all duration-300 cursor-pointer").html((e=>`<img src='${e.data.avatar||"/img/placeholder.png"}'\n                alt='User Avatar'\n                style='border-radius: 50%; width: 100%; height: 100%; object-fit: cover;'\n                class='p-1'\n                />`)),p.on("click",((e,t)=>function(e){ce.value=e,P(".node").classed("grayscale-0",!1),P(".link").style("stroke","#ccc");const t=P(".node").filter((t=>t.data.uuid===e.uuid));if(!t.empty()){t.classed("grayscale-0",!0);const e=t.datum().ancestors();P(".link").style("stroke",(t=>e.includes(t.target)?"#EE4E34":"#ccc")).style("stroke-width",(t=>e.includes(t.target)?"2px":"1px")),P(".node").filter((t=>e.includes(t))).classed("grayscale-0",!0)}}(t.data)));const f=c/2-v,x=u/2-v,h=v-c/2,k=v-u/2,w=j.translate(me,ue);ye=O().scaleExtent([.7,3]).on("zoom",(e=>{const t=e.transform,a=Math.max(Math.min(t.x,h*t.k),f*t.k),s=Math.max(Math.min(t.y,k*t.k),x*t.k);ge.attr("transform",`translate(${a},${s}) scale(${t.k})`),pe.value=!(t.x===w.x&&t.y===w.y&&1===t.k)})),N(e).select("svg").call(ye).call(ye.transform,w).on("dblclick.zoom",null)}function ke(){N(oe.value).select("svg").call(ye.transform,j),ge.transition().duration(750).attr("transform",`translate(${me},${ue}) scale(1)`),pe.value=!1}function we(){ce.value=null,P(".node").classed("grayscale-0",!1),P(".link").style("stroke","#ccc").style("stroke-width","1px")}return n((async()=>{re.value=!0;try{const e=await se();"success"===e.status?(fe.value=e.data.result.filter((e=>e.status)),ie.value=fe.value.filter((e=>{switch(e.name){case"STAKING_LOYALTY":return ae.value.staking;case"FOREX_INVESTMENT":return ae.value.forex;case"AI_INVESTMENT":return ae.value.ai_trading;case"P2P_TRADE":return ae.value.p2p;case"ECOMMERCE_PURCHASE":return ae.value.ecommerce;case"ICO_CONTRIBUTION":return ae.value.ico;default:return!0}}))):le.danger(e.message),A.value&&A.value.mlm_settings?ne.value=xe("direct"===C.value?2:A.value.mlm_settings[C.value].levels):ne.value=xe(2),oe.value&&he(oe.value,ne.value),re.value=!1}catch(e){le.danger(e)}})),i((()=>A.value.mlm_system),((e,t)=>{e!==t&&async function(){re.value=!0;try{const e=xe();ne.value=e,oe.value&&(N(oe.value).selectAll("svg").remove(),he(oe.value,ne.value,"direct"===C.value?1:A.value.mlm_settings[C.value].levels)),re.value=!1}catch(e){console.error("Error updating tree:",e)}}()})),i((()=>A.value.mlm_settings),((e,t)=>{if(e!==t){const e=xe("direct"===C.value?1:A.value.mlm_settings[C.value].levels);ne.value=e,oe.value&&(N(oe.value).selectAll("svg").remove(),he(oe.value,ne.value))}}),{deep:!0}),(e,t)=>{const a=$,s=M,l=y,r=p,n=f("RouterView");return x(),o("div",S,[c(l,{class:"flex justify-center items-center relative",shape:"curved"},{default:u((()=>[v(pe)?(x(),m(s,{key:0,size:"sm",onClick:ke,class:"absolute top-3 right-3 z-50 shadow-md"},{default:u((()=>[c(a,{name:"fluent:resize-small-20-regular",class:"w-8 h-8"})])),_:1})):g("",!0),v(ce)?(x(),m(l,{key:1,elevated:"",color:"white-contrast",class:"p-5 w-auto absolute top-3 left-3 mr-5 z-50"},{default:u((()=>[c(a,{name:"fluent:dismiss-24-regular",onClick:we,class:"absolute top-1 right-1 w-4 h-4 cursor-pointer text-gray-500 dark:text-gray-400 hover:text-danger-500 dark:hover:text-danger-500"}),d("div",U,[d("img",{src:v(ce).avatar||"/img/placeholder.png",alt:"User Avatar",class:"rounded-full w-16 h-16"},null,8,B),d("div",null,[d("h3",F,h(v(ce).first_name)+" "+h(v(ce).last_name),1),d("p",Y," Level: "+h(v(ce).level),1)])]),d("div",G,[d("div",H,[V,d("span",D,h(v(ce).percentage)+"% ",1)])]),J,(x(!0),o(k,null,w(v(ce).rewards,((e,t)=>(x(),o("div",{class:"flex flex-col text-xs",key:t},[d("div",K,[d("span",Q,h(t),1),d("span",W,h(e),1)])])))),128))])),_:1})):g("",!0),d("div",{class:"relative w-full overflow-hidden z-0 rounded-2xl h-[40vh]",ref_key:"networkContainer",ref:oe},null,512)])),_:1}),d("div",X,[d("div",q,[d("div",Z,[d("ul",ee,[d("li",null,[c(r,{to:"/admin/extensions/affiliate/settings","exact-active-class":"!text-primary-500 !bg-primary-500/10",class:"text-muted-400 hover:text-muted-600 dark:hover:text-muted-200 hover:bg-muted-50 dark:hover:bg-muted-700/50 flex items-center gap-2 rounded-lg p-3 transition-colors duration-300"},{default:u((()=>[c(a,{name:"ph:gear-six-duotone",class:"h-4 w-4"}),d("span",null,h(e.$t("Affiliate System")),1)])),_:1})]),d("li",null,["DIRECT"!==v(A).mlm_system?(x(),m(r,{key:0,to:"/admin/extensions/affiliate/settings/levels","exact-active-class":"!text-primary-500 !bg-primary-500/10",class:"text-muted-400 hover:text-muted-600 dark:hover:text-muted-200 hover:bg-muted-50 dark:hover:bg-muted-700/50 flex items-center gap-2 rounded-lg p-3 transition-colors duration-300"},{default:u((()=>[c(a,{name:"ph:users-three-duotone",class:"h-4 w-4"}),d("span",null,h(e.$t("Levels")),1)])),_:1})):g("",!0)]),d("li",null,[c(r,{to:"/admin/extensions/affiliate/settings/conditions","exact-active-class":"!text-primary-500 !bg-primary-500/10",class:"text-muted-400 hover:text-muted-600 dark:hover:text-muted-200 hover:bg-muted-50 dark:hover:bg-muted-700/50 flex items-center gap-2 rounded-lg p-3 transition-colors duration-300"},{default:u((()=>[c(a,{name:"material-symbols:rule-rounded",class:"h-4 w-4"}),d("span",null,h(e.$t("Conditions")),1)])),_:1})])])])]),d("div",te,[c(n,null,{default:u((({Component:e})=>[c(_,{"enter-active-class":"transition-all duration-500 ease-out","enter-from-class":"translate-y-20 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-20 opacity-0"},{default:u((()=>[(x(),m(b(e)))])),_:2},1024)])),_:1})])])])}}}),se=C(ae,[["__scopeId","data-v-c9461efd"]]);export{se as default};
