import{a as e,c as t,ad as a,r as s,o as l,b as r,F as n,B as i,O as c,w as d,f as o,t as u,e as m,u as p,n as x,q as f,x as v,Y as y,X as g,z as b,E as w,ac as h,k,ao as _,C as j,an as C}from"../e/entry-8qgg5CL-.js";import{_ as $}from"./BaseTextarea.vue-8st5U0qk.js";import{u as B}from"./useEcommerce-2nLxpPKu.js";import{z as T,u as D,F as M,t as V}from"./vee-validate.esm-n59zZCC5.js";import{_ as q}from"./BaseTabs.vue-L62ISjad.js";import{_ as F}from"./BaseInput.vue-iInHQMIA.js";import{_ as P}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as S}from"./useWallet-8iHzU2hV.js";import{a as L}from"./strings-rQgUKePI.js";import"./input-id-wZ-Ta08j.js";const I={class:"space-y-2"},U={class:"flex justify-between items-center"},O={class:"flex items-center gap-4"},W=["src"],z={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},A={class:"mt-4 text-sm text-gray-500 dark:text-gray-400"},R={class:"col-span-12"},E=e({__name:"Review",props:{product:{type:Object,required:!0},fetchProduct:{type:Function,required:!0}},setup(e){const b=e,{createReview:w}=B(),h=T.object({comment:T.string().min(1,"comment is required")}),k=V(h),_=t((()=>({comment:""}))),{handleSubmit:j,isSubmitting:C,resetForm:q}=D({validationSchema:k,initialValues:_}),{toast:F}=a(),P=s(0),S=s(0),L=j((async e=>{const t=await w(b.product.id,P.value,e.comment);F.response(t),await b.fetchProduct(),q(),P.value,S.value}));return(t,a)=>{const s=v,b=y,w=$,h=g;return l(),r("div",I,[(l(!0),r(n,null,i(e.product.reviews,((e,t)=>(l(),c(b,{class:"p-5"},{default:d((()=>[o("div",U,[o("div",O,[o("img",{src:e.user?.avatar??`/img/avatars/${t+1}.svg`,class:"w-10 h-10 rounded-full"},null,8,W),o("h3",z,u(e.user?.first_name)+" "+u(e.user?.last_name),1)]),o("div",null,[(l(),r(n,null,i(5,(t=>o("span",null,[t<=e.rating?(l(),c(s,{key:0,name:"uim:star",class:"w-4 h-4 text-yellow-400"})):(l(),c(s,{key:1,name:"uim:star",class:"w-4 h-4 text-gray-300"}))]))),64))])]),o("p",A,u(e.comment),1)])),_:2},1024)))),256)),m(b,{class:"p-5 space-y-5"},{default:d((()=>[(l(),r(n,null,i(5,(e=>o("span",{key:e},[m(s,{name:"uim:star",class:x(["w-5 h-5",{"text-yellow-400":e<=(p(S)||p(P)),"text-gray-300":e>(p(S)||p(P)),"hover:text-yellow-400":null===p(S)}]),onMouseover:t=>S.value=e,onMouseleave:a[0]||(a[0]=e=>S.value=null),onClick:t=>P.value=e},null,8,["class","onMouseover","onClick"])]))),64)),m(p(M),{name:"comment"},{default:d((({field:e,errorMessage:t,handleChange:a,handleBlur:s})=>[m(w,{label:"Message",placeholder:"write your message...","model-value":e.value,error:t,disabled:p(C),"onUpdate:modelValue":a,onBlur:s},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1}),o("div",R,[m(h,{type:"submit",class:"w-full",color:"primary",disabled:p(C),loading:p(C),onClick:p(L)},{default:d((()=>[f("Submit ")])),_:1},8,["disabled","loading","onClick"])])])),_:1})])}}}),H={class:"px-5"},X={class:"grid max-w-screen-xl py-8 mx-auto lg:gap-8 xl:gap-0 lg:py-16 lg:grid-cols-12 px-5"},Y={class:"mr-auto place-self-center lg:col-span-6"},G={class:"max-w-2xl mb-4 text-4xl font-extrabold tracking-tight leading-none md:text-5xl xl:text-6xl dark:text-white"},J={class:"max-w-2xl mb-6 font-light text-gray-500 lg:mb-8 md:text-lg lg:text-xl dark:text-gray-400"},K={class:"mb-5 flex items-end"},N={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},Q={class:"divide-muted-200 dark:divide-muted-700 flex items-center justify-center divide-x"},Z={class:"flex flex-col gap-1 pr-4"},ee={class:"flex flex-col gap-1 pl-4 text-center font-bold text-xl"},te={key:0},ae={key:1},se={class:"lg:mt-0 lg:col-span-6 rounded-2xl max-w-xl mt-5 md:mt-0"},le=["src","alt"],re={class:"grid grid-col-1 gap-5 md:grid-cols-4"},ne={key:0,class:"px-5"},ie=["innerHTML"],ce={key:1,class:"font-sans text-sm text-gray-500 dark:text-gray-400"},de=o("div",{class:"font-bold p-2"},"Details",-1),oe={class:"divide-y divide-muted-200 dark:divide-muted-700"},ue={class:"text-xs flex justify-between p-2"},me=o("span",{class:"font-bold"},"Category",-1),pe={class:"text-xs flex justify-between p-2"},xe=o("span",{class:"font-bold"},"Type",-1),fe={class:"text-xs flex justify-between p-2"},ve=o("span",{class:"font-bold"},"Inventory",-1),ye={class:"text-xs flex justify-between p-2"},ge=o("span",{class:"font-bold"},"Created at",-1),be={class:"flex w-full items-center justify-between p-4 md:p-6"},we={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},he={class:"px-4 md:px-6 space-y-5"},ke={key:0,class:"flex items-start gap-2 w-full"},_e={class:"w-full"},je={key:0},Ce={class:"text-xs text-danger-500"},$e={key:1},Be={class:"flex justify-between items-center"},Te={class:"text-success-500 dark:text-success-400"},De={class:"space-y-1"},Me={class:"flex justify-between items-center text-sm"},Ve={class:"text-muted-800 dark:text-muted-200"},qe={class:"text-muted-800 dark:text-muted-200 items-center flex gap-1"},Fe={class:"flex justify-between items-center text-sm"},Pe={class:"text-muted-800 dark:text-muted-200"},Se={class:"text-muted-800 dark:text-muted-200 items-center flex gap-1"},Le={class:"flex justify-between items-center text-sm"},Ie={class:"text-muted-800 dark:text-muted-200"},Ue={class:"text-muted-800 dark:text-muted-200 items-center flex gap-1"},Oe=o("hr",{class:"border-gray-200 dark:border-gray-700"},null,-1),We={class:"flex justify-between items-center text-sm"},ze={class:"text-muted-800 dark:text-muted-200"},Ae={class:"text-muted-800 dark:text-muted-200 items-center flex gap-1"},Re={class:"p-4 md:p-6"},Ee={class:"flex gap-x-2"},He=e({__name:"[id]-[name]",setup(e){const{getUserProduct:x,applyDiscount:$,createOrder:I}=B(),{fetchWallet:U}=S(),O=b(),{id:W,name:z}=O.params,A=s({}),R=s({});w((async()=>{await He()}));const He=async()=>{const e=await x(W);A.value=e.data.result;const t=await U(A.value?.currency,A.value?.wallet_type);R.value=t.data.result},Xe=t((()=>{const e=A.value.reviews||[],t=e.reduce(((e,t)=>e+t.rating),0);return e.length?t/e.length:0})),Ye=T.object({code:T.string().min(1,"The code field is required.")}),Ge=V(Ye),Je=t((()=>({code:""}))),{handleSubmit:Ke,isSubmitting:Ne,resetForm:Qe}=D({validationSchema:Ge,initialValues:Je}),{toast:Ze,formatedPrice:et}=a(),tt=s(!1),at=()=>{tt.value=!1,Qe()},st=s(null),lt=s(null),rt=Ke((async e=>{try{const t=await $(W,e.code);"success"===t.status?st.value=t.data.result:lt.value=t.error.message}catch(t){lt.value=t.message,Ze.danger(t)}}));function nt(e){const t=Math.floor(Xe.value);return e<=t?"full":e===t+1&&Xe.value%1>=.5?"half":"empty"}const it=h(),ct=async()=>{try{const e=await I(A.value?.id,st.value?.id);Ze.response(e),"success"===e.status&&(await He(),it.push("/user/shop/orders"))}catch(e){Ze.danger(e)}tt.value=!1};return(e,t)=>{const a=v,s=g,x=E,b=q,w=y,h=_,$=F,B=j,T=C,D=P;return l(),c(D,null,{left:d((()=>[])),right:d((()=>[m(s,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/user/shop"},{default:d((()=>[m(a,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),f(" "+u(e.$t("Back")),1)])),_:1})])),default:d((()=>[o("div",H,[o("div",X,[o("div",Y,[o("h1",G,u(p(A).name),1),o("p",J,u(p(A).description),1),o("div",K,[(l(),r(n,null,i(5,(e=>o("span",{key:e},["full"===nt(e)?(l(),c(a,{key:0,name:"uim:star",class:"w-4 h-4 text-yellow-400"})):"half"===nt(e)?(l(),c(a,{key:1,name:"uim:star-half-alt",class:"w-4 h-4 text-yellow-400"})):(l(),c(a,{key:2,name:"uim:star",class:"w-4 h-4 text-gray-300"}))]))),64)),o("span",N,u(p(Xe).toFixed(1)),1)]),o("div",Q,[o("div",Z,[m(s,{class:"text-base font-medium",color:"primary",onClick:t[0]||(t[0]=e=>tt.value=!0),disabled:0===p(A).inventory_quantity},{default:d((()=>[m(a,{name:"solar:cart-bold-duotone",class:"w-5 h-5 mr-2"}),f(" "+u(0===p(A).inventory_quantity?e.$t("Out of stock"):e.$t("Add to cart")),1)])),_:1},8,["disabled"])]),o("div",ee,["FIAT"!==p(A).wallet_type?(l(),r("span",te,u(p(A).price)+" "+u(p(A).currency),1)):(l(),r("span",ae,u(p(et)(p(A).price,p(A).currency)),1))])])]),o("div",se,[o("img",{src:p(A).image??"/img/banner/store.svg",alt:p(A).name,class:"rounded-2xl transform hover:scale-110 transition duration-500 ease-in-out"},null,8,le)])]),o("div",re,[m(w,{class:"p-2 mb-2 col-span-1 md:col-span-3"},{default:d((()=>[m(b,{"model-value":"description",tabs:[{label:"Description",value:"description",icon:"fluent:text-description-16-regular"},{label:`Reviews (${p(A).reviews?.length})`,value:"reviews",icon:"carbon:review"}]},{tab:d((({activeValue:e})=>["description"===e?(l(),r("div",ne,[o("p",{class:"font-sans text-sm text-gray-500 dark:text-gray-400",innerHTML:p(A).description},null,8,ie)])):"reviews"===e?(l(),r("p",ce,[p(A).id?(l(),c(x,{key:0,product:p(A),"fetch-product":He},null,8,["product"])):k("",!0)])):k("",!0)])),_:1},8,["tabs"])])),_:1}),o("div",null,[m(w,null,{default:d((()=>[de,o("div",oe,[o("div",ue,[me,o("span",null,u(p(A).category?.name),1)]),o("div",pe,[xe,o("span",null,u(p(A).type?.toLowerCase()),1)]),o("div",fe,[ve,o("span",null,u(p(A).inventory_quantity),1)]),o("div",ye,[ge,o("span",null,u(("formatDate"in e?e.formatDate:p(L))(p(A).created_at)),1)])])])),_:1})])]),m(T,{open:p(tt),size:"lg",onClose:at},{header:d((()=>[o("div",be,[o("h3",we,u(e.$t("Cart")),1),m(h,{onClick:t[1]||(t[1]=e=>tt.value=!1)})])])),footer:d((()=>[o("div",Re,[o("div",Ee,[m(s,{onClick:t[2]||(t[2]=e=>tt.value=!1)},{default:d((()=>[f(u(e.$t("Cancel")),1)])),_:1}),m(s,{color:"primary",flavor:"solid",onClick:ct,disabled:p(Ne),loading:p(Ne)},{default:d((()=>[f(u(e.$t("Pay")),1)])),_:1},8,["disabled","loading"])])])])),default:d((()=>[o("div",he,[p(st)&&0!==p(st).length?(l(),r("div",$e,[o("div",Be,[o("span",Te,u(e.$t("Discount code"))+" ("+u(p(st)?.code)+") applied successfully ",1)])])):(l(),r("div",ke,[o("div",_e,[m(p(M),{name:"code"},{default:d((({field:t,errorMessage:a,handleChange:s,handleBlur:n})=>[m($,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,error:a,placeholder:e.$t("Discount code"),label:e.$t("Discount code"),disabled:p(Ne),onInput:s,onBlur:n},null,8,["modelValue","onUpdate:modelValue","error","placeholder","label","disabled","onInput","onBlur"]),p(lt)?(l(),r("small",je,[o("span",Ce,u(p(lt)),1)])):k("",!0)])),_:1})]),o("span",null,[m(s,{class:"mt-6",color:"warning",flavor:"solid",onClick:p(rt),disabled:p(Ne),loading:p(Ne)},{default:d((()=>[f(u(e.$t("Apply")),1)])),_:1},8,["onClick","disabled","loading"])])])),o("div",De,[o("span",Me,[o("span",Ve,u(e.$t("Balance")),1),o("span",qe,[f(u(p(R)?.balance??0)+" "+u(p(A)?.currency),1),m(B,{to:`/user/wallets/${p(A)?.wallet_type?.toLowerCase()}/${p(A)?.currency?.toLowerCase()}`,"data-nui-tooltip":"Wallets"},{default:d((()=>[m(a,{name:"ei:plus",class:"h-5 w-5 text-success-500"})])),_:1},8,["to"])])]),o("span",Fe,[o("span",Pe,u(e.$t("Price")),1),o("span",Se,u(p(A)?.price??0)+" "+u(p(A)?.currency),1)]),o("span",Le,[o("span",Ie,u(e.$t("Discount")),1),o("span",Ue,u(p(st)?.percentage??0)+"% ",1)]),Oe,o("span",We,[o("span",ze,u(e.$t("Total to pay")),1),o("span",Ae,u(p(A)?.price-p(A)?.price*(p(st)?.percentage??0)/100)+" "+u(p(A)?.currency),1)])])])])),_:1},8,["open"])])])),_:1})}}});export{He as default};
