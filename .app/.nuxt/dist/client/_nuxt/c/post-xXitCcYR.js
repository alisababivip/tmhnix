import{a as e,z as t,r as a,J as l,c as r,E as o,aL as s,as as n,ad as i,S as d,ac as u,b as c,e as m,w as p,o as v,q as g,t as b,u as h,f,O as y,k as x,p as k,F as w,B as j,W as B,A as _,n as C,_ as V,x as P,X as T,Y as S}from"../e/entry-8qgg5CL-.js";import{_ as $}from"./BaseMessage.vue-Kpn2u5Rn.js";import{_ as U}from"./BaseInput.vue-iInHQMIA.js";import{_ as F}from"./BaseTextarea.vue-8st5U0qk.js";import{_ as z}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as D}from"./BaseTag.vue-NMkN1Uk8.js";import{_ as I}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as q}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as E}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as A}from"./blog-ktBDzU-N.js";import{u as M}from"./useBlog-0Y19BpbN.js";import{u as L}from"./fetch-i3Y1jjTS.js";import{b as R}from"./strings-rQgUKePI.js";import{_ as O}from"./placeholder-file-IxKzOaSl.js";import{z as H,u as W,t as Y,F as J}from"./vee-validate.esm-n59zZCC5.js";import{B as K,s as N,p as X}from"./index-C_R1xG2s.js";import"./input-id-wZ-Ta08j.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";const G=["href"],Q={class:"mb-4"},Z={class:"grid grid-cols-1 md:grid-cols-4 gap-5"},ee={class:"col-span-1 md:col-span-3 space-y-3"},te={class:"col-span-1 mt-6"},ae={key:0,class:"flex flex-wrap gap-4 border-t border-gray-400 dark:border-gray-600 pt-5"},le={class:"max-w-sm"},re={key:0,class:"mb-4"},oe=["src"],se=["onDrop"],ne=["onClick","onKeydown"],ie={class:"p-5 text-center"},de={class:"text-muted-400 font-sans text-sm"},ue={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},ce={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},me={key:1,class:"mt-6 space-y-2"},pe={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},ve={class:"flex items-center gap-2"},ge={class:"shrink-0"},be=["src"],he={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:O,alt:"Image preview"},fe={class:"font-sans"},ye={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},xe={class:"text-muted-400 block text-xs"},ke={class:"flex gap-2"},we={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},je=f("span",{class:"sr-only"},"Cancel",-1),Be={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},_e=f("span",{class:"sr-only"},"Upload",-1),Ce=["onClick"],Ve=f("span",{class:"sr-only"},"Remove",-1),Pe=e({__name:"post",setup(e){const O=t(),Pe=O.query.type,Te=O.query.slug,Se=a("edit"===Pe),$e=new K,Ue=H.object({title:H.string().min(2,"The title must be at least 2 characters long").refine((e=>e.split(" ").length>=2),"The title must be at least 2 words").refine((e=>!$e.isProfane(e)),"The title contains blacklisted words"),content:H.string().min(500,"The content must be at least 500 characters long").refine((e=>!$e.isProfane(e)),"The content contains blacklisted words"),description:H.string().min(100,"The description must be at least 100 characters long").refine((e=>!$e.isProfane(e)),"The description contains blacklisted words"),category:H.object({label:H.string(),value:H.number()}).required(),tags:H.array(H.object({id:H.number(),name:H.string()})).nonempty("At least one tag must be selected")}),Fe=Y(Ue),ze=a({title:"",content:"",description:"",category:{label:"",value:0},tags:[{id:0,name:""}]}),{handleSubmit:De,isSubmitting:Ie,meta:qe,errors:Ee,values:Ae,setErrors:Me,setFieldValue:Le}=W({validationSchema:Fe,initialValues:ze}),Re=a([]),Oe=a(null),He=a(null);l(Oe,(e=>{const t=e?.item(0)||null;if(Oe.value){const e=new FileReader;e.onload=e=>{He.value=e.target?.result},e.readAsDataURL(t)}}));const We=a(((e,t)=>0===e.length?"No tags selected":e.length>1?`${e.length} tags selected`:String(t?e[0][t]:e[0]))),Ye=r((()=>!Ae.title||!Ae.content||Ee.title||Ee.content||!Ae.category||0===Re.value.length)),Je=A(),Ke=a([]),Ne=a(null),Xe=a(null);o((async()=>{0===Je.categories.length&&await Je.fetchCategories(),0===Je.tags.length&&await Je.fetchTags(),Je.tags.length>0&&(Ke.value=Je.tags),Xe.value=N.create("editor",{plugins:X,charCounter:!0,resizingBar:!0,imageFileInput:!1,buttonList:[["undo","redo"],["font","fontSize","formatBlock"],["paragraphStyle","blockquote"],["bold","underline","italic","strike","subscript","superscript"],["fontColor","hiliteColor","textStyle"],["removeFormat"],["outdent","indent"],["align","horizontalRule","list","lineHeight"],["table","link","image","video","audio"],["fullScreen","showBlocks","codeView"]]}),Se.value&&(Ne.value=await Je.getPostBySlug(Te),Qe.value||nt.push(`/blog/${Te}`),ze.value={title:Ne.value?.title,content:Ne.value?.content,description:Ne.value?.description,category:{label:Ne.value?.category.name,value:Ne.value?.category.id},tags:Ne.value?.post_tag.map((e=>e.tag))},Re.value=Ne.value?.post_tag.map((e=>e.tag)),He.value=Ne.value?.image,Xe.value.setContents(Ne.value?.content)),Xe.value.onBlur=function(e,t){Le("content",e.srcElement.innerHTML)}})),s((()=>{Xe.value&&Xe.value.destroy()}));const Ge=r((()=>Je.categories?.map((e=>({label:e.name,value:e.id}))))),Qe=r((()=>!!Se.value&&Ne.value?.author.user.uuid===ot.value?.uuid));n((()=>{if(qe.value.dirty&&!it.value&&Qe.value)return confirm("You have unsaved changes. Are you sure you want to leave?")}));const{toast:Ze}=i(),et=a(!1),tt=r((()=>Object.keys(Ee.value).length)),{createPost:at,updatePost:lt}=M(),rt=d(),ot=r((()=>rt.getProfile)),st=r((()=>Se.value?Je.getPostBySlug(Te).image:"")),nt=u(),it=a(!1),dt=De((async e=>{try{et.value=!1;const t={title:e.title,content:e.content,description:e.description,category:e.category.value,tags:Re.value.map((e=>e.id)),image:Se.value&&!Oe.value?st.value:""};if(Oe.value){const e=new FormData;e.append("files",Oe.value[0]),e.append("type","blog");const a=await L("/api/upload",{method:"POST",body:e},"$cAJ9u4Vd04");a&&""!==a.data.value&&(t.image=a.data.value[0])}let a;if(a=Se.value?await lt(Te,t):await at(t),Ze.response(a),"success"===a.status){const e=a.data.result.slug;await Je.fetchPosts(),it.value=!0,nt.push(`/blog/${e}`)}}catch(t){Ze.danger(t)}}));return(e,t)=>{const a=V,l=P,r=T,o=$,s=U,n=F,i=z,d=D,u=S,A=I,M=q,L=E;return v(),c("div",null,[m(L,null,{left:p((()=>[m(a,{as:"h3",size:"2xl",weight:"bold",class:"text-muted-800 dark:text-white"},{default:p((()=>[g(b(h(Se)?`Editing ${h(Ne)?.title} Post`:"New Post"),1)])),_:1})])),right:p((()=>[m(r,{color:"muted",class:"flex items-center gap-2",onClick:t[0]||(t[0]=t=>e.$router.back())},{default:p((()=>[m(l,{name:"mdi-light:arrow-left",class:"h-5 w-5"}),f("span",null,b(e.$t("Back")),1)])),_:1}),f("a",{href:`/blog/${h(Te)}`,target:"_blank"},[h(Se)?(v(),y(r,{key:0,color:"info",class:"flex items-center"},{default:p((()=>[m(l,{name:"mdi-light:eye",class:"h-5 w-5"}),f("span",null,b(e.$t("View")),1)])),_:1})):x("",!0)],8,G),m(r,{color:h(Se)?"success":"primary",class:"flex items-center gap-2",disabled:h(Ye),onClick:h(dt)},{default:p((()=>[m(l,{name:"mdi-light:content-save",class:"h-5 w-5"}),f("span",null,b(h(Se)?"Update":"Publish"),1)])),_:1},8,["color","disabled","onClick"])])),default:p((()=>[f("div",Q,[h(et)?(v(),y(o,{key:0,onClose:t[1]||(t[1]=e=>et.value=!1)},{default:p((()=>[g(b(e.$t("Your post has been published"))+"! ",1)])),_:1})):x("",!0),h(tt)>1?(v(),y(o,{key:1,type:"danger",onClose:t[2]||(t[2]=()=>h(Me)({}))},{default:p((()=>[g(b(e.$t("This form has"))+" "+b(h(tt))+" "+b(e.$t("errors, please check them before submitting")),1)])),_:1})):x("",!0)]),f("div",Z,[f("div",ee,[m(h(J),{name:"title"},{default:p((({field:e,errorMessage:t,handleChange:a,handleBlur:l})=>[m(s,{"model-value":e.value,error:t,disabled:h(Ie),type:"text",shape:"rounded",placeholder:"Enter post title","onUpdate:modelValue":a,onBlur:l,label:"Post Title"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1}),m(h(J),{name:"content"},{default:p((({field:e,errorMessage:t,handleChange:a,handleBlur:l})=>[m(n,{id:"editor","model-value":e.value,error:t,disabled:h(Ie),shape:"rounded",rows:"15",placeholder:"Enter post content","color-focus":"","onUpdate:modelValue":a,onBlur:l,label:"Content"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1}),m(h(J),{name:"description"},{default:p((({field:e,errorMessage:t,handleChange:a,handleBlur:l})=>[m(n,{"model-value":e.value,error:t,disabled:h(Ie),shape:"rounded",rows:"3",placeholder:"Enter post description","color-focus":"","onUpdate:modelValue":a,onBlur:l,label:"Description"},null,8,["model-value","error","disabled","onUpdate:modelValue","onBlur"])])),_:1})]),f("div",te,[m(u,{shape:"rounded",class:"p-4 mb-5 space-y-5"},{default:p((()=>[m(h(J),{name:"category"},{default:p((({field:e,errorMessage:t,handleChange:a,handleBlur:l})=>[m(i,{"model-value":e.value,error:t,disabled:h(Ie),items:h(Ge),properties:{label:"label",value:"value"},placeholder:"Please select an option",label:"Categories",shape:"rounded","onUpdate:modelValue":a,onBlur:l},null,8,["model-value","error","disabled","items","onUpdate:modelValue","onBlur"])])),_:1}),m(i,{modelValue:h(Re),"onUpdate:modelValue":t[3]||(t[3]=e=>k(Re)?Re.value=e:null),"multiple-label":h(We),label:"Tags",items:h(Ke),properties:{value:"id",label:"name"},multiple:"",disabled:0===h(Ke)?.length},null,8,["modelValue","multiple-label","items","disabled"]),h(Re)?.length>0?(v(),c("div",ae,[(v(!0),c(w,null,j(h(Re),(e=>(v(),y(d,{key:e.id,shape:"rounded",color:"default",shadow:"hover"},{default:p((()=>[g(b(e.name),1)])),_:2},1024)))),128))])):x("",!0)])),_:1}),f("div",le,[h(He)?(v(),c("div",re,[f("img",{src:h(He),alt:"Image Preview",class:"rounded-xl object-cover object-center"},null,8,oe)])):x("",!0),m(M,{modelValue:h(Oe),"onUpdate:modelValue":t[6]||(t[6]=e=>k(Oe)?Oe.value=e:null)},{default:p((({open:a,remove:r,preview:o,drop:s,files:n})=>[f("div",{class:"",onDragenter:t[4]||(t[4]=B((()=>{}),["stop","prevent"])),onDragover:t[5]||(t[5]=B((()=>{}),["stop","prevent"])),onDrop:s},[n?.length?(v(),c("ul",me,[(v(!0),c(w,null,j(n,(t=>(v(),c("li",{key:t.name},[f("div",pe,[f("div",ve,[f("div",ge,[t.type.startsWith("image")?(v(),c("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:o(t).value,alt:"Image preview"},null,8,be)):(v(),c("img",he))]),f("div",fe,[f("span",ye,b(t.name),1),f("span",xe,b(("formatFileSize"in e?e.formatFileSize:h(R))(t.size)),1)])]),f("div",{class:C(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[m(A,{value:0,size:"xs",color:"success"})]),f("div",ke,[f("button",we,[m(l,{name:"lucide:slash",class:"h-4 w-4"}),je]),f("button",Be,[m(l,{name:"lucide:arrow-up",class:"h-4 w-4"}),_e]),f("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:B((e=>r(t)),["prevent"])},[m(l,{name:"lucide:x",class:"h-4 w-4"}),Ve],8,Ce)])])])))),128))])):(v(),c("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:a,onKeydown:_(B(a,["prevent"]),["enter"])},[f("div",ie,[m(l,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),f("h4",de,b(e.$t("Drop file to upload")),1),f("div",null,[f("span",ue,b(e.$t("Or")),1)]),f("label",ce,b(e.$t("Select Image")),1)])],40,ne))],40,se)])),_:1},8,["modelValue"])])])])])),_:1})])}}});export{Pe as default};
