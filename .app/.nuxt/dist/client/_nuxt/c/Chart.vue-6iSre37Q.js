import{a as e,ad as t,Q as n,S as i,r as o,R as s,c as r,z as a,J as l,E as d,G as c,b as u,e as h,w as _,u as m,f as p,Z as g,an as f,o as v,t as y,q as b,n as w,ao as C,X as S}from"../e/entry-8qgg5CL-.js";import{u as I}from"./useExchange-VMAYQu3P.js";import{u as P}from"./market-Bq5Nv6Cu.js";import{u as A}from"./wallet-n04aoRPe.js";import{u as L}from"./composables-Om4eAUXX.js";import{u as x}from"./socket--t7FR4dG.js";function k(e,t){const n={...e};for(const i in t)"object"!=typeof e[i]||null===e[i]||Array.isArray(e[i])?void 0!==t[i]&&(n[i]=t[i]):n[i]=k(e[i],t[i]);return n}const T={width:800,height:500,interval:"1D",timezone:"Etc/UTC",container:"",library_path:"",locale:"en",widgetbar:{details:!1,watchlist:!1,news:!1,datawindow:!1,watchlist_settings:{default_symbols:[]}},overrides:{"mainSeriesProperties.showCountdown":!1},studies_overrides:{},trading_customization:{position:{},order:{}},brokerConfig:{configFlags:{}},fullscreen:!1,autosize:!1,disabled_features:[],enabled_features:[],debug:!1,logo:{},time_frames:[{text:"5y",resolution:"1W"},{text:"1y",resolution:"1W"},{text:"6m",resolution:"120"},{text:"3m",resolution:"60"},{text:"1m",resolution:"30"},{text:"5d",resolution:"5"},{text:"1d",resolution:"1"}],client_id:"0",user_id:"0",charts_storage_api_version:"1.0",favorites:{intervals:[],chartTypes:[],indicators:[],drawingTools:[]}},D=JSON.parse('[{"iso":"ar","dir":"rtl","language":"ar"},{"iso":"pt","dir":"ltr","language":"pt"},{"iso":"ca","dir":"ltr","language":"ca_ES"},{"iso":"cs","dir":"ltr","language":"cs"},{"iso":"de","dir":"ltr","language":"de"},{"iso":"en","dir":"ltr","language":"en"},{"iso":"es","dir":"ltr","language":"es"},{"iso":"fa","dir":"rtl","language":"fa"},{"iso":"fr","dir":"ltr","language":"fr"},{"iso":"he","dir":"rtl","language":"he_IL"},{"iso":"hu","dir":"ltr","language":"hu_HU"},{"iso":"id","dir":"ltr","language":"id_ID"},{"iso":"en","dir":"ltr","language":"en"},{"iso":"it","dir":"ltr","language":"it"},{"iso":"ja","dir":"ltr","language":"ja"},{"iso":"ko","dir":"ltr","language":"ko"},{"iso":"ms","dir":"ltr","language":"ms_MY"},{"iso":"pl","dir":"ltr","language":"pl"},{"iso":"ru","dir":"ltr","language":"ru"},{"iso":"sv","dir":"ltr","language":"sv"},{"iso":"th","dir":"ltr","language":"th"},{"iso":"tr","dir":"ltr","language":"tr"},{"iso":"vi","dir":"ltr","language":"vi"},{"iso":"zh-Hans","dir":"ltr","language":"zh"},{"iso":"zh-Hant","dir":"ltr","language":"zh_TW"},{"iso":"el","dir":"ltr","language":"el"},{"iso":"nl","dir":"ltr","language":"nl_NL"},{"iso":"ro","dir":"ltr","language":"ro"}]');let E=!1;function F(e){var t;const n=/\.woff(\d*)/.exec(e);return`<link rel="preload" href="${e}" as="font" type="font/woff${null!==(t=null==n?void 0:n[1])&&void 0!==t?t:"2"}" crossorigin="anonymous"/>`}function W(e,t){var n;const i=new URL(`${e||""}`,location.href).href,o=JSON.parse('["bundles/runtime.9e6a94224bc7334ac8fa.js","bundles/__LANG__.7076.5055b5f097e7204685ed.js","bundles/7717.8f75bd75d4b6ed45f3ff.css","bundles/7717.8f75bd75d4b6ed45f3ff.rtl.css","bundles/4618.e46ad0a894862e22afb5.js","bundles/library.4350c821a355451bc08e.js","bundles/EuclidCircular.be8f862db48c2976009f.woff2"]'),s=encodeURIComponent(t),r=null!==(n=D.find((e=>e.language===s)))&&void 0!==n?n:{iso:"en",dir:"ltr"},a=`lang="${r.iso}" dir="${r.dir}"`,l=`\n${function(e,t,n){if(void 0===e)return"";const i=[],o=[],s=[],r=/\.css$/i,a=/\.rtl\.css$/i;for(const l of e)l.endsWith(".js")?o.push(`<script defer crossorigin="anonymous" src="${l.replace("__LANG__",n)}"><\/script>`):r.test(l)&&t===a.test(l)?s.push(`<link type="text/css" href="${l}" rel="stylesheet"/>`):/\.woff\d*/.test(l)&&i.push(F(l));return[...i,...o,...s].join("\n")}(o,"rtl"===r.dir,s)}\n`;return`<!DOCTYPE html><html ${(d={bundles:l,localeLanguage:s,htmlAttrs:a,libraryPath:i}).htmlAttrs}><head><base href="${d.libraryPath}"><meta charset="utf-8"><script>window===window.parent&&(location.href="about:blank")<\/script> ${d.bundles} </head><body class="chart-page unselectable on-widget"><div class="loading-indicator" id="loading-indicator"></div><script>var JSServer={},__initialEnabledFeaturesets=["charting_library"]<\/script><script>(function() {\n\t\twindow.urlParams = (function () {\n\t\t\tvar match,\n\t\t\t\tpl\t = /\\+/g,  // Regex for replacing addition symbol with a space\n\t\t\t\tsearch = /([^&=]+)=?([^&]*)/g,\n\t\t\t\tdecode = function (s) { return decodeURIComponent(s.replace(pl, ' ')).replace(/<\\/?[^>]+(>|$)/g, ''); },\n\t\t\t\tquery = function() {\n\t\t\t\t\t// We don't use hash on the url because: safari 13 throws an error if you attempt this\n\t\t\t\t\t// on a blob, and safari 14 will strip hash from blob urls.\n\t\t\t\t\tif (frameElement && frameElement.dataset.widgetOptions) {\n\t\t\t\t\t\treturn frameElement.dataset.widgetOptions;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow "Unexpected use of this page";\n\t\t\t\t\t}\n\t\t\t\t}(),\n\t\t\t\tresult = {};\n\n\t\t\twhile (match = search.exec(query)) {\n\t\t\t\tresult[decode(match[1])] = decode(match[2]);\n\t\t\t}\n\n\t\t\tvar additionalSettingsObject = window.parent[result.uid];\n\n\t\t\tvar customObjectNames = ['datafeed', 'customFormatters', 'brokerFactory', 'save_load_adapter', 'customTranslateFunction', 'contextMenu'];\n\n\t\t\tfor (var p in additionalSettingsObject) {\n\t\t\t\tif (customObjectNames.indexOf(p) === -1) {\n\t\t\t\t\tresult[p] = JSON.stringify(additionalSettingsObject[p]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t})();\n\n\t\twindow.locale = urlParams.locale;\n\t\twindow.language = urlParams.locale; // a very big attention needed here\n\t\twindow.customTranslateFunction = window.parent[urlParams.uid].customTranslateFunction;\n\n\t\twindow.addCustomCSSFile = function(href) {\n\t\t\tvar link = document.createElement('link');\n\t\t\tlink.setAttribute('type', 'text/css');\n\t\t\tlink.setAttribute('rel', 'stylesheet');\n\t\t\tlink.setAttribute('href', href);\n\t\t\tlink.setAttribute('cross-origin', 'anonymous');\n\n\t\t\twindow.loadedCustomCss = new Promise((resolve) => {\n\t\t\t\tlink.onload = resolve;\n\t\t\t\tlink.onerror = resolve;\n\t\t\t});\n\t\t\tdocument.body.appendChild(link);\n\t\t};\n\n\t\twindow.loadedCustomCss = Promise.resolve();\n\t\tif (!!urlParams.customCSS) {\n\t\t\twindow.addCustomCSSFile(urlParams.customCSS);\n\t\t}\n\n\t\tvar loadingScreenParams = {};\n\n\t\tif (typeof urlParams.loading_screen === 'string') {\n\t\t\ttry {\n\t\t\t\tloadingScreenParams = JSON.parse(urlParams.loading_screen);\n\t\t\t} catch(e) {}\n\t\t}\n\n\t\tvar loadingIndicatorElement = document.getElementById('loading-indicator');\n\n\t\tif (loadingScreenParams.backgroundColor) {\n\t\t\tloadingIndicatorElement.style = 'background-color: ' + loadingScreenParams.backgroundColor;\n\t\t}\n\n\t\t!function(){"use strict";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(":global(.tv-spinner) {display: none;position: absolute;width: 1em;height: 1em;top: calc(50% - 0.5em);left: calc(50% - 0.5em);margin: 0 auto;border: 4px solid rgba(135, 151, 165, 0.2);border-radius: 50%;border-top-color: var(--tv-spinner-color, #2962FF);border-left-color: var(--tv-spinner-color, #2962FF);animation: tv-spinner__container-rotate 0.9s linear infinite;}:global(.tv-spinner)--shown {display: block;}:global(.tv-spinner)--size_xsmall {font-size: 14px;border-width: 2px;}:global(.tv-spinner)--size_small {font-size: 20px;border-width: 2px;}:global(.tv-spinner)--size_medium {font-size: 28px;border-width: 3px;}:global(.tv-spinner)--size_large {font-size: 56px;border-width: 4px;}  @keyframes tv-spinner__container-rotate {to {transform: rotate(360deg);}}");var t,e=new WeakMap;!function(t){t[t.Element=1]="Element",t[t.Document=9]="Document"}(t||(t={}));var n={mini:"xsmall",xsmall:"xsmall",small:"small",medium:"medium",large:"large"};var o,i,r,s,l,a=(void 0===l&&(l=""),o='<div class="tv-spinner '.concat(l,'" role="progressbar"></div>'),r=function(n,o){var i,r;return i=null==o?document.documentElement:o.nodeType===t.Document?o.documentElement:o,e&&(r=e.get(i)),r||((r=i.ownerDocument.createRange()).selectNodeContents(i),e&&e.set(i,r)),r.createContextualFragment(n)}(o,i),null!==(s=r.firstElementChild)&&r.removeChild(s),s),c=function(){function t(t){this._shown=!1,this._el=a.cloneNode(!0),this.setSize(n[t||"large"])}return t.prototype.spin=function(t){return this._el.classList.add("tv-spinner--shown"),void 0===this._container&&(this._container=t,void 0!==t&&t.appendChild(this._el)),this._shown=!0,this},t.prototype.stop=function(t){return t&&void 0!==this._container&&this._container.removeChild(this._el),this._el.classList.remove("tv-spinner--shown"),this._shown=!1,this},t.prototype.setStyle=function(t){var e=this;return Object.keys(t).forEach((function(n){var o=t[n];void 0!==o&&e._el.style.setProperty(n,o)})),this},t.prototype.style=function(){return this._el.style},t.prototype.setSize=function(t){var e=void 0!==t?"tv-spinner--size_".concat(t):"";return this._el.className="tv-spinner ".concat(e," ").concat(this._shown?"tv-spinner--shown":""),this},t.prototype.getEl=function(){return this._el},t.prototype.destroy=function(){this.stop(),delete this._el,delete this._container},t}();window.Spinner=c}();\n\n\n\t\tvar spinnerColor = (loadingScreenParams.foregroundColor) ? loadingScreenParams.foregroundColor : undefined;\n\n\t\tvar loadingSpinner = new Spinner('large').setStyle({\n\t\t\t'--tv-spinner-color': spinnerColor,\n\t\t\tzIndex: String(2e9),\n\t\t});\n\t\tloadingSpinner.getEl().classList.add('spinner');\n\t\tloadingSpinner.spin(loadingIndicatorElement);\n\t})();<\/script></body></html>`;var d}const R=class{constructor(e){var t;if(this._id=`tradingview_${(1048576*(1+Math.random())|0).toString(16).substring(1)}`,this._ready=!1,this._readyHandlers=[],this._onWindowResize=this._autoResizeChart.bind(this),!e.datafeed)throw new Error("Datafeed is not defined");(null===(t=e.overrides)||void 0===t?void 0:t["mainSeriesProperties.priceAxisProperties.lockScale"])&&(console.warn("mainSeriesProperties.priceAxisProperties.lockScale can not be set to true within the widget constructor"),delete e.overrides["mainSeriesProperties.priceAxisProperties.lockScale"]),this._options=k(T,e),"Dark"===this._options.theme&&void 0===this._options.loading_screen&&(this._options.loading_screen={backgroundColor:"#131722"}),this._options.debug&&(E||(E=!0,console.log("Using CL v24.004 (internal id 8ab257ed @ 2023-04-24T19:22:25.354Z)"))),this._create()}setDebugMode(e){this._innerAPI().setDebugMode(e)}onChartReady(e){this._ready?e.call(this):this._readyHandlers.push(e)}headerReady(){return this._innerWindowLoaded.then((()=>this._innerWindow().headerReady()))}onGrayedObjectClicked(e){this._doWhenInnerApiLoaded((t=>{t.onGrayedObjectClicked(e)}))}onShortcut(e,t){this._doWhenInnerWindowLoaded((n=>{n.createShortcutAction(e,t)}))}subscribe(e,t){this._doWhenInnerApiLoaded((n=>{n.subscribe(e,t)}))}unsubscribe(e,t){this._doWhenInnerApiLoaded((n=>{n.unsubscribe(e,t)}))}chart(e){return this._innerAPI().chart(e)}getLanguage(){return this._options.locale}setSymbol(e,t,n){this._innerAPI().changeSymbol(e,t,n)}remove(){window.removeEventListener("resize",this._onWindowResize),this._readyHandlers.splice(0,this._readyHandlers.length),delete window[this._id],this._iFrame.parentNode&&this._iFrame.parentNode.removeChild(this._iFrame)}closePopupsAndDialogs(){this._doWhenInnerApiLoaded((e=>{e.closePopupsAndDialogs()}))}selectLineTool(e,t){this._innerAPI().selectLineTool(e,t)}selectedLineTool(){return this._innerAPI().selectedLineTool()}save(e){this._innerAPI().saveChart(e)}load(e,t){this._innerAPI().loadChart({json:e,extendedData:t})}getSavedCharts(e){this._innerAPI().getSavedCharts(e)}loadChartFromServer(e){this._innerAPI().loadChartFromServer(e)}saveChartToServer(e,t,n){this._innerAPI().saveChartToServer(e,t,n)}removeChartFromServer(e,t){this._innerAPI().removeChartFromServer(e,t)}onContextMenu(e){this._doWhenInnerApiLoaded((t=>{t.onContextMenu(e)}))}createButton(e){return this._innerWindow().createButton(e)}createDropdown(e){return this._innerWindow().createDropdown(e)}showNoticeDialog(e){this._doWhenInnerApiLoaded((t=>{t.showNoticeDialog(e)}))}showConfirmDialog(e){this._doWhenInnerApiLoaded((t=>{t.showConfirmDialog(e)}))}showLoadChartDialog(){this._innerAPI().showLoadChartDialog()}showSaveAsChartDialog(){this._innerAPI().showSaveAsChartDialog()}symbolInterval(){return this._innerAPI().getSymbolInterval()}mainSeriesPriceFormatter(){return this._innerAPI().mainSeriesPriceFormatter()}getIntervals(){return this._innerAPI().getIntervals()}getStudiesList(){return this._innerAPI().getStudiesList()}getStudyInputs(e){return this._innerAPI().getStudyInputs(e)}getStudyStyles(e){return this._innerAPI().getStudyStyles(e)}addCustomCSSFile(e){this._innerWindow().addCustomCSSFile(e)}applyOverrides(e){this._options=k(this._options,{overrides:e}),this._doWhenInnerWindowLoaded((t=>{t.applyOverrides(e)}))}applyStudiesOverrides(e){this._doWhenInnerWindowLoaded((t=>{t.applyStudiesOverrides(e)}))}watchList(){return this._innerAPI().watchlist()}news(){return this._innerAPI().news()}widgetbar(){return this._innerAPI().widgetbar()}activeChart(){return this._innerAPI().activeChart()}chartsCount(){return this._innerAPI().chartsCount()}layout(){return this._innerAPI().layout()}setLayout(e){this._innerAPI().setLayout(e)}layoutName(){return this._innerAPI().layoutName()}changeTheme(e,t){return this._innerWindow().changeTheme(e,t)}getTheme(){return this._innerWindow().getTheme()}takeScreenshot(){this._doWhenInnerApiLoaded((e=>{e.takeScreenshot()}))}lockAllDrawingTools(){return this._innerAPI().lockAllDrawingTools()}hideAllDrawingTools(){return this._innerAPI().hideAllDrawingTools()}drawOnAllCharts(e){this._innerAPI().drawOnAllCharts(e)}magnetEnabled(){return this._innerAPI().magnetEnabled()}magnetMode(){return this._innerAPI().magnetMode()}undoRedoState(){return this._innerAPI().undoRedoState()}setIntervalLinkingEnabled(e){this._innerAPI().setIntervalLinkingEnabled(e)}setTimeFrame(e){this._innerAPI().setTimeFrame(e)}symbolSync(){return this._innerAPI().symbolSync()}intervalSync(){return this._innerAPI().intervalSync()}crosshairSync(){return this._innerAPI().crosshairSync()}timeSync(){return this._innerAPI().timeSync()}dateRangeSync(){return this._innerAPI().dateRangeSync()}setFeatureEnabled(e,t){this._innerAPI().setFeatureEnabled(e,t)}getAllFeatures(){return this._innerWindow().getAllFeatures()}clearUndoHistory(){return this._innerAPI().clearUndoHistory()}undo(){return this._innerAPI().undo()}redo(){return this._innerAPI().redo()}startFullscreen(){this._innerAPI().startFullscreen()}exitFullscreen(){this._innerAPI().exitFullscreen()}takeClientScreenshot(e){return this._innerAPI().takeClientScreenshot(e)}navigationButtonsVisibility(){return this._innerWindow().getNavigationButtonsVisibility()}paneButtonsVisibility(){return this._innerWindow().getPaneButtonsVisibility()}dateFormat(){return this._innerWindow().getDateFormat()}timeHoursFormat(){return this._innerWindow().getTimeHoursFormat()}currencyAndUnitVisibility(){return this._innerWindow().getCurrencyAndUnitVisibility()}supportedChartTypes(){return this._innerAPI().supportedChartTypes()}_innerAPI(){return this._innerWindow().tradingViewApi}_innerWindow(){return this._iFrame.contentWindow}_doWhenInnerWindowLoaded(e){this._ready?e(this._innerWindow()):this._innerWindowLoaded.then((()=>{e(this._innerWindow())}))}_doWhenInnerApiLoaded(e){this._doWhenInnerWindowLoaded((t=>{t.doWhenApiIsReady((()=>e(this._innerAPI())))}))}_autoResizeChart(){this._options.fullscreen&&(this._iFrame.style.height=window.innerHeight+"px",O&&setTimeout((()=>{this._iFrame.style.height=window.innerHeight+"px"}),30))}_create(){var e,t;const n=null!==(t=null===(e=this._options.enabled_features)||void 0===e?void 0:e.includes("iframe_loading_compatibility_mode"))&&void 0!==t&&t,[i,o]=this._render(!n);this._options.container_id&&console.warn("`container_id` is now deprecated. Please use `container` instead to either still pass a string or an `HTMLElement`.");const s=this._options.container_id||this._options.container,r="string"==typeof s?document.getElementById(s):s;if(null===r)throw new Error(`There is no such element - #${this._options.container}`);r.innerHTML=i,this._iFrame=r.querySelector(`#${this._id}`);const a=this._iFrame;n&&(a.contentWindow?(a.contentWindow.document.open(),a.contentWindow.document.write(o),a.contentWindow.document.close()):console.warn("Unable to locate contentWindow for the created iframe. Please try disabling the `iframe_loading_compatibility_mode` featureset.")),(this._options.autosize||this._options.fullscreen)&&(a.style.width="100%",this._options.fullscreen||(a.style.height="100%")),window.addEventListener("resize",this._onWindowResize),this._onWindowResize(),this._innerWindowLoaded=new Promise((e=>{const t=()=>{a.removeEventListener("load",t,!1),e()};a.addEventListener("load",t,!1)})),this._innerWindowLoaded.then((()=>{this._innerWindow().widgetReady((()=>{this._ready=!0;for(const t of this._readyHandlers)try{t.call(this)}catch(e){console.error(e)}this._innerWindow().initializationFinished()}))}))}_render(e){const t=window;if(t[this._id]={datafeed:this._options.datafeed,customFormatters:this._options.custom_formatters||this._options.customFormatters,brokerFactory:this._options.broker_factory||this._options.brokerFactory,overrides:this._options.overrides,studiesOverrides:this._options.studies_overrides,tradingCustomization:this._options.trading_customization,disabledFeatures:this._options.disabled_features,enabledFeatures:this._options.enabled_features,brokerConfig:this._options.broker_config||this._options.brokerConfig,restConfig:this._options.restConfig,favorites:this._options.favorites,logo:this._options.logo,numeric_formatting:this._options.numeric_formatting,rss_news_feed:this._options.rss_news_feed,newsProvider:this._options.news_provider,loadLastChart:this._options.load_last_chart,saveLoadAdapter:this._options.save_load_adapter,loading_screen:this._options.loading_screen,settingsAdapter:this._options.settings_adapter,getCustomIndicators:this._options.custom_indicators_getter,additionalSymbolInfoFields:this._options.additional_symbol_info_fields,headerWidgetButtonsMode:this._options.header_widget_buttons_mode,customTranslateFunction:this._options.custom_translate_function,symbolSearchComplete:this._options.symbol_search_complete,contextMenu:this._options.context_menu,settingsOverrides:this._options.settings_overrides,timeframe:this._options.timeframe,customTimezones:this._options.custom_timezones},this._options.saved_data)t[this._id].chartContent={json:this._options.saved_data},this._options.saved_data_meta_info&&(t[this._id].chartContentExtendedData=this._options.saved_data_meta_info);else if(!this._options.load_last_chart&&!this._options.symbol)throw new Error("Symbol is not defined: either 'symbol' or 'load_last_chart' option must be set");if(this._options.library_path&&!this._options.library_path.endsWith("/")&&console.warn("library_path option should contain a trailing forward slash"),this._options.locale){const e=encodeURIComponent(this._options.locale);D.findIndex((t=>t.language===e))>=0||(console.warn("locale isn't supported. Using default of `en`."),this._options.locale="en")}const n=W(this._options.library_path||"",this._options.locale);let i=new URL("about:blank");if(e){const e=new Blob([n],{type:"text/html"}),t=URL.createObjectURL(e);i=new URL(t)}const o="symbol="+encodeURIComponent(this._options.symbol||"")+"&interval="+encodeURIComponent(this._options.interval)+(this._options.toolbar_bg?"&toolbarbg="+encodeURIComponent(this._options.toolbar_bg.replace("#","")):"")+(this._options.studies_access?"&studiesAccess="+encodeURIComponent(JSON.stringify(this._options.studies_access)):"")+"&widgetbar="+encodeURIComponent(JSON.stringify(this._options.widgetbar))+(this._options.drawings_access?"&drawingsAccess="+encodeURIComponent(JSON.stringify(this._options.drawings_access)):"")+"&timeFrames="+encodeURIComponent(JSON.stringify(this._options.time_frames))+"&locale="+encodeURIComponent(this._options.locale)+"&uid="+encodeURIComponent(this._id)+"&clientId="+encodeURIComponent(String(this._options.client_id))+"&userId="+encodeURIComponent(String(this._options.user_id))+(this._options.charts_storage_url?"&chartsStorageUrl="+encodeURIComponent(this._options.charts_storage_url):"")+(this._options.charts_storage_api_version?"&chartsStorageVer="+encodeURIComponent(this._options.charts_storage_api_version):"")+(this._options.custom_css_url?"&customCSS="+encodeURIComponent(this._options.custom_css_url):"")+(this._options.custom_font_family?"&customFontFamily="+encodeURIComponent(this._options.custom_font_family):"")+(this._options.auto_save_delay?"&autoSaveDelay="+encodeURIComponent(String(this._options.auto_save_delay)):"")+"&debug="+encodeURIComponent(String(this._options.debug))+(this._options.snapshot_url?"&snapshotUrl="+encodeURIComponent(this._options.snapshot_url):"")+(this._options.timezone?"&timezone="+encodeURIComponent(this._options.timezone):"")+(this._options.study_count_limit?"&studyCountLimit="+encodeURIComponent(String(this._options.study_count_limit)):"")+(this._options.symbol_search_request_delay?"&ssreqdelay="+encodeURIComponent(String(this._options.symbol_search_request_delay)):"")+(this._options.compare_symbols?"&compareSymbols="+encodeURIComponent(JSON.stringify(this._options.compare_symbols)):"")+(this._options.theme?"&theme="+encodeURIComponent(String(this._options.theme)):"")+(this._options.header_widget_buttons_mode?"&header_widget_buttons_mode="+encodeURIComponent(String(this._options.header_widget_buttons_mode)):"")+(this._options.time_scale?"&time_scale="+encodeURIComponent(JSON.stringify(this._options.time_scale)):"");return[`<iframe\n\t\tid="${this._id}" name="${this._id}" src="${i.href}" data-widget-options="${o}"\n\t\t${this._options.autosize||this._options.fullscreen?"":`width="${this._options.width}" height="${this._options.height}"`} title="Financial Chart" frameborder="0" allowTransparency="true" scrolling="no" allowfullscreen style="display:block;">\n\t</iframe>`,n]}};"undefined"!=typeof window&&(window.TradingView=window.TradingView||{},window.TradingView.version=function(){return"CL v24.004 (internal id 8ab257ed @ 2023-04-24T19:22:25.354Z)"});const O=!("undefined"==typeof window||!window.navigator||!window.navigator.userAgent)&&window.navigator.userAgent.includes("CriOS"),B={class:"h-full w-full",id:"creatable"},$=p("div",{id:"tv_chart_container",class:"tv_chart_container"},null,-1),U={class:"flex w-full items-center justify-between p-4 md:p-6"},z={class:"font-heading text-muted-900 text-lg font-medium leading-6 dark:text-white"},N={class:"p-4 md:p-6"},M={class:"mx-auto w-full text-center"},j={class:"font-heading text-muted-800 text-lg font-medium leading-6 dark:text-white"},H={class:"font-alt text-muted-500 dark:text-muted-400 text-sm leading-5 mb-3"},V={key:1},q={class:"p-4 md:p-6"},J={class:"flex gap-x-2"},G=e({__name:"Chart",props:{currency:String,pair:String,isBinary:Boolean},setup(e){const k=e,{getHistorical:D}=I(),{toast:E}=t(),F=g().public.appActiveExchange??"kucoin",W=x(),O=P(),G=n(),Y=A(),Q=i(),Z=o(!1),X=s(),K=o(0),ee=o(!1),te=o(!1),ne=o(null),ie=r((()=>G.settings)),oe=a(),{isPractice:se}=oe.query,re=r((()=>ne.value?pe(ne.value):0)),ae=r((()=>{const e=Number(O.selectedMarket?.metadata?.precision?.price)||4;return Math.abs(e)})),le=r((()=>{const e=Number(O.selectedMarket?.metadata?.precision?.amount)||4;return Math.abs(e)})),de=r((()=>{if(!ne.value)return null;if(re.value<=15)return null;const e=ne.value?.amount*(Math.abs(K.value)/100);return(ne.value?.amount-e).toFixed(le.value)})),ce=r((()=>X.isDarkMode)),ue={success:"#14B8A6",failure:"#D73A57",pending:"#F59E0B",stop:"#FF5733",draw:"#BDBDBD"},he={success:"#00A896",failure:"#C1292E",pending:"#DAA520",stop:"#D43F00",draw:"#808080"},_e=o(ue);l(ce,(e=>{Le&&Le.changeTheme(e?"Dark":"Light"),_e.value=e?he:ue})),d((async()=>{var e;ke=Te[e=F]||[],xe=De[e]||{},function(){if(!document.getElementById("tv_chart_container")){const e=document.createElement("div");e.id="tv_chart_container",e.style.height="100%";document.querySelector("#creatable").appendChild(e)}var e=k.currency+"/"+k.pair;const t=new R({fullscreen:!1,autosize:!0,symbol:e,interval:"60",container:"tv_chart_container",datafeed:Be,library_path:"/charting_library/",locale:"en",theme:ce.value?"Dark":"Light",timezone:"Etc/UTC",client_id:"chart",disabled_features:We,enabled_features:Re,overrides:{"mainSeriesProperties.showCountdown":!0,"highLowAvgPrice.highLowPriceLinesVisible":!0,"mainSeriesProperties.highLowAvgPrice.highLowPriceLabelsVisible":!0,"mainSeriesProperties.showPriceLine":!0}});Le=t,Le.onChartReady((()=>{Z.value=!0,Se()}))}(),Q.isLoggedIn&&(k.isBinary&&0===O.binaryPositions.length||O.binaryPositions.length>0&&O.binaryPositions[0].is_demo!==se)&&await O.fetchBinaryPositions(se?"DEMO":"LIVE"),window.addEventListener("beforeunload",me)})),c((()=>{if(Ae.terminate(),Le)try{"function"==typeof Le.remove&&Le.remove()}catch(T){console.error("Error destroying widget:",T)}finally{Le=null}const e=document.getElementById("tv_chart_container");e&&e.remove(),window.removeEventListener("beforeunload",me)}));const me=()=>{if(Ae.terminate(),Le)try{"function"==typeof Le.remove&&Le.remove()}catch(T){console.error("Error destroying widget:",T)}finally{Le=null}const e=document.getElementById("tv_chart_container");e&&e.remove(),Ae.terminate()};function pe(e){return Math.floor((new Date(e).getTime()-(new Date).getTime())/1e3)}function ge(e,t){let n=0;e.isProcessing=!0;const i=setInterval((async()=>{n+=1;const o="Processing"+".".repeat(n%4);e.line.setText(o),await async function(e,t,n){await O.fetchBinaryPositions(se?"DEMO":"LIVE");const i=O.binaryPositions.find((t=>t.uuid===e.uuid));if(i&&"PENDING"!==i.status){clearInterval(t),function(e){let t,n;if(!Y.wallet)return void console.error("Wallet is not available.");switch(e.status){case"WIN":t=e.amount*(Number(e.profit)/100),n=`Congratulations! You won ${t} ${k.pair}.`,Y.wallet.balance+=t+e.amount,E.successText(n);break;case"LOSS":t=-e.amount,n=`Sorry! You lost ${t} ${k.pair}.`,Y.wallet.balance+=t,E.dangerText(n);break;case"DRAW":n="Your order was a draw. You didn't win or lose anything.",Y.wallet.balance+=e.amount,E.muted(n)}ne.value=null,ee.value=!1,te.value=!1}(i);try{ye.value.get(n)?.line.remove(),ye.value.delete(n)}catch(o){console.log(o)}}}(e.order,i,t)}),1e3)}function fe(e){const t=ve(e.order);e.remainingTime=t;const n=Ie(e);e.line.setText(n)}function ve(e){const t=(new Date).getTime(),n=new Date(e.closed_at).getTime()-t,i=Math.floor(n/1e3);return Math.max(i,0)}l((()=>O.binaryExpirationTimes[0]),(e=>function(e){const t=pe(e);t<=0?function(){for(const[e,t]of ye.value.entries()){if(pe(t.order.closed_at)<=0){if(t.isProcessing)continue;ge(t,e)}else fe(t)}}():ye.value.forEach((e=>fe(e)))}(e)));const ye=o(new Map);function be(e,t){return k.isBinary?function(e,t){if(t===e.price)return function(){const e=0,t=0;return K.value=t,{profit:e,profitPercentage:t}}();const{totalTime:n,remainingTime:i,isRiseOrder:o,priceChange:s}=function(e,t){const n=new Date(e.created_at).getTime(),i=new Date(e.closed_at).getTime(),o=(new Date).getTime(),s=(i-n)/1e3,r=(i-o)/1e3,a="RISE"===e.side,l=(t-e.price)/e.price*100;return{totalTime:s,remainingTime:r,isRiseOrder:a,priceChange:l}}(e,t);let r=function(e,t,n,i,o,s){const r=ie.value?.binary_trading_profit_percentage/i,a=100/i,l=1+Math.abs(s/100);let d;if(o<=15)d=t>n?ie.value?.binary_trading_profit_percentage:-100,e||(d=-d);else{const s=i-o;d=e?t>n?r*s:-a*s:t<n?r*s:-a*s,d*=l}return Math.min(Math.max(d,-100),ie.value?.binary_trading_profit_percentage)}(o,t,e.price,n,i,s);return we(e.amount,r)}(e,t):function(e,t){const n="SELL"===e.side?e.price-t:t-e.price;let i=n/e.price*100;return we(e.amount,i)}(e,t)}function we(e,t){let n=e*t/100;return n=Number(n.toFixed(2)),t=Number(t.toFixed(2)),K.value=t,{profit:n,profitPercentage:t}}function Ce(e,t,n=!1){const i=Le.chart().createPositionLine();return i.setText(n?"Stop Price":"Pending").setPrice(e.price).setExtendLeft(!0).setLineStyle(0).setLineLength(50).setLineColor(t).setBodyTextColor("#ffffff").setBodyBackgroundColor(`${t}${ce.value?"50":"80"}`).setBodyBorderColor(t).setQuantity(e.amount.toString()).setQuantityBorderColor(t).setQuantityBackgroundColor(`${t}${ce.value?"50":"80"}`),n||i.onClose("onClose called",(async function(t){try{if(k.isBinary){const t=(new Date).getTime();new Date(e.closed_at).getTime()-t>15e3?(ne.value=e,ee.value=!0):E.warning("Cannot cancel order in the last 15 seconds")}else{const t=await O.cancelOrder(e.uuid);E.response(t)}}catch(n){E.danger(n)}})).setCloseTooltip("Cancel Order").setCloseButtonBackgroundColor(`${_e.value.failure}${ce.value?"50":"80"}`).setCloseButtonBorderColor(_e.value.failure).setCloseButtonIconColor(_e.value.failure),i}function Se(){if(!Z.value)return;let e=k.isBinary?O.binaryPositions:O.orders;const t=new Set(e.map((e=>e.uuid)));for(const[i,o]of ye.value.entries())if(!t.has(i))try{o.line.remove(),ye.value.delete(i)}catch(n){}e.forEach((e=>{if(!ye.value.has(e.uuid)&&"PENDING"===e.status&&e.symbol===k.currency+"/"+k.pair){const t=Ce(e,_e.value.pending),{profit:n,profitPercentage:i}=be(e,O.bestAsk);if(ye.value.set(e.uuid,{line:t,symbol:e.symbol,order:e,profit:n,percentage:i,remainingTime:ve(e),isProcessing:!1}),"STOP_LIMIT"===e.type){const t=Ce({...e,price:e.stop},_e.value.stop,!0);ye.value.set(`stop-${e.uuid}`,{line:t,symbol:e.symbol,order:e})}k.isBinary&&O.bestAsk&&Pe(O.bestAsk)}}))}function Ie(e){return e.isProcessing?"Processing":Oe.isGreaterOrEquals("sm")?`Profit: ${e.profit} ${k.pair}, Percentage: ${e.percentage}%, Remaining Time: ${e.remainingTime}s`:`Remaining Time: ${e.remainingTime}s`}function Pe(e){ye.value.forEach(((t,n)=>{const{line:i,symbol:o,order:s,isProcessing:r}=t;if(o===k.currency+"/"+k.pair&&!r){const{profit:n,profitPercentage:o}=be(s,e);t.profit=n,t.percentage=o,t.remainingTime=ve(s);const r=Ie(t);let a;k.isBinary?(a=n>0?_e.value.success:n<0?_e.value.failure:_e.value.draw,i.setLineColor(a),i.setBodyBackgroundColor(`${a}80`),i.setBodyBorderColor(a),i.setQuantityBorderColor(a),i.setQuantityBackgroundColor(`${a}50`),i.setCloseButtonBorderColor(a)):a=n>0?_e.value.success:_e.value.failure,i.setText(r)}}))}l((()=>k.isBinary?O.binaryPositions.length:O.orders.length),(()=>{Z.value&&Se()}),{immediate:!0});let Ae=new Worker(URL.createObjectURL(new Blob(["\nself.onmessage = function (event) {\n  const rawData = event.data;\n\n  if (!rawData) {\n    return;\n  }\n  const data = JSON.parse(rawData);\n\n  if (data.watchOHLCV === undefined || data.watchOHLCV === null) {\n    return;\n  }\n  const watchOHLCV = data.watchOHLCV;\n\n  const processedData = {\n    time: watchOHLCV[0][0],\n    open: watchOHLCV[0][1],\n    high: watchOHLCV[0][2],\n    low: watchOHLCV[0][3],\n    close: watchOHLCV[0][4],\n    volume: watchOHLCV[0][5],\n  };\n\n  // Post the processed data back to the main thread.\n  self.postMessage(processedData);\n};\n        "],{type:"text/javascript"}))),Le=null,xe=null,ke=null;const Te={binance:["1","3","5","15","30","60","120","240","360","480","720","D"],binanceus:["1","3","5","15","30","60","120","240","360","480","720","D"],kucoin:["1","5","15","30","60","240","D"],bitget:["1","5","15","30","60","240","360","720","D"]};ke=Te[F];let De={binance:{1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",480:"8h",720:"12h",D:"1d"},binanceus:{1:"1m",3:"3m",5:"5m",15:"15m",30:"30m",60:"1h",120:"2h",240:"4h",360:"6h",480:"8h",720:"12h",D:"1d"},kucoin:{1:"1m",5:"5m",15:"15m",30:"30m",60:"1h",240:"4h","1D":"1d"},bitget:{1:"1m",5:"5m",15:"15m",30:"30m",60:"1h",240:"4h",360:"6h",720:"12h","1D":"1d"}};xe=De[F];const Ee={1:864e5,3:2592e5,5:432e6,15:1296e6,30:2592e6,60:5184e6,120:10368e6,240:20736e6,360:31104e6,480:41472e6,720:62208e6,"1D":124416e6},Fe=o({interval:null,ws:null,since:null,duration:864e5,now:Date.now(),lastprice:[],subscribers:{}}),We=["header_compare","symbol_search_hot_key","header_symbol_search","border_around_the_chart","popup_hints","timezone_menu"],Re=["save_chart_properties_to_local_storage","use_localstorage_for_settings","dont_show_boolean_study_arguments","hide_last_na_study_output","constraint_dialogs_movement","countdown","insert_indicator_dialog_shortcut","shift_visible_range_on_new_bar","hide_image_invalid_symbol","pre_post_market_sessions","use_na_string_for_not_available_values","create_volume_indicator_by_default","determine_first_data_request_size_using_visible_range","end_of_period_timescale_marks","secondary_series_extend_time_scale","shift_visible_range_on_new_bar"],Oe=L();Oe.isGreaterOrEquals("sm")?(Re.push("chart_style_hilo"),Re.push("chart_style_hilo_last_price"),Re.push("side_toolbar_in_fullscreen_mode")):(We.push("left_toolbar"),We.push("header_fullscreen_button"),We.push("timeframes_toolbar"));let Be={onReady:function(e){setTimeout((()=>e({exchanges:[],symbols_types:[],supported_resolutions:ke})),0)},resolveSymbol:function(e,t,n){setTimeout((()=>{t({data_status:"streaming",pricescale:Math.pow(10,Number(ae.value)||2),name:e,full_name:e,description:e,ticker:e,type:"crypto",session:"24x7",format:"price",exchange:ie.value?.site_name?.toUpperCase()||"Platform",listed_exchange:ie.value?.site_name?.toUpperCase()||"Platform",timezone:"Etc/UTC",volume_precision:le.value||2,supported_resolutions:ke,minmov:1,has_intraday:!0,visible_plots_set:!1})}),0)},getBars:async function(e,t,n,i,o){const s=Ee[t]||0,r=1e3*n.from,a=1e3*n.to;try{const n=await D(e.ticker,xe[t],r,a,s),o=await n.data.result;if(o&&o.length){const e=o.map((e=>({time:e[0],open:e[1],high:e[2],low:e[3],close:e[4],volume:e[5]})));e.sort(((e,t)=>e.time-t.time)),k.isBinary&&(O.bestAsk=e[e.length-1].close,Pe(e[e.length-1].close)),i(e)}else i([],{noData:!0})}catch(l){return void o(new Error("Failed to fetch historical data"))}},subscribeBars:function(e,t,n,i,o){const s={callback:n,symbolInfo:e,resolution:t};Fe.value.subscribers[i]=s,Fe.value.interval===xe[t]&&Fe.value.interval||(Fe.value.interval=xe[t],W.subscribe("trade",{symbol:`${k.currency}/${k.pair}`,type:"watchOHLCV",interval:Fe.value.interval}))},unsubscribeBars:function(e){Fe.value.subscribers[e]&&(delete Fe.value.subscribers[e],Fe.value.interval&&W.unsubscribe("trade",{symbol:`${k.currency}/${k.pair}`,type:"watchOHLCV",interval:Fe.value.interval}),Fe.value.interval=null)}};return Ae.onmessage=e=>{let t=e.data;k.isBinary&&(O.bestAsk=t.close,Pe(t.close)),Object.values(Fe.value.subscribers).forEach((e=>{e.callback&&e.callback(t)}))},l((()=>W.tradeData),(e=>{Ae.postMessage(e)}),{immediate:!0}),(t,n)=>{const i=C,o=S,s=f;return v(),u("div",B,[$,h(s,{open:m(ee),size:"sm",onClose:n[2]||(n[2]=e=>ee.value=!1)},{header:_((()=>[p("div",U,[p("h3",z,y(t.$t("Cancel Order")),1),h(i,{onClick:n[0]||(n[0]=e=>ee.value=!1)})])])),footer:_((()=>[p("div",q,[p("div",J,[h(o,{color:"danger",flavor:"solid",onClick:n[1]||(n[1]=e=>async function(){try{if(await O.cancelBinaryPosition(ne.value?.uuid,K.value),E.successText("Order cancelled successfully"),!ne.value?.is_demo){let e=ne.value?.amount;K.value<0&&(e-=ne.value?.amount*(Math.abs(K.value)/100)),Y.wallet.balance+=e}}catch(e){E.danger(e)}ee.value=!1,ne.value=null}()),disabled:m(te),loading:m(te)},{default:_((()=>[b(y(t.$t("Cancel")),1)])),_:1},8,["disabled","loading"])])])])),default:_((()=>[p("div",N,[p("div",M,[p("h3",j,y(t.$t("Are you sure?")),1),p("span",H,[null!==m(de)?(v(),u("div",{key:m(de)},[p("div",null,y(t.$t("Do you really want to cancel this"))+" "+y(t.$t("order"))+" "+y(t.$t("This process cannot be undone"))+". ",1),p("div",null,[b(y(t.$t("You will receive a refund of"))+" ",1),p("span",{class:w(`text-${m(K)>0?"success":"danger"}-500`)},y(m(K)>0?m(ne)?.amount:m(de))+" "+y(e.pair),3)])])):(v(),u("div",V,[p("div",null,y(t.$t("You cannot cancel this order now"))+".",1),p("div",null,y(t.$t("Remaining time"))+": "+y(m(re))+"s ",1)]))])])])])),_:1},8,["open"])])}}});export{G as _,R as a};
