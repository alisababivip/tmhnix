import{a as e,ad as r,ac as a,z as t,ap as l,c as o,Q as s,E as n,r as u,J as d,O as i,w as m,o as c,e as p,q as v,t as h,u as f,f as y,k as g,p as b,W as x,b as w,A as k,F as B,B as _,n as V,_ as C,x as j,X as U,Y as E}from"../e/entry-8qgg5CL-.js";import{_ as P}from"./BaseInput.vue-iInHQMIA.js";import{_ as S}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as I}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as A}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as D}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as T}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as F}from"./useEcommerce-2nLxpPKu.js";import{u as O}from"./currency-9FjTf2Bf.js";import{u as q}from"./fiatCurrency-EA2f5t5g.js";import{u as M}from"./fetch-i3Y1jjTS.js";import{b as L}from"./strings-rQgUKePI.js";import{_ as N}from"./placeholder-file-IxKzOaSl.js";import{z as $,u as z,t as W,F as K}from"./vee-validate.esm-n59zZCC5.js";import{u as R}from"./admin-Nwh6nXjV.js";import{u as Q}from"./products-LxuNCGpu.js";import{u as X}from"./categories-M541zqEW.js";import"./input-id-wZ-Ta08j.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./useExchange-VMAYQu3P.js";import"./useEcosystem-9eBUNbsT.js";const Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},J={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},G=["onDrop"],H=["onClick","onKeydown"],Z={class:"p-5 text-center"},ee={class:"text-muted-400 font-sans text-sm"},re={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},ae={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},te={key:1,class:"mt-6 space-y-2"},le={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},oe={class:"flex items-center gap-2"},se={class:"shrink-0"},ne=["src"],ue={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:N,alt:"Image preview"},de={class:"font-sans"},ie={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},me={class:"text-muted-400 block text-xs"},ce={class:"flex gap-2"},pe={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},ve=y("span",{class:"sr-only"},"Cancel",-1),he={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},fe=y("span",{class:"sr-only"},"Upload",-1),ye=["onClick"],ge=y("span",{class:"sr-only"},"Remove",-1),be={key:0,class:"mb-4 h-36 w-full flex items-center justify-center overflow-hidden rounded-xl"},xe=["src"],we={class:"text-warning-400 dark:text-warning-600 font-sans text-[0.7rem] font-semibold"},ke=e({__name:"[id]",setup(e){const{toast:N}=r(),ke=a(),{id:Be}=t().params,_e=Q(),Ve=X(),{updateAdminProduct:Ce}=F(),je=l(),Ue=o((()=>je.extensions)),Ee=o((()=>Ue.value?.find((e=>"ecosystem"===e.name)))),Pe=s(),Se=o((()=>Pe.settings)),Ie=O(),Ae=o((()=>Ie.currencies)),De=q(),Te=o((()=>De.currencies)),Fe=R(),Oe=o((()=>Fe.tokens)),qe=["FIAT"],Me=o((()=>Ve.categories));n((async()=>{0===Ve.categories.length&&(Ve.loading=!0,await Ve.fetchCategories(),Ve.loading=!1),0===_e.products.length&&(_e.loading=!0,await _e.fetchProducts(),_e.loading=!1),0===je.extensions.length&&await je.fetchExtensions(),Se.value?.spot_exchange&&(qe.push("SPOT"),0===Ie.currencies.length&&await Ie.fetchCurrencies()),Ee.value?.status&&(qe.push("ECO"),0===Fe.tokens.length&&await Fe.fetchTokensAll()),0===De.currencies.length&&await De.fetchCurrencies(),_e.selectProductById(Number(Be)),We.value=Le.value?.image||null,Ye()}));const Le=o((()=>_e.selectedProduct||_e.getProductById(Be))),Ne=o((()=>{let e=[];"SPOT"===Xe.wallet_type?e=Ae.value.map((e=>e.currency)):"ECO"===Xe.wallet_type?e=Oe.value.map((e=>e.currency)):"FIAT"===Xe.wallet_type&&(e=Te.value.map((e=>e.code)));return[...new Set(e)]})),$e=$.object({name:$.string().nonempty("Name is required"),description:$.string().nonempty("Description is required"),type:$.enum(["DOWNLOADABLE","KEY"]),price:$.number().min(0,"Price must be greater than 0"),currency:$.string().nonempty("Currency is required"),wallet_type:$.enum(qe),category:$.object({label:$.string().nonempty("Category is required"),value:$.number().positive("Category is required")}),inventory_quantity:$.number().min(0,"Inventory Quantity must be non-negative"),file_path:$.string().optional(),status:$.enum(["ACTIVE","INACTIVE"])}),ze=u(null),We=u(Le.value?.image||null);d(ze,(e=>{const r=e?.item(0)||null;if(ze.value){const e=new FileReader;e.onload=e=>{We.value=e.target?.result},e.readAsDataURL(r)}}));const Ke=o((()=>({...Le.value,category:{label:Le.value?.category?.name||"",value:Le.value?.category?.id||0}}))),{handleSubmit:Re,isSubmitting:Qe,values:Xe,resetForm:Ye}=z({validationSchema:W($e),initialValues:Ke}),Je=Re((async e=>{try{let r=We.value;if(ze.value){const e=new FormData;e.append("files",ze.value[0]),e.append("type","ecommerceProducts");const a=await M("/api/upload",{method:"POST",body:e},"$SrEzX7rXGy");a&&""!==a.data.value&&(r=a.data.value[0])}const a=await Ce(Number(Be),e.name,e.description,e.type.toUpperCase(),e.price,e.currency,e.wallet_type,e.category.value,e.inventory_quantity,e.file_path,e.status,r);N.response(a),"success"===a.status&&(await _e.fetchProducts(),ke.push("/admin/extensions/ecommerce/products"))}catch(r){N.danger(r)}}));return(e,r)=>{const a=C,t=j,l=U,o=P,s=S,n=E,u=I,d=A,F=D,O=T;return c(),i(O,null,{left:m((()=>[p(a,{size:"lg"},{default:m((()=>[v(h(e.$t("Edit Product")),1)])),_:1})])),right:m((()=>[p(l,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/admin/extensions/ecommerce/products"},{default:m((()=>[p(t,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),v(" "+h(e.$t("Back")),1)])),_:1}),p(l,{type:"submit",color:"primary",disabled:f(Qe),class:"w-full",onClick:f(Je)},{default:m((()=>[v(h(e.$t("Save Changes")),1)])),_:1},8,["disabled","onClick"])])),default:m((()=>[y("form",{onSubmit:r[3]||(r[3]=x(((...e)=>f(Je)&&f(Je)(...e)),["prevent"])),class:"space-y-8"},[p(n,{class:"p-5 space-y-5"},{default:m((()=>[y("div",Y,[p(f(K),{name:"name"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Name",placeholder:"Enter product name",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),p(f(K),{name:"description"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Description",placeholder:"Enter product description",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),p(f(K),{name:"type"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(s,{"model-value":e.value,error:r,items:["DOWNLOADABLE","KEY"],placeholder:"Select a type",label:"Type",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","onUpdate:modelValue","onBlur"])])),_:1}),p(f(K),{name:"wallet_type"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(s,{"model-value":e.value,error:r,items:qe,label:"Purchase Wallet Type",placeholder:"Select wallet type",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","onUpdate:modelValue","onBlur"])])),_:1}),p(f(K),{name:"currency"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(s,{"model-value":e.value,error:r,items:f(Ne),label:"Purchase Currency",placeholder:"Select purchase currency",disabled:!f(Xe)?.type||""===f(Xe)?.type,"onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","items","disabled","onUpdate:modelValue","onBlur"])])),_:1}),p(f(K),{name:"price"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Price",placeholder:"Enter product price",shape:"rounded",class:"w-full",type:"number",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),p(f(K),{name:"category"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,items:f(Me).map((e=>({label:e.name,value:e.id}))),properties:{label:"label",value:"value"},label:"Category",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","items","onBlur"])])),_:1}),p(f(K),{name:"inventory_quantity"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Inventory Quantity",placeholder:"Enter inventory quantity",shape:"rounded",class:"w-full",type:"number",min:"0",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),"DOWNLOADABLE"===f(Xe).type?(c(),i(f(K),{key:0,name:"file_path"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(o,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"File Path",placeholder:"Enter file path or URL",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1})):g("",!0),p(f(K),{name:"status"},{default:m((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[p(s,{"model-value":e.value,error:r,items:["ACTIVE","INACTIVE"],placeholder:"Select a status",label:"Status",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","onUpdate:modelValue","onBlur"])])),_:1})])])),_:1}),p(n,{class:"p-5"},{default:m((()=>[y("div",J,[p(d,{modelValue:f(ze),"onUpdate:modelValue":r[2]||(r[2]=e=>b(ze)?ze.value=e:null)},{default:m((({open:a,remove:l,preview:o,drop:s,files:n})=>[y("div",{class:"",onDragenter:r[0]||(r[0]=x((()=>{}),["stop","prevent"])),onDragover:r[1]||(r[1]=x((()=>{}),["stop","prevent"])),onDrop:s},[n?.length?(c(),w("ul",te,[(c(!0),w(B,null,_(n,(r=>(c(),w("li",{key:r.name},[y("div",le,[y("div",oe,[y("div",se,[r.type.startsWith("image")?(c(),w("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:o(r).value,alt:"Image preview"},null,8,ne)):(c(),w("img",ue))]),y("div",de,[y("span",ie,h(r.name),1),y("span",me,h(("formatFileSize"in e?e.formatFileSize:f(L))(r.size)),1)])]),y("div",{class:V(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[p(u,{value:0,size:"xs",color:"success"})]),y("div",ce,[y("button",pe,[p(t,{name:"lucide:slash",class:"h-4 w-4"}),ve]),y("button",he,[p(t,{name:"lucide:arrow-up",class:"h-4 w-4"}),fe]),y("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:x((e=>l(r)),["prevent"])},[p(t,{name:"lucide:x",class:"h-4 w-4"}),ge],8,ye)])])])))),128))])):(c(),w("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:a,onKeydown:k(x(a,["prevent"]),["enter"])},[y("div",Z,[p(t,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),y("h4",ee,h(e.$t("Drop file to upload")),1),y("div",null,[y("span",re,h(e.$t("Or")),1)]),y("label",ae,h(e.$t("Select Image")),1)])],40,H))],40,G)])),_:1},8,["modelValue"]),f(We)?(c(),w("div",be,[y("img",{src:f(We),alt:"Image Preview",class:"max-h-full max-w-full object-cover object-center"},null,8,xe)])):g("",!0)]),y("div",null,[y("span",we,h(e.$t("Note"))+": Preferred image size is 600x400px ",1)])])),_:1}),p(F,null,{default:m((()=>[p(l,{type:"submit",color:"primary",disabled:f(Qe),class:"w-full"},{default:m((()=>[v(h(e.$t("Save Changes")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{ke as default};
