import{a as e,ad as a,ac as l,c as t,E as r,O as o,w as s,o as u,e as n,q as d,t as c,u as i,f as m,W as p,_ as f,x as v,X as g,Y as h}from"../e/entry-8qgg5CL-.js";import{_ as b}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_}from"./BaseInput.vue-iInHQMIA.js";import{_ as B}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as y}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as V}from"./useEcommerce-2nLxpPKu.js";import{z as j,u as x,t as C,F as w}from"./vee-validate.esm-n59zZCC5.js";import{u as U}from"./products-LxuNCGpu.js";import{u as S}from"./discounts-4CSnF0MZ.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./input-id-wZ-Ta08j.js";const D={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},E=e({__name:"create",setup(e){const{toast:E}=a(),M=l(),P=U(),k=S(),{createAdminDiscount:T}=V(),$=t((()=>P.products));r((async()=>{0===P.products.length&&await P.fetchProducts(),0===P.products.length&&(M.push("/admin/extensions/ecommerce/products/create"),E.dangerText("You need to create a product first"))}));const q=j.object({code:j.string().nonempty("Discount code is required"),percentage:j.number().min(0,"Percentage must be greater than 0").max(100,"Percentage cannot exceed 100"),valid_until:j.string(),product:j.object({label:j.string(),value:j.number()})}),A=t((()=>({code:"",percentage:0,valid_until:"",product:{label:"Select a product",value:0}}))),{handleSubmit:F,isSubmitting:I,values:L}=x({validationSchema:C(q),initialValues:A}),W=F((async e=>{try{const a=await T(e.code,e.percentage,e.valid_until,e.product.value);E.response(a),"success"===a.status&&(await k.fetchDiscounts(),M.push("/admin/extensions/ecommerce/discounts"))}catch(a){E.danger(a)}}));return(e,a)=>{const l=f,t=v,r=g,V=b,j=_,x=h,C=B,U=y;return u(),o(U,null,{left:s((()=>[n(l,{size:"lg"},{default:s((()=>[d(c(e.$t("Create Discount")),1)])),_:1})])),right:s((()=>[n(r,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/admin/extensions/ecommerce/discounts"},{default:s((()=>[n(t,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),d(" "+c(e.$t("Back")),1)])),_:1}),n(r,{type:"submit",color:"primary",disabled:i(I),class:"w-full",onClick:i(W)},{default:s((()=>[d(c(e.$t("Create Discount")),1)])),_:1},8,["disabled","onClick"])])),default:s((()=>[m("form",{onSubmit:a[0]||(a[0]=p(((...e)=>i(W)&&i(W)(...e)),["prevent"])),class:"space-y-8"},[n(x,{class:"p-5 space-y-5"},{default:s((()=>[m("div",D,[n(i(w),{name:"product"},{default:s((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[n(V,{"model-value":e.value,error:a,items:i($)?.map((e=>({label:e.name,value:e.id}))),properties:{label:"label",value:"value"},placeholder:"Select a product",label:"Product",shape:"rounded","onUpdate:modelValue":l,onBlur:t},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"])])),_:1}),n(i(w),{name:"code"},{default:s((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[n(j,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Code",placeholder:"Enter discount code",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),n(i(w),{name:"percentage"},{default:s((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[n(j,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Percentage",placeholder:"Enter discount percentage",type:"number",min:"0",max:"100",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),n(i(w),{name:"valid_until"},{default:s((({field:e,errorMessage:a,handleChange:l,handleBlur:t})=>[n(j,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,l],error:a,label:"Valid Until",placeholder:"Enter validity date",type:"datetime-local",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1})])])),_:1}),n(C,null,{default:s((()=>[n(r,{type:"submit",color:"primary",disabled:i(I),class:"w-full"},{default:s((()=>[d(c(e.$t("Create Discount")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{E as default};
