import{a as e,z as t,r as s,S as a,E as l,c as r,u as o,o as n,b as u,f as c,e as i,w as d,t as m,q as p,F as f,n as y,B as x,x as v,_ as h,Y as b}from"../e/entry-8qgg5CL-.js";import{_ as w}from"./BaseIconBox.vue-qjQCKz6R.js";import{_ as $}from"./TairoCheckAnimated-O9EoNlM1.js";import{_}from"./BaseButtonAction.vue-hzSHyI6o.js";import{u as P}from"./useWallet-8iHzU2hV.js";import{u as g}from"./wallet-n04aoRPe.js";import{f as k}from"./strings-rQgUKePI.js";const j={key:0},B={class:"my-auto text-center flex-col justify-center space-y-5"},T={class:"text-2xl font-bold"},z={key:1},C={key:0,class:"my-auto text-center flex-col justify-center space-y-5"},E={class:"flex justify-center"},O={class:"text-2xl font-bold"},S={class:"overflow-hidden font-sans"},D={class:"border-muted-200 dark:border-muted-700 flex flex-col justify-between gap-y-8 border-b p-8 sm:flex-row sm:items-center"},I={class:"flex flex-col"},A={class:"divide-muted-200 dark:divide-muted-700 min-w-full divide-y"},F={class:"font-sans"},Y={scope:"col",class:"text-muted-400 py-3.5 pe-3 ps-4 text-left text-xs font-medium uppercase sm:ps-6"},q={scope:"col",class:"text-muted-400 hidden px-3 py-3.5 text-start text-xs font-medium uppercase sm:table-cell"},W={scope:"col",class:"text-muted-400 py-3.5 pe-4 ps-3 text-center text-xs font-medium uppercase sm:pe-6 md:pe-0"},G={class:"font-sans"},H={class:"py-4 pe-3 ps-4 text-sm sm:ps-6 text-start"},J={class:"text-muted-800 dark:text-muted-100 font-medium"},L={class:"text-muted-400 mt-0.5 text-xs"},M={class:"text-muted-500 dark:text-muted-400 hidden px-3 py-4 text-start text-sm sm:table-cell"},N={class:"text-muted-400 hidden px-3 py-4 text-center text-sm sm:table-cell"},R={class:"border-t border-muted-200 dark:border-muted-700 px-8 py-5 sm:px-6"},U={key:1},K=e({__name:"success",props:{flutter:{type:Boolean,default:!1}},setup(e){const K=t().query.session_id,Q=s(!0),V=s(null),X=s([]),Z=a().getProfile,{depositFiat:ee}=P(),te=g();l((async()=>{try{const e=await fetch("/api/ipn/stripe/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:K})}),t=await e.json();if(V.value=t.payment_status,X.value=t.line_items.map((e=>({id:e.id,description:e.description,currency:e.currency.toUpperCase(),amount:e.amount_subtotal/100}))),"paid"===V.value&&X.value[0]){const e={type:"DEPOSIT",amount:X.value[0].amount,fee:X.value[1].amount,reference_id:K,status:"COMPLETED",metadata:{method:"STRIPE"},description:`Deposit of ${X.value[0].amount} ${X.value[0].currency} to ${Z?.first_name} ${Z?.last_name} wallet`};await ee(e,X.value[0].currency),await te.fetchWallets()}}catch(e){console.error(e),V.value="failed"}finally{Q.value=!1}}));const se=r((()=>X.value.reduce(((e,t)=>e+t.amount),0)));return(t,s)=>{const a=v,l=w,r=$,P=h,g=b,Z=_;return o(Q)?(n(),u("div",j,[c("div",B,[i(l,{size:"2xl",shape:"full",color:"info"},{default:d((()=>[i(a,{name:"svg-spinners:blocks-shuffle-3",class:"h-12 w-12"})])),_:1}),c("h1",T,m(t.$t("Processing Payment"))+"...",1),c("p",null,m(t.$t("Please wait while we process your payment"))+".",1)])])):(n(),u("div",z,["paid"===o(V)?(n(),u("div",C,[c("div",E,[i(r,{color:"success",size:"lg"})]),c("h1",O,m(t.$t("Payment Successful"))+"!",1),c("p",null,m(t.$t("Your payment has been processed successfully. Here are the details"))+": ",1),c("div",null,[i(g,null,{default:d((()=>[c("div",S,[c("div",null,[c("div",D,[i(P,{as:"h3",size:"md",weight:"medium",lead:"none"},{default:d((()=>[p(" Order #"+m(o(K)),1)])),_:1})]),c("div",I,[c("table",A,[c("thead",F,[c("tr",null,[c("th",Y,m(t.$t("Description")),1),c("th",q,m(t.$t("Currency")),1),c("th",W,m(t.$t("Amount")),1)])]),c("tbody",G,[(n(!0),u(f,null,x(o(X),((e,s)=>(n(),u("tr",{key:s,class:y(["border-muted-200 dark:border-muted-700",{"border-b":s!==o(X).length-1}])},[c("td",H,[c("div",J,m(e.description),1),c("div",L,m(("formatPrice"in t?t.formatPrice:o(k))(e.amount,e.currency)),1)]),c("td",M,m(e.currency),1),c("td",N,m(("formatPrice"in t?t.formatPrice:o(k))(e.amount,e.currency)),1)],2)))),128))])])])])]),c("div",null,[c("div",R,[c("strong",null,m(t.$t("Congratulations"))+"!",1),p(" "+m(t.$t("You have successfully deposited"))+" "+m(("formatPrice"in t?t.formatPrice:o(k))(o(se),o(X)[0].currency))+" "+m(t.$t("to your"))+" "+m(o(X)[0].currency)+" "+m(t.$t("wallet"))+". ",1)])])])),_:1})]),i(Z,{to:`/user/${e.flutter?"flutter/":""}wallets/fiat`},{default:d((()=>[i(a,{name:"lucide:arrow-left",class:"h-3 w-3"}),c("span",null,m(t.$t("Go Back")),1)])),_:1},8,["to"])])):(n(),u("div",U,[i(l,{size:"2xl",shape:"full",color:"danger"},{default:d((()=>[i(a,{name:"line-md:close",class:"h-16 w-16"})])),_:1}),c("h1",null,m(t.$t("Payment Failed"))+"!",1),c("p",null,m(t.$t("There was an issue processing your payment. Please try again later"))+" . ",1)]))]))}}});export{K as _};
