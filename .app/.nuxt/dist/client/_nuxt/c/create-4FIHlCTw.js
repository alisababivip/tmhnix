import{a as e,ad as r,ac as a,ap as t,c as l,Q as o,E as s,r as n,J as u,O as d,w as i,o as c,e as m,q as p,t as v,u as h,f,k as y,p as g,W as b,b as x,A as w,F as k,B as _,n as B,_ as j,x as V,X as C,Y as U}from"../e/entry-8qgg5CL-.js";import{_ as E}from"./BaseListbox.vue-1Dy9Ui3z.js";import{_ as P}from"./BaseInput.vue-iInHQMIA.js";import{_ as S}from"./BaseProgress.vue-xH0Mhn3Z.js";import{_ as D}from"./BaseInputFileHeadless.vue-LOgyN9kF.js";import{_ as A}from"./TairoFormSave.vue-aLVbwikq.js";import{_ as O}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as F}from"./useEcommerce-2nLxpPKu.js";import{u as T}from"./currency-9FjTf2Bf.js";import{u as I}from"./fiatCurrency-EA2f5t5g.js";import{u as q}from"./fetch-i3Y1jjTS.js";import{b as L}from"./strings-rQgUKePI.js";import{_ as M}from"./placeholder-file-IxKzOaSl.js";import{z as $,u as W,t as z,F as N}from"./vee-validate.esm-n59zZCC5.js";import{u as K}from"./admin-Nwh6nXjV.js";import{u as Q}from"./products-LxuNCGpu.js";import{u as R}from"./categories-M541zqEW.js";import"./BaseIconBox.vue-qjQCKz6R.js";import"./BaseAvatar.vue-XYSxxLJP.js";import"./use-text-value-9iwzs_EA.js";import"./input-id-wZ-Ta08j.js";import"./useExchange-VMAYQu3P.js";import"./useEcosystem-9eBUNbsT.js";const Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},H={class:"grid grid-cols-1 sm:grid-cols-2 gap-6"},J=["onDrop"],X=["onClick","onKeydown"],G={class:"p-5 text-center"},Z={class:"text-muted-400 font-sans text-sm"},ee={class:"text-muted-400 font-sans text-[0.7rem] font-semibold uppercase"},re={for:"file",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 cursor-pointer font-sans text-sm underline underline-offset-4 transition-colors duration-300"},ae={key:1,class:"mt-6 space-y-2"},te={class:"border-muted-200 dark:border-muted-700 dark:bg-muted-800 relative flex items-center justify-end gap-2 rounded-xl border bg-white p-3"},le={class:"flex items-center gap-2"},oe={class:"shrink-0"},se=["src"],ne={key:1,class:"h-14 w-14 rounded-xl object-cover object-center",src:M,alt:"Image preview"},ue={class:"font-sans"},de={class:"text-muted-800 dark:text-muted-100 line-clamp-1 block text-sm"},ie={class:"text-muted-400 block text-xs"},ce={class:"flex gap-2"},me={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300 disabled:cursor-not-allowed disabled:opacity-60",disabled:"",type:"button",tooltip:"Cancel"},pe=f("span",{class:"sr-only"},"Cancel",-1),ve={class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Upload"},he=f("span",{class:"sr-only"},"Upload",-1),fe=["onClick"],ye=f("span",{class:"sr-only"},"Remove",-1),ge={key:0,class:"mb-4 h-36 w-full flex items-center justify-center overflow-hidden rounded-xl"},be=["src"],xe={class:"text-warning-400 dark:text-warning-600 font-sans text-[0.7rem] font-semibold"},we=e({__name:"create",setup(e){const{toast:M}=r(),we=a(),ke=Q(),_e=R(),{createAdminProduct:Be}=F(),je=t(),Ve=l((()=>je.extensions)),Ce=l((()=>Ve.value?.find((e=>"ecosystem"===e.name)))),Ue=o(),Ee=l((()=>Ue.settings)),Pe=T(),Se=l((()=>Pe.currencies)),De=I(),Ae=l((()=>De.currencies)),Oe=K(),Fe=l((()=>Oe.tokens)),Te=["FIAT"];s((async()=>{0===_e.categories.length&&(_e.loading=!0,await _e.fetchCategories(),_e.loading=!1),0===qe.value.length&&(we.push("/admin/extensions/ecommerce/categories/create"),M.dangerText("You must create a category before creating a product.")),0===je.extensions.length&&await je.fetchExtensions(),Ee.value?.spot_exchange&&(Te.push("SPOT"),0===Pe.currencies.length&&await Pe.fetchCurrencies()),Ce.value?.status&&(Te.push("ECO"),0===Oe.tokens.length&&await Oe.fetchTokensAll()),0===De.currencies.length&&await De.fetchCurrencies(),Ne()}));const Ie=l((()=>{let e=[];"SPOT"===ze.wallet_type?e=Se.value.map((e=>e.currency)):"ECO"===ze.wallet_type?e=Fe.value.map((e=>e.currency)):"FIAT"===ze.wallet_type&&(e=Ae.value.map((e=>e.code)));return[...new Set(e)]})),qe=l((()=>_e.categories)),Le=$.object({name:$.string().nonempty("Name is required"),description:$.string().nonempty("Description is required"),type:$.enum(["DOWNLOADABLE","KEY"]),price:$.number().min(0,"Price must be greater than 0"),currency:$.string().nonempty("Currency is required"),wallet_type:$.enum(Te),category:$.object({label:$.string(),value:$.number().positive("Category is required")}),inventory_quantity:$.number().min(0,"Inventory Quantity must be non-negative"),file_path:$.string().optional()}),Me=l((()=>({name:"",description:"",type:"DOWNLOADABLE",price:0,currency:"",wallet_type:"FIAT",category:{label:"Select a category",value:0},inventory_quantity:0,file_path:""}))),{handleSubmit:$e,isSubmitting:We,values:ze,resetForm:Ne}=W({validationSchema:z(Le),initialValues:Me}),Ke=n(null),Qe=n(null);u(Ke,(e=>{const r=e?.item(0)||null;if(Ke.value){const e=new FileReader;e.onload=e=>{Qe.value=e.target?.result},e.readAsDataURL(r)}}));const Re=$e((async e=>{try{let r=null;if(Ke.value){const e=new FormData;e.append("files",Ke.value[0]),e.append("type","ecommerceProducts");const a=await q("/api/upload",{method:"POST",body:e},"$1k6HgrVOaz");a&&""!==a.data.value&&(r=a.data.value[0])}const a=await Be(e.name,e.description,e.type,e.price,e.currency,e.wallet_type,e.category.value,e.inventory_quantity,e.file_path,r);M.response(a),"success"===a.status&&(await ke.fetchProducts(),we.push("/admin/extensions/ecommerce/products"))}catch(r){M.danger(r)}}));return(e,r)=>{const a=j,t=V,l=C,o=E,s=P,n=U,u=S,F=D,T=A,I=O;return c(),d(I,null,{left:i((()=>[m(a,{size:"lg"},{default:i((()=>[p(v(e.$t("Create Product")),1)])),_:1})])),right:i((()=>[m(l,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/admin/extensions/ecommerce/products"},{default:i((()=>[m(t,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),p(" "+v(e.$t("Back")),1)])),_:1}),m(l,{type:"submit",color:"primary",disabled:h(We),class:"w-full",onClick:h(Re)},{default:i((()=>[p(v(e.$t("Create")),1)])),_:1},8,["disabled","onClick"])])),default:i((()=>[f("form",{onSubmit:r[3]||(r[3]=b(((...e)=>h(Re)&&h(Re)(...e)),["prevent"])),class:"space-y-8"},[m(n,{class:"p-5 space-y-5"},{default:i((()=>[f("div",Y,[m(h(N),{name:"category"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(o,{"model-value":e.value,error:r,items:h(qe)?.map((e=>({label:e.name,value:e.id}))),properties:{label:"label",value:"value"},placeholder:"Select a category",label:"Category",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","items","onUpdate:modelValue","onBlur"])])),_:1}),m(h(N),{name:"name"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Name",placeholder:"Enter product name",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(h(N),{name:"description"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Description",placeholder:"Enter product description",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(h(N),{name:"type"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(o,{"model-value":e.value,error:r,items:["DOWNLOADABLE","KEY"],placeholder:"Select a type",label:"Type",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","onUpdate:modelValue","onBlur"])])),_:1}),m(h(N),{name:"wallet_type"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(o,{"model-value":e.value,error:r,items:Te,label:"Purchase Wallet Type",placeholder:"Select wallet type",shape:"rounded","onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","onUpdate:modelValue","onBlur"])])),_:1}),m(h(N),{name:"currency"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(o,{"model-value":e.value,error:r,items:h(Ie),label:"Purchase Currency",placeholder:"Select purchase currency",disabled:!h(ze)?.type||""===h(ze)?.type,"onUpdate:modelValue":a,onBlur:t},null,8,["model-value","error","items","disabled","onUpdate:modelValue","onBlur"])])),_:1}),m(h(N),{name:"price"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Price",placeholder:"Enter product price",shape:"rounded",class:"w-full",type:"number",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),m(h(N),{name:"inventory_quantity"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"Inventory Quantity",placeholder:"Enter inventory quantity",shape:"rounded",class:"w-full",type:"number",min:"0",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1}),"DOWNLOADABLE"===h(ze).type?(c(),d(h(N),{key:0,name:"file_path"},{default:i((({field:e,errorMessage:r,handleChange:a,handleBlur:t})=>[m(s,{modelValue:e.value,"onUpdate:modelValue":[r=>e.value=r,a],error:r,label:"File Path",placeholder:"Enter file url",shape:"rounded",class:"w-full",onBlur:t},null,8,["modelValue","onUpdate:modelValue","error","onBlur"])])),_:1})):y("",!0)])])),_:1}),m(n,{class:"p-5"},{default:i((()=>[f("div",H,[m(F,{modelValue:h(Ke),"onUpdate:modelValue":r[2]||(r[2]=e=>g(Ke)?Ke.value=e:null)},{default:i((({open:a,remove:l,preview:o,drop:s,files:n})=>[f("div",{class:"",onDragenter:r[0]||(r[0]=b((()=>{}),["stop","prevent"])),onDragover:r[1]||(r[1]=b((()=>{}),["stop","prevent"])),onDrop:s},[n?.length?(c(),x("ul",ae,[(c(!0),x(k,null,_(n,(r=>(c(),x("li",{key:r.name},[f("div",te,[f("div",le,[f("div",oe,[r.type.startsWith("image")?(c(),x("img",{key:0,class:"h-14 w-14 rounded-xl object-cover object-center",src:o(r).value,alt:"Image preview"},null,8,se)):(c(),x("img",ne))]),f("div",ue,[f("span",de,v(r.name),1),f("span",ie,v(("formatFileSize"in e?e.formatFileSize:h(L))(r.size)),1)])]),f("div",{class:B(["ms-auto w-32 px-4 transition-opacity duration-300","opacity-100"])},[m(u,{value:0,size:"xs",color:"success"})]),f("div",ce,[f("button",me,[m(t,{name:"lucide:slash",class:"h-4 w-4"}),pe]),f("button",ve,[m(t,{name:"lucide:arrow-up",class:"h-4 w-4"}),he]),f("button",{class:"border-muted-200 hover:border-primary-500 text-muted-700 dark:text-muted-200 hover:text-primary-600 dark:border-muted-700 dark:bg-muted-900 dark:hover:border-primary-500 dark:hover:text-primary-600 relative flex h-8 w-8 cursor-pointer items-center justify-center rounded-full border bg-white transition-colors duration-300",type:"button",tooltip:"Remove",onClick:b((e=>l(r)),["prevent"])},[m(t,{name:"lucide:x",class:"h-4 w-4"}),ye],8,fe)])])])))),128))])):(c(),x("div",{key:0,class:"nui-focus border-muted-300 dark:border-muted-700 hover:border-muted-400 focus:border-muted-400 dark:hover:border-muted-600 dark:focus:border-muted-700 group cursor-pointer rounded-lg border-[3px] border-dashed transition-colors duration-300",tabindex:"0",role:"button",onClick:a,onKeydown:w(b(a,["prevent"]),["enter"])},[f("div",G,[m(t,{name:"mdi-light:cloud-upload",class:"text-muted-400 group-hover:text-primary-500 group-focus:text-primary-500 mb-2 h-10 w-10 transition-colors duration-300"}),f("h4",Z,v(e.$t("Drop file to upload")),1),f("div",null,[f("span",ee,v(e.$t("Or")),1)]),f("label",re,v(e.$t("Select Image")),1)])],40,X))],40,J)])),_:1},8,["modelValue"]),h(Qe)?(c(),x("div",ge,[f("img",{src:h(Qe),alt:"Image Preview",class:"max-h-full max-w-full object-cover object-center"},null,8,be)])):y("",!0)]),f("div",null,[f("span",xe,v(e.$t("Note"))+": Preferred image size is 600x400px ",1)])])),_:1}),m(T,null,{default:i((()=>[m(l,{type:"submit",color:"primary",disabled:h(We),class:"w-full"},{default:i((()=>[p(v(e.$t("Create Product")),1)])),_:1},8,["disabled"])])),_:1})],32)])),_:1})}}});export{we as default};
