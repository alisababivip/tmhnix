import{a as e,z as a,ac as t,S as l,c as s,r as n,E as r,ad as u,b as o,e as i,w as m,o as c,f as d,t as f,u as p,q as g,F as h,B as y,O as v,x,X as _,Y as w}from"../e/entry-8qgg5CL-.js";import{_ as b}from"./BaseTag.vue-NMkN1Uk8.js";import{_ as P}from"./BaseInput.vue-iInHQMIA.js";import{_ as k}from"./TairoContentWrapper.vue-JqAKR4O_.js";import{u as j}from"./useP2P-NV4dmDWU.js";import{z as C,u as M,t as O,F as T}from"./vee-validate.esm-n59zZCC5.js";import{u as A}from"./offers-pCoDOi_A.js";import"./input-id-wZ-Ta08j.js";const B={class:"text-lg font-bold"},D={class:"flex flex-col md:flex-row gap-4"},E={class:"flex-1 space-y-5"},F={class:"flex items-center justify-start p-5 gap-5"},V=["src"],$=d("hr",{class:"border-gray-300 dark:border-gray-700"},null,-1),S={class:"flex items-start justify-between p-5 flex-col"},U=d("strong",null,"Completion Rate:",-1),Y=d("strong",null,"Average Completion Duration:",-1),L=d("h3",{class:"text-lg font-semibold p-5"},"Offer Details",-1),R={class:"grid gap-3 grid-cols-2 p-5"},W=d("strong",null,"Offer Currency: ",-1),q=d("strong",null,"Purchase Currency: ",-1),z=d("strong",null,"Available:",-1),I=d("strong",null,"Price:",-1),X=d("strong",null,"Minimum Amount:",-1),G=d("strong",null,"Maximum Amount:",-1),H={class:"flex gap-2"},J=d("strong",null,"Rating:",-1),K={class:"flex items-end"},N={class:"ml-2 text-sm text-gray-500 dark:text-gray-400"},Q={class:"w-full md:w-2/5 space-y-5 flex flex-col justify-between"},Z=d("div",null,[d("p",{class:"text-red-500 text-sm"},[g(" Warning: Multiple cancelled trades without fulfilling them may result in a ban. "),d("br"),d("br"),d("strong",null,"Do not cancel a trade unless you have a valid reason.")])],-1),ee=e({__name:"index",setup(e){const ee=A(),{getP2POffer:ae,createUserP2PTrade:te}=j(),le=a(),se=t(),{uuid:ne}=le.params,re=l(),ue=s((()=>re.getProfile)),oe=n(null);r((async()=>{await ie()}));const ie=async()=>{const e=await ae(ne);oe.value=e.data.result},{toast:me}=u(),ce=C.object({amount:C.number().positive("Amount must be positive")}),de=s((()=>({amount:0}))),{handleSubmit:fe,isSubmitting:pe,resetForm:ge,values:he,setFieldValue:ye}=M({validationSchema:O(ce),initialValues:de}),ve=fe((async e=>{try{const a=await te(oe.value.uuid,e.amount);me.response(a),"success"===a.status&&(await ee.fetchP2POffers(),await ee.fetchUserP2POffers(),se.push(`/user/p2p/trades/${a.data.result.uuid}`))}catch(a){me.danger(a)}})),xe=s((()=>{const e=oe.value?.trades.length||0,a=oe.value?.trades.filter((e=>"COMPLETED"===e.status)).length||0;return e>0?a/e*100:0})),_e=s((()=>{const e=oe.value?.trades.filter((e=>"COMPLETED"===e.status))||[],a=e.reduce(((e,a)=>e+(new Date(a.updated_at).getTime()-new Date(a.created_at).getTime())),0);return e.length>0?a/e.length:0})),we=e=>{const a=Math.floor(e/1e3),t=Math.floor(a/60),l=Math.floor(t/60);return l>0?`${l} hours ${t%60} minutes`:`${t} minutes`},be=s((()=>{const e=oe.value?.reviews||[],a=e.reduce(((e,a)=>e+a.rating),0);return e.length?a/e.length:0}));function Pe(e){const a=Math.floor(be.value);return e<=a?"full":e===a+1&&be.value%1>=.5?"half":"empty"}return(e,a)=>{const t=x,l=_,s=w,n=b,r=P,u=k;return c(),o("div",null,[i(u,null,{left:m((()=>[d("h3",B,"Offer #"+f(p(oe)?.uuid),1)])),right:m((()=>[i(l,{type:"button",color:"muted",class:"hover:bg-gray-300 dark:hover:bg-gray-800",to:"/user/p2p"},{default:m((()=>[i(t,{name:"line-md:chevron-left",class:"h-4 w-4 mr-2"}),g(" "+f(e.$t("Back")),1)])),_:1})])),default:m((()=>[d("div",D,[d("div",E,[i(s,{class:""},{default:m((()=>[d("div",F,[d("img",{src:p(oe)?.user?.avatar||"/img/placeholder.png",alt:"Avatar",class:"w-20 h-20 rounded-full"},null,8,V),d("span",null,f(p(oe)?.user.first_name)+" "+f(p(oe)?.user.last_name),1)]),$,d("div",S,[d("p",null,[U,g(" "+f(p(xe).toFixed(2))+"% ",1)]),d("p",null,[Y,g(" "+f(we(p(_e))),1)])])])),_:1}),i(s,{class:""},{default:m((()=>[L,d("div",R,[d("p",null,[W,i(n,{"data-nui-tooltip":"You will receive the amount in this currency"},{default:m((()=>[g(f(p(oe)?.currency),1)])),_:1})]),d("p",null,[q,i(n,{"data-nui-tooltip":"You will pay the amount in this currency"},{default:m((()=>[g(f(p(oe)?.payment_method?.currency),1)])),_:1})]),d("p",null,[z,g(" "+f(p(oe)?.amount)+" "+f(p(oe)?.currency),1)]),d("p",null,[I,g(" "+f(p(oe)?.price)+" "+f(p(oe)?.payment_method?.currency),1)]),d("p",null,[X,g(" "+f(p(oe)?.min_amount)+" "+f(p(oe)?.currency),1)]),d("p",null,[G,g(" "+f(p(oe)?.max_amount||p(oe)?.amount)+" "+f(p(oe)?.currency),1)]),d("div",H,[J,d("span",K,[(c(),o(h,null,y(5,(e=>d("span",{key:e},["full"===Pe(e)?(c(),v(t,{key:0,name:"uim:star",class:"w-4 h-4 text-yellow-400"})):"half"===Pe(e)?(c(),v(t,{key:1,name:"uim:star-half-alt",class:"w-4 h-4 text-yellow-400"})):(c(),v(t,{key:2,name:"uim:star",class:"w-4 h-4 text-gray-300"}))]))),64)),d("span",N,f(p(be).toFixed(1)),1)])])])])),_:1})]),d("div",Q,[i(s,{class:"p-5 space-y-3"},{default:m((()=>[i(p(T),{name:"amount"},{default:m((({field:e,errorMessage:a,handleChange:t,handleBlur:l})=>[i(r,{modelValue:e.value,"onUpdate:modelValue":[a=>e.value=a,t],error:a,label:"Amount",shape:"rounded",placeholder:"Enter amount",type:"number",min:p(oe)?.min_amount,max:p(oe)?.max_amount||p(oe)?.amount,step:"0.00000001",onBlur:l},null,8,["modelValue","onUpdate:modelValue","error","min","max","onBlur"])])),_:1}),Z,p(oe)?.user_id!==p(ue)?.id?(c(),v(l,{key:0,color:"primary",class:"w-full",onClick:p(ve),disabled:p(pe)||p(oe)?.user_id===p(ue)?.id||p(oe)?.max_amount&&0===p(oe)?.max_amount||p(oe)?.min_amount>p(he).amount||p(oe)?.max_amount&&p(oe)?.max_amount<p(he).amount||p(oe)?.amount<p(he).amount},{default:m((()=>[g(" Purchase ")])),_:1},8,["onClick","disabled"])):(c(),v(l,{key:1,color:"primary",class:"w-full",onClick:p(ve),disabled:""},{default:m((()=>[g(" You cannot purchase your own offer ")])),_:1},8,["onClick"]))])),_:1})])])])),_:1})])}}});export{ee as default};
